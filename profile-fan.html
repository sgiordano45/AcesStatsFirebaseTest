<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Profile - Mountainside Aces Fan</title>
<meta name="theme-color" content="#2d5016">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" href="mobile-enhancements.css">
<link rel="stylesheet" href="nav-styles.css">
<style>
:root {
  --primary-color: #2d5016;
  --secondary-color: #1a6b4a;
  --accent-color: #ffd700;
  --card-bg: #ffffff;
  --text-dark: #2d3748;
  --text-light: #718096;
  --border-color: #e2e8f0;
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
  --shadow-lg: 0 12px 32px rgba(0,0,0,0.16);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
  min-height: 100vh;
  color: var(--text-dark);
}

/* Loading Overlay */
.loading-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(255,255,255,0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.3s ease;
}

.loading-overlay.hidden {
  opacity: 0;
  pointer-events: none;
}

.softball-spinner::before {
  content: '‚öæ';
  font-size: 80px;
  animation: spin 1.5s ease-in-out infinite;
}

@keyframes spin {
  0%, 100% { transform: rotate(0deg) scale(1); }
  50% { transform: rotate(180deg) scale(1.1); }
}

/* Header */
.header {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  padding: 3rem 2rem;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
}

.header::before {
  content: '';
  position: absolute;
  top: -50px;
  right: -50px;
  width: 300px;
  height: 300px;
  background: rgba(255,255,255,0.05);
  border-radius: 50%;
}

.header-content {
  max-width: 1200px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

.profile-header-section {
  display: flex;
  align-items: center;
  gap: 2rem;
  color: white;
}

.profile-photo-container {
  position: relative;
}

.profile-photo {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  border: 4px solid rgba(255,255,255,0.3);
  object-fit: cover;
  box-shadow: var(--shadow-md);
}

.profile-info {
  flex: 1;
}

.profile-info h1 {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.profile-subtitle {
  font-size: 1.1rem;
  opacity: 0.9;
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.profile-badge {
  background: rgba(255,255,255,0.2);
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 600;
}

.back-home-btn {
  position: absolute;
  top: 2rem;
  right: 2rem;
  background: rgba(255,255,255,0.2);
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255,255,255,0.3);
  z-index: 2;
}

.back-home-btn:hover {
  background: rgba(255,255,255,0.3);
  transform: translateX(-5px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Navigation Tabs */
.nav-tabs {
  background: white;
  box-shadow: var(--shadow-sm);
  position: sticky;
  top: 0;
  z-index: 100;
}

.nav-tabs-container {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  overflow-x: auto;
  scrollbar-width: none;
}

.nav-tabs-container::-webkit-scrollbar {
  display: none;
}

.nav-tab {
  padding: 1.2rem 2rem;
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-light);
  transition: all 0.3s ease;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.nav-tab:hover {
  color: var(--primary-color);
  background: rgba(45, 80, 22, 0.05);
}

.nav-tab.active {
  color: var(--primary-color);
  border-bottom-color: var(--primary-color);
  background: rgba(45, 80, 22, 0.05);
}

/* Main Content */
.main-content {
  max-width: 1200px;
  margin: 2rem auto;
  padding: 0 2rem 2rem;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Cards */
.section-card {
  background: var(--card-bg);
  border-radius: 12px;
  padding: 2rem;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-md);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.section-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 3px solid;
  border-image: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%) 1;
}

.section-header h2 {
  font-size: 1.5rem;
  color: var(--text-dark);
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.section-icon {
  font-size: 1.8rem;
}

/* Form Elements */
.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.form-label {
  font-weight: 600;
  color: var(--text-dark);
  font-size: 0.95rem;
}

.form-input,
.form-select {
  padding: 0.75rem 1rem;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 1rem;
  transition: all 0.3s ease;
  font-family: inherit;
}

.form-input:focus,
.form-select:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.1);
}

.form-input:disabled,
.form-select:disabled {
  background: #f7fafc;
  cursor: not-allowed;
  opacity: 0.6;
}

/* Buttons */
.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-family: inherit;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  box-shadow: var(--shadow-sm);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.btn-primary:active {
  transform: translateY(0);
}

.btn-secondary {
  background: white;
  color: var(--primary-color);
  border: 2px solid var(--primary-color);
}

.btn-secondary:hover {
  background: var(--primary-color);
  color: white;
}

.btn-group {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  margin-top: 1.5rem;
}

/* Favorites Section */
.favorites-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.favorite-card {
  background: white;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  padding: 1.25rem;
  transition: all 0.3s ease;
  position: relative;
}

.favorite-card:hover {
  border-color: var(--primary-color);
  box-shadow: var(--shadow-md);
}

.favorite-card-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.favorite-icon {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  font-size: 1.5rem;
}

.favorite-card-title {
  flex: 1;
  font-weight: 700;
  font-size: 1.1rem;
  color: var(--text-dark);
}

.remove-favorite {
  position: absolute;
  top: 0.75rem;
  right: 0.75rem;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-light);
  font-size: 1.2rem;
  padding: 0.25rem;
  line-height: 1;
  transition: color 0.3s ease;
}

.remove-favorite:hover {
  color: #dc3545;
}

.favorite-stats {
  font-size: 0.9rem;
  color: var(--text-light);
  line-height: 1.6;
}

.empty-state {
  text-align: center;
  padding: 3rem 2rem;
  color: var(--text-light);
}

.empty-state-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
  opacity: 0.3;
}

.empty-state-text {
  font-size: 1.1rem;
  margin-bottom: 1rem;
}

/* Toggle Switch */
.toggle-group {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.toggle-switch {
  position: relative;
  width: 50px;
  height: 26px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  border-radius: 26px;
  transition: 0.4s;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  border-radius: 50%;
  transition: 0.4s;
}

.toggle-switch input:checked + .toggle-slider {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
}

.toggle-switch input:checked + .toggle-slider:before {
  transform: translateX(24px);
}

/* Quick Links */
.quick-links {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.quick-link-card {
  background: linear-gradient(135deg, rgba(45, 80, 22, 0.05) 0%, rgba(26, 107, 74, 0.05) 100%);
  border: 2px solid var(--border-color);
  border-radius: 8px;
  padding: 1.5rem;
  text-decoration: none;
  color: var(--text-dark);
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.quick-link-card:hover {
  border-color: var(--primary-color);
  background: linear-gradient(135deg, rgba(45, 80, 22, 0.1) 0%, rgba(26, 107, 74, 0.1) 100%);
  transform: translateX(5px);
}

.quick-link-icon {
  font-size: 2rem;
}

.quick-link-content h3 {
  font-size: 1rem;
  margin-bottom: 0.25rem;
  color: var(--primary-color);
}

.quick-link-content p {
  font-size: 0.85rem;
  color: var(--text-light);
  margin: 0;
}

/* Responsive */
@media (max-width: 768px) {
  .back-home-btn {
    top: 1rem;
    right: 1rem;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }
  
  .profile-header-section {
    flex-direction: column;
    text-align: center;
  }

  .profile-info h1 {
    font-size: 2rem;
  }

  .nav-tab {
    padding: 1rem 1.5rem;
    font-size: 0.9rem;
  }

  .main-content {
    padding: 0 1rem 1rem;
  }

  .section-card {
    padding: 1.5rem;
  }

  .form-grid {
    grid-template-columns: 1fr;
  }

  .quick-links {
    grid-template-columns: 1fr;
  }
}

/* Success Message */
.success-message {
  background: #d4edda;
  border: 1px solid #c3e6cb;
  color: #155724;
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1rem;
  display: none;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.success-message.show {
  display: block;
}

/* Selection Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 10000;
  overflow-y: auto;
  padding: 2rem;
}

.modal.show {
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: white;
  border-radius: 16px;
  max-width: 600px;
  width: 100%;
  max-height: 80vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadow-lg);
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal-header {
  padding: 1.5rem 2rem;
  border-bottom: 2px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: linear-gradient(135deg, rgba(45, 80, 22, 0.05) 0%, rgba(26, 107, 74, 0.05) 100%);
}

.modal-header h2 {
  font-size: 1.5rem;
  color: var(--text-dark);
  margin: 0;
}

.modal-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--text-light);
  padding: 0.5rem;
  line-height: 1;
  transition: color 0.3s ease;
}

.modal-close:hover {
  color: var(--text-dark);
}

.modal-body {
  padding: 1.5rem 2rem;
  overflow-y: auto;
  flex: 1;
}

.modal-search {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 1rem;
  margin-bottom: 1.5rem;
  font-family: inherit;
}

.modal-search:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.1);
}

.selection-list {
  display: grid;
  gap: 0.75rem;
}

.selection-item {
  padding: 1rem;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
}

.selection-item:hover {
  border-color: var(--primary-color);
  background: rgba(45, 80, 22, 0.03);
  transform: translateX(5px);
}

.selection-item.selected {
  border-color: var(--primary-color);
  background: linear-gradient(135deg, rgba(45, 80, 22, 0.05) 0%, rgba(26, 107, 74, 0.05) 100%);
}

.selection-item.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.selection-item.disabled:hover {
  border-color: var(--border-color);
  background: white;
  transform: none;
}

.selection-item-info {
  flex: 1;
}

.selection-item-name {
  font-weight: 600;
  color: var(--text-dark);
  margin-bottom: 0.25rem;
}

.selection-item-details {
  font-size: 0.875rem;
  color: var(--text-light);
}

.selection-item-badge {
  background: var(--primary-color);
  color: white;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
}

.modal-footer {
  padding: 1.5rem 2rem;
  border-top: 2px solid var(--border-color);
  display: flex;
  gap: 1rem;
  background: #f7fafc;
}

.modal-footer .btn {
  flex: 1;
}

/* Fan-specific Overview Stats */
.favorites-summary {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.summary-box {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  padding: 1.5rem;
  border-radius: 8px;
  text-align: center;
  border: 2px solid var(--border-color);
  transition: all 0.3s ease;
}

.summary-box:hover {
  border-color: var(--primary-color);
  transform: translateY(-2px);
}

.summary-value {
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary-color);
  margin-bottom: 0.5rem;
}

.summary-label {
  font-size: 0.9rem;
  color: var(--text-light);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 600;
}
</style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="softball-spinner"></div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a href="index.html" class="back-home-btn hide-mobile">
        <span>‚Üê</span> Back Home
      </a>
      <div class="profile-header-section">
        <div class="profile-photo-container">
          <img src="" alt="Profile Photo" class="profile-photo" id="profilePhoto">
        </div>
        <div class="profile-info">
          <h1 id="displayName">Loading...</h1>
          <div class="profile-subtitle">
            <span class="profile-badge">‚öæ Fan Account</span>
            <span class="profile-badge" id="memberSince">Member since 2024</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Email Verification Banner (for unverified email/password users) -->
  <div id="verificationBanner" class="alert alert-warning" style="display: none; margin: 1rem auto; max-width: 1200px; padding: 0 2rem;">
    <div style="background: #fef3c7; border: 2px solid #f59e0b; padding: 1.25rem; border-radius: 12px;">
      <strong style="color: #92400e; font-size: 16px;">üìß Email Verification Required</strong>
      <p style="margin: 0.75rem 0; color: #92400e;">
        Please verify your email address to access all features and ensure account security.
      </p>
      <button class="btn btn-primary" onclick="window.location.href='verify-email.html'" style="margin-top: 0.5rem;">
        <span>Verify Email Now ‚Üí</span>
      </button>
    </div>
  </div>


  <!-- Navigation Tabs -->
  <nav class="nav-tabs">
    <div class="nav-tabs-container">
      <button class="nav-tab active" data-tab="overview">
        <span>üìä</span> Overview
      </button>
      <button class="nav-tab" data-tab="favorites">
        <span>‚≠ê</span> Favorites
      </button>
      <button class="nav-tab" data-tab="preferences">
        <span>‚öôÔ∏è</span> Preferences
      </button>
      <button class="nav-tab" data-tab="account">
        <span>üîí</span> Account
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Overview Tab -->
    <div class="tab-content active" id="tab-overview">
      <div class="section-card">
        <div class="section-header">
          <h2><span class="section-icon">üëã</span> Welcome Back!</h2>
        </div>
        <p style="color: var(--text-light); margin-bottom: 1.5rem;">
          Track your favorite teams and players, get notifications about game updates, and stay connected with Mountainside Aces softball!
        </p>
        
        <div class="favorites-summary">
          <div class="summary-box">
            <div class="summary-value" id="favoriteTeamsCount">0</div>
            <div class="summary-label">Favorite Teams</div>
          </div>
          <div class="summary-box">
            <div class="summary-value" id="favoritePlayersCount">0</div>
            <div class="summary-label">Favorite Players</div>
          </div>
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <h2><span class="section-icon">üîó</span> Quick Links</h2>
        </div>
        <div class="quick-links">
          <a href="favorites.html" class="quick-link-card">
            <div class="quick-link-icon">‚≠ê</div>
            <div class="quick-link-content">
              <h3>My Favorites</h3>
              <p>View all tracked teams & players</p>
            </div>
          </a>
          <a href="schedule.html" class="quick-link-card">
            <div class="quick-link-icon">üìÖ</div>
            <div class="quick-link-content">
              <h3>Game Schedule</h3>
              <p>See upcoming games</p>
            </div>
          </a>
          <a href="standings.html" class="quick-link-card">
            <div class="quick-link-icon">üèÜ</div>
            <div class="quick-link-content">
              <h3>Standings</h3>
              <p>Current league rankings</p>
            </div>
          </a>
			<a href="link-player.html" class="quick-link-card">
			<div class="quick-link-icon">üîó</div>
				<div class="quick-link-content">
				<h3>Link Player Account</h3>
				<p>Are you a player? Link your account to access more features</p>
			</div>
			</a>
        </div>
      </div>
    </div>

    <!-- Favorites Tab -->
    <div class="tab-content" id="tab-favorites">
      <div class="section-card">
        <div class="section-header">
          <h2><span class="section-icon">üèÜ</span> Favorite Teams</h2>
          <button class="btn btn-secondary" id="addFavoriteTeam">
            + Add Team
          </button>
        </div>
        <div class="favorites-grid" id="favoriteTeamsGrid">
          <!-- Will be populated dynamically -->
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <h2><span class="section-icon">‚≠ê</span> Favorite Players (Max 10)</h2>
          <button class="btn btn-secondary" id="addFavoritePlayer">
            + Add Player
          </button>
        </div>
        <div class="favorites-grid" id="favoritePlayersGrid">
          <!-- Will be populated dynamically -->
        </div>
      </div>
    </div>

    <!-- Preferences Tab -->
    <div class="tab-content" id="tab-preferences">
      <div class="section-card">
        <div class="section-header">
          <h2><span class="section-icon">üë§</span> Display Name</h2>
        </div>
        <div id="successMessageDisplayName" class="success-message">
          Display name updated successfully!
        </div>
        <p style="color: var(--text-light); margin-bottom: 1.5rem;">
          This is how your name will appear throughout the site. Leave blank to use your Google account name.
        </p>
        <form id="displayNameForm">
          <div class="form-group">
            <label class="form-label" for="preferredDisplayName">Preferred Display Name</label>
            <input type="text" id="preferredDisplayName" class="form-input" placeholder="e.g., Steve instead of Stephen">
            <small style="color: var(--text-light); display: block; margin-top: 0.5rem;">
              Current Google account name: <strong id="googleAccountName"></strong>
            </small>
          </div>
          <div class="btn-group">
            <button type="submit" class="btn btn-primary">
              üíæ Save Display Name
            </button>
            <button type="button" class="btn btn-secondary" id="clearDisplayName">
              ‚úñÔ∏è Use Google Name
            </button>
          </div>
        </form>
      </div>

      <div class="section-card">
        <div class="section-header">
          <h2><span class="section-icon">üîî</span> Notifications</h2>
        </div>
        <div id="successMessagePreferences" class="success-message">
          Preferences saved successfully!
        </div>
        <form id="preferencesForm">
          <div class="form-group">
            <label class="toggle-group">
              <span class="form-label">Favorite Team Game Notifications</span>
              <label class="toggle-switch">
                <input type="checkbox" id="favoriteTeamNotifications" checked>
                <span class="toggle-slider"></span>
              </label>
            </label>
          </div>
          <div class="form-group">
            <label class="toggle-group">
              <span class="form-label">Favorite Player Milestone Alerts</span>
              <label class="toggle-switch">
                <input type="checkbox" id="favoritePlayerAlerts" checked>
                <span class="toggle-slider"></span>
              </label>
            </label>
          </div>
          <div class="form-group">
            <label class="toggle-group">
              <span class="form-label">Score Update Notifications</span>
              <label class="toggle-switch">
                <input type="checkbox" id="emailScoreUpdates">
                <span class="toggle-slider"></span>
              </label>
            </label>
          </div>
        </form>
      </div>

      <div class="section-card">
        <div class="section-header">
          <h2><span class="section-icon">üîê</span> Privacy</h2>
        </div>
        <form>
          <div class="form-group">
            <label class="toggle-group">
              <span class="form-label">Make my favorites visible to other users</span>
              <label class="toggle-switch">
                <input type="checkbox" id="publicFavorites">
                <span class="toggle-slider"></span>
              </label>
            </label>
          </div>
          <div class="btn-group">
            <button type="submit" class="btn btn-primary">
              üíæ Save Privacy Settings
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Account Tab -->
    <div class="tab-content" id="tab-account">
      <div class="section-card">
        <div class="section-header">
          <h2><span class="section-icon">üîí</span> Account Security</h2>
        </div>
        <div class="form-group">
          <label class="form-label">Email Address</label>
          <input type="email" class="form-input" id="accountEmail" disabled>
        </div>
        <div class="form-group">
          <label class="form-label">Account Type</label>
          <input type="text" class="form-input" id="accountType" value="Google Sign-In" disabled>
        </div>
      </div>

<!-- Change Password Section -->
<div class="section-card">
  <div class="section-header">
    <h2><span class="section-icon">üîë</span> Change Password</h2>
  </div>
  
  <div id="successMessagePassword" class="success-message">
    Password changed successfully!
  </div>
  
  <!-- Email/Password Users -->
  <div id="passwordChangeForm" style="display: none;">
    <form id="changePasswordForm">
      <div class="form-group">
        <label class="form-label" for="currentPassword">Current Password</label>
        <input type="password" id="currentPassword" class="form-input" 
               placeholder="Enter current password" required>
      </div>
      <div class="form-group">
        <label class="form-label" for="newPassword">New Password</label>
        <input type="password" id="newPassword" class="form-input" 
               placeholder="Enter new password (min 6 characters)" required minlength="6">
      </div>
      <div class="form-group">
        <label class="form-label" for="confirmPassword">Confirm New Password</label>
        <input type="password" id="confirmPassword" class="form-input" 
               placeholder="Confirm new password" required>
      </div>
      <div class="btn-group">
        <button type="submit" class="btn btn-primary">
          üîë Change Password
        </button>
        <button type="button" class="btn btn-secondary" id="cancelPasswordChange">
          ‚úñÔ∏è Cancel
        </button>
      </div>
    </form>
  </div>
  
  <!-- Google Users -->
  <div id="googlePasswordMessage" style="display: none;">
    <p style="color: var(--text-light); margin-bottom: 1.5rem;">
      Since you're signed in with Google, password changes are managed through your Google account.
    </p>
    <a href="https://myaccount.google.com/security" target="_blank" class="btn btn-primary">
      Manage Google Account Security ‚Üí
    </a>
  </div>
</div>

      <div class="section-card">
        <div class="section-header">
          <h2><span class="section-icon">üö™</span> Sign Out</h2>
        </div>
        <p style="color: var(--text-light); margin-bottom: 1.5rem;">
          Sign out from your Mountainside Aces account on this device.
        </p>
        <button class="btn btn-secondary" id="signOutBtn">
          üö™ Sign Out
        </button>
      </div>
    </div>
  </main>

  <!-- Team Selection Modal -->
  <div class="modal" id="teamModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Favorite Team</h2>
        <button class="modal-close" onclick="closeTeamModal()">‚úñ</button>
      </div>
      <div class="modal-body">
        <input type="text" class="modal-search" id="teamSearch" placeholder="üîç Search teams...">
        <div class="selection-list" id="teamList">
          <!-- Teams will be loaded here -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeTeamModal()">Cancel</button>
        <button class="btn btn-primary" id="confirmTeamBtn" disabled onclick="confirmAddTeam()">
          <span>Add Team</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Player Selection Modal -->
  <div class="modal" id="playerModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Favorite Player</h2>
        <button class="modal-close" onclick="closePlayerModal()">‚úñ</button>
      </div>
      <div class="modal-body">
        <input type="text" class="modal-search" id="playerSearch" placeholder="üîç Search players...">
        <div class="selection-list" id="playerList">
          <!-- Players will be loaded here -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closePlayerModal()">Cancel</button>
        <button class="btn btn-primary" id="confirmPlayerBtn" disabled onclick="confirmAddPlayer()">
          <span>Add Player</span>
        </button>
      </div>
    </div>
  </div>

  <script type="module">
    import { onAuthChange, getCurrentUser, logoutUser, getUserProfile, updateUserProfile as updateUserProfileAuth, addFavoriteTeam, addFavoritePlayer} from './firebase-auth.js';
    import { getAllTeams, getAllPlayerStatsOptimized } from './firebase-data.js';

    let currentUser = null;
    let userProfile = null;
    let selectedTeam = null;
    let selectedPlayer = null;
    let allTeams = [];
    let allPlayers = [];

    console.log('üìÑ Fan Profile page loading...');

    // Tab switching functionality
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const targetTab = tab.dataset.tab;
        
        // Update active tab
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update active content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(`tab-${targetTab}`).classList.add('active');
      });
    });

    // Initialize auth state
    onAuthChange(async (user) => {
      console.log('üîê Auth state changed:', user ? user.email : 'No user');
      
      if (user) {
        currentUser = user;
        try {
          await loadUserProfile(user);
		    const { ensureCorrectProfilePage } = await import('./firebase-auth.js');
			ensureCorrectProfilePage(userProfile, 'profile-fan.html');
        } catch (error) {
          console.error('‚ùå Error loading profile data:', error);
          alert('Error loading profile. Check console for details.');
        } finally {
          hideLoading();
        }
      } else {
        console.log('‚ö†Ô∏è No user signed in, redirecting to signin page...');
        window.location.href = 'signin.html';
      }
    });

async function loadUserProfile(user) {
  console.log('üìã Loading user profile for:', user.uid);
  
  // Check email verification for email/password users FIRST
  const isEmailProvider = user.providerData.some(
    provider => provider.providerId === 'password'
  );
  
  if (isEmailProvider && !user.emailVerified) {
    console.log('‚ö†Ô∏è User email not verified - showing banner');
    document.getElementById('verificationBanner').style.display = 'block';
  } else {
    document.getElementById('verificationBanner').style.display = 'none';
  }
  
  try {
    const result = await getUserProfile(user.uid);
    console.log('‚úÖ User profile result:', result);


    

        
        if (result.success && result.data) {
          userProfile = result.data;
        } else {
          console.log('‚ö†Ô∏è No profile data found');
          userProfile = null;
        }
        
// Determine the display name to use (preferred or Google name)
const displayName = userProfile?.preferredDisplayName || user.displayName || 'User';

// Update header
const photoElement = document.getElementById('profilePhoto');
if (user.photoURL) {
  photoElement.src = user.photoURL;
  photoElement.style.display = 'block';
} else {
  photoElement.style.display = 'none';
}
document.getElementById('displayName').textContent = displayName;
document.getElementById('accountEmail').value = user.email;

// Determine account type based on provider data
let accountType = 'Email/Password';
if (user.providerData && user.providerData.length > 0) {
  const provider = user.providerData[0].providerId;
  if (provider === 'google.com') {
    accountType = 'Google Sign-In';
  } else if (provider === 'password') {
    accountType = 'Email/Password';
  }
}
document.getElementById('accountType').value = accountType;

// NEW: Update password change UI based on account type
updatePasswordChangeUI(user);

// Load the display name form
document.getElementById('preferredDisplayName').value = userProfile?.preferredDisplayName || '';
document.getElementById('googleAccountName').textContent = user.displayName || user.email;
		
		
        
        // Calculate member since
        const createdDate = new Date(user.metadata.creationTime);
        document.getElementById('memberSince').textContent = `Member since ${createdDate.getFullYear()}`;
        
        // Load preferences
        if (userProfile) {
          document.getElementById('favoriteTeamNotifications').checked = userProfile.preferences?.favoriteTeamNotifications ?? true;
          document.getElementById('favoritePlayerAlerts').checked = userProfile.preferences?.favoritePlayerAlerts ?? true;
          document.getElementById('emailScoreUpdates').checked = userProfile.preferences?.emailScoreUpdates ?? false;
          document.getElementById('publicFavorites').checked = userProfile.preferences?.publicFavorites ?? false;
          
          // Load favorites
          loadFavorites();
          updateFavoritesCounts();
        }
      } catch (error) {
        console.error('‚ùå Error loading user profile:', error);
        // Continue anyway, show default values
         const photoElement = document.getElementById('profilePhoto');
  if (user.photoURL) {
    photoElement.src = user.photoURL;
    photoElement.style.display = 'block';
  } else {
    photoElement.style.display = 'none';
  }
        document.getElementById('displayName').textContent = user.displayName || 'User';
        document.getElementById('accountEmail').value = user.email;
      }
    }

// Import password change function
import { changeUserPassword } from './firebase-auth.js';

// Show/hide password change form based on account type
function updatePasswordChangeUI(user) {
  const isEmailProvider = user.providerData.some(
    provider => provider.providerId === 'password'
  );
  
  if (isEmailProvider) {
    document.getElementById('passwordChangeForm').style.display = 'block';
    document.getElementById('googlePasswordMessage').style.display = 'none';
  } else {
    document.getElementById('passwordChangeForm').style.display = 'none';
    document.getElementById('googlePasswordMessage').style.display = 'block';
  }
}

// Handle password change form submission
document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const currentPassword = document.getElementById('currentPassword').value;
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  
  // Validate passwords match
  if (newPassword !== confirmPassword) {
    alert('New passwords do not match');
    return;
  }
  
  // Show loading state
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.disabled = true;
  submitBtn.innerHTML = 'üîÑ Changing Password...';
  
  try {
    const result = await changeUserPassword(currentPassword, newPassword);
    
    if (result.success) {
      // Clear form
      document.getElementById('changePasswordForm').reset();
      
      // Show success message
      showSuccessMessage('successMessagePassword');
      
      // Optional: Sign out user to re-authenticate with new password
      // Uncomment if you want to force re-login after password change
      // setTimeout(() => {
      //   alert('Password changed! Please sign in again with your new password.');
      //   logoutUser().then(() => {
      //     window.location.href = 'signin.html';
      //   });
      // }, 2000);
      
    } else {
      alert(result.message || 'Failed to change password');
    }
  } catch (error) {
    console.error('Error changing password:', error);
    alert('An error occurred while changing password');
  } finally {
    // Restore button
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalText;
  }
});

// Handle cancel button
document.getElementById('cancelPasswordChange').addEventListener('click', () => {
  document.getElementById('changePasswordForm').reset();
});

    function updateFavoritesCounts() {
      const favoriteTeams = userProfile?.favoriteTeams || [];
      const favoritePlayers = userProfile?.favoritePlayers || [];
      
      document.getElementById('favoriteTeamsCount').textContent = favoriteTeams.length;
      document.getElementById('favoritePlayersCount').textContent = favoritePlayers.length;
    }

    function loadFavorites() {
      // Load favorite teams
      const favoriteTeams = userProfile?.favoriteTeams || [];
      const teamsGrid = document.getElementById('favoriteTeamsGrid');
      
      if (favoriteTeams.length === 0) {
        teamsGrid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üèÜ</div>
            <div class="empty-state-text">No favorite teams yet</div>
            <p>Click "Add Team" to start tracking your favorites</p>
          </div>
        `;
      } else {
        teamsGrid.innerHTML = favoriteTeams.map(team => `
          <div class="favorite-card">
            <button class="remove-favorite" data-type="team" data-name="${team}">‚úñ</button>
            <div class="favorite-card-header">
              <div class="favorite-icon">üèÜ</div>
              <div class="favorite-card-title">${team}</div>
            </div>
            <div class="favorite-stats">
              <a href="team.html?team=${encodeURIComponent(team)}">View team page ‚Üí</a>
            </div>
          </div>
        `).join('');
      }
      
      // Load favorite players
      const favoritePlayers = userProfile?.favoritePlayers || [];
      const playersGrid = document.getElementById('favoritePlayersGrid');
      
      if (favoritePlayers.length === 0) {
        playersGrid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚≠ê</div>
            <div class="empty-state-text">No favorite players yet</div>
            <p>Click "Add Player" to start tracking up to 10 favorites</p>
          </div>
        `;
      } else {
        playersGrid.innerHTML = favoritePlayers.map(player => `
          <div class="favorite-card">
            <button class="remove-favorite" data-type="player" data-name="${player}">‚úñ</button>
            <div class="favorite-card-header">
              <div class="favorite-icon">‚≠ê</div>
              <div class="favorite-card-title">${player}</div>
            </div>
            <div class="favorite-stats">
              <a href="player.html?name=${encodeURIComponent(player)}">View player stats ‚Üí</a>
            </div>
          </div>
        `).join('');
      }
      
      // Add event listeners for remove buttons
      document.querySelectorAll('.remove-favorite').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const type = e.target.dataset.type;
          const name = e.target.dataset.name;
          removeFavorite(type, name);
        });
      });
    }

    // Handle display name form submission
    document.getElementById('displayNameForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const preferredDisplayName = document.getElementById('preferredDisplayName').value.trim();
      
      try {
        const updates = {
          preferredDisplayName: preferredDisplayName || null
        };
        
        const result = await updateUserProfileAuth(currentUser.uid, updates);
        if (!result.success) {
          throw new Error('Update failed');
        }
        
        // Update the local userProfile object
        userProfile.preferredDisplayName = preferredDisplayName || null;
        
        // Update the header display name immediately
        const displayName = preferredDisplayName || currentUser.displayName || 'User';
        document.getElementById('displayName').textContent = displayName;
        
        showSuccessMessage('successMessageDisplayName');
      } catch (error) {
        console.error('Error updating display name:', error);
        alert('Error saving display name. Please try again.');
      }
    });

    // Handle clear display name button
    document.getElementById('clearDisplayName').addEventListener('click', async () => {
      document.getElementById('preferredDisplayName').value = '';
      
      try {
        const updates = {
          preferredDisplayName: null
        };
        
        const result = await updateUserProfileAuth(currentUser.uid, updates);
        if (!result.success) {
          throw new Error('Update failed');
        }
        
        // Update the local userProfile object
        userProfile.preferredDisplayName = null;
        
        // Update the header display name immediately to Google name
        const displayName = currentUser.displayName || 'User';
        document.getElementById('displayName').textContent = displayName;
        
        showSuccessMessage('successMessageDisplayName');
      } catch (error) {
        console.error('Error clearing display name:', error);
        alert('Error clearing display name. Please try again.');
      }
    });

    document.getElementById('preferencesForm').addEventListener('change', async () => {
      const preferences = {
        favoriteTeamNotifications: document.getElementById('favoriteTeamNotifications').checked,
        favoritePlayerAlerts: document.getElementById('favoritePlayerAlerts').checked,
        emailScoreUpdates: document.getElementById('emailScoreUpdates').checked,
        publicFavorites: document.getElementById('publicFavorites').checked
      };
      
      try {
        const result = await updateUserProfileAuth(currentUser.uid, { preferences });
        if (result.success) {
          showSuccessMessage('successMessagePreferences');
        }
      } catch (error) {
        console.error('Error updating preferences:', error);
      }
    });

    document.getElementById('signOutBtn').addEventListener('click', async () => {
      try {
        const result = await logoutUser();
        if (result.success) {
          window.location.href = 'index.html';
        }
      } catch (error) {
        console.error('Error signing out:', error);
      }
    });

    // Add favorite buttons
    document.getElementById('addFavoriteTeam').addEventListener('click', async () => {
      await openTeamModal();
    });

    document.getElementById('addFavoritePlayer').addEventListener('click', async () => {
      const favoritePlayers = userProfile?.favoritePlayers || [];
      if (favoritePlayers.length >= 10) {
        alert('You can only have up to 10 favorite players. Remove some to add more.');
        return;
      }
      await openPlayerModal();
    });

    async function removeFavorite(type, name) {
      if (!confirm(`Remove ${name} from favorites?`)) return;
      
      try {
        const field = type === 'team' ? 'favoriteTeams' : 'favoritePlayers';
        const current = userProfile[field] || [];
        const updated = current.filter(item => item !== name);
        
        const result = await updateUserProfileAuth(currentUser.uid, { [field]: updated });
        if (result.success) {
          userProfile[field] = updated;
          loadFavorites();
          updateFavoritesCounts();
        } else {
          throw new Error('Update failed');
        }
      } catch (error) {
        console.error('Error removing favorite:', error);
        alert('Error removing favorite. Please try again.');
      }
    }

    function showSuccessMessage(id) {
      const msg = document.getElementById(id);
      msg.classList.add('show');
      setTimeout(() => {
        msg.classList.remove('show');
      }, 3000);
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.add('hidden');
    }

    // Team Modal Functions
    async function openTeamModal() {
      console.log('üìã Opening team modal...');
      
      if (allTeams.length === 0) {
        try {
          allTeams = await getAllTeams();
          console.log(`‚úÖ Loaded ${allTeams.length} teams`);
        } catch (error) {
          console.error('‚ùå Error loading teams:', error);
          alert('Error loading teams. Please try again.');
          return;
        }
      }

      renderTeamList(allTeams);
      document.getElementById('teamModal').classList.add('show');
      
      const searchInput = document.getElementById('teamSearch');
      searchInput.value = '';
      searchInput.addEventListener('input', handleTeamSearch);
    }

    function renderTeamList(teams) {
      const list = document.getElementById('teamList');
      list.innerHTML = '';

      const favoriteTeams = userProfile?.favoriteTeams || [];
      const sortedTeams = [...teams].sort((a, b) => 
        (a.name || a.id).localeCompare(b.name || b.id)
      );

      sortedTeams.forEach(team => {
        const teamName = team.name || team.id;
        const isAlreadyFavorite = favoriteTeams.includes(teamName);
        
        const item = document.createElement('div');
        item.className = 'selection-item';
        if (isAlreadyFavorite) {
          item.classList.add('disabled');
        }
        
        item.innerHTML = `
          <div class="selection-item-info">
            <div class="selection-item-name">${teamName}</div>
            <div class="selection-item-details">${team.description || 'Team'}</div>
          </div>
          ${isAlreadyFavorite ? '<span class="selection-item-badge">Already Added</span>' : ''}
        `;
        
        if (!isAlreadyFavorite) {
          item.addEventListener('click', () => selectTeam(item, teamName));
        }
        
        list.appendChild(item);
      });
    }

    function selectTeam(element, teamName) {
      document.querySelectorAll('#teamList .selection-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      element.classList.add('selected');
      selectedTeam = teamName;
      document.getElementById('confirmTeamBtn').disabled = false;
    }

    function handleTeamSearch(e) {
      const term = e.target.value.toLowerCase();
      
      document.querySelectorAll('#teamList .selection-item').forEach(item => {
        const name = item.querySelector('.selection-item-name').textContent.toLowerCase();
        if (name.includes(term)) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    }

    async function confirmAddTeam() {
      if (!selectedTeam || !currentUser) return;
      
      const confirmBtn = document.getElementById('confirmTeamBtn');
      const btnText = confirmBtn.querySelector('span');
      confirmBtn.disabled = true;
      btnText.textContent = 'Adding...';
      
      try {
        const result = await addFavoriteTeam(currentUser.uid, selectedTeam);
        
        if (result.success) {
          if (!userProfile.favoriteTeams) userProfile.favoriteTeams = [];
          userProfile.favoriteTeams.push(selectedTeam);
          loadFavorites();
          updateFavoritesCounts();
          closeTeamModal();
        } else {
          throw new Error('Failed to add team');
        }
      } catch (error) {
        console.error('Error adding team:', error);
        alert('Error adding team. Please try again.');
        confirmBtn.disabled = false;
        btnText.textContent = 'Add Team';
      }
    }

    function closeTeamModal() {
      document.getElementById('teamModal').classList.remove('show');
      selectedTeam = null;
      document.getElementById('confirmTeamBtn').disabled = true;
    }

    // Player Modal Functions
    async function openPlayerModal() {
      console.log('üìã Opening player modal...');
      
      if (allPlayers.length === 0) {
        try {
          allPlayers = await getAllPlayerStatsOptimized();
          console.log(`‚úÖ Loaded ${allPlayers.length} players`);
        } catch (error) {
          console.error('‚ùå Error loading players:', error);
          alert('Error loading players. Please try again.');
          return;
        }
      }

      renderPlayerList(allPlayers);
      document.getElementById('playerModal').classList.add('show');
      
      const searchInput = document.getElementById('playerSearch');
      searchInput.value = '';
      searchInput.addEventListener('input', handlePlayerSearch);
    }

    function renderPlayerList(players) {
      const list = document.getElementById('playerList');
      list.innerHTML = '';

      const favoritePlayers = userProfile?.favoritePlayers || [];
      const sortedPlayers = [...players].sort((a, b) => 
        (a.name || a.playerName || a.id).localeCompare(b.name || b.playerName || b.id)
      );

      sortedPlayers.forEach(player => {
        const playerName = player.name || player.playerName || player.id;
        const isAlreadyFavorite = favoritePlayers.includes(playerName);
        
        const careerGames = player.career?.games || 0;
        const careerBA = player.career?.battingAverage 
          ? player.career.battingAverage.toFixed(3) 
          : '0.000';
        const team = player.currentTeam || 'Unknown';
        
        const item = document.createElement('div');
        item.className = 'selection-item';
        if (isAlreadyFavorite) {
          item.classList.add('disabled');
        }
        
        item.innerHTML = `
          <div class="selection-item-info">
            <div class="selection-item-name">${playerName}</div>
            <div class="selection-item-details">${team} ‚Ä¢ ${careerGames} games ‚Ä¢ BA: ${careerBA}</div>
          </div>
          ${isAlreadyFavorite ? '<span class="selection-item-badge">Already Added</span>' : ''}
        `;
        
        if (!isAlreadyFavorite) {
          item.addEventListener('click', () => selectPlayer(item, playerName));
        }
        
        list.appendChild(item);
      });
    }

    function selectPlayer(element, playerName) {
      document.querySelectorAll('#playerList .selection-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      element.classList.add('selected');
      selectedPlayer = playerName;
      document.getElementById('confirmPlayerBtn').disabled = false;
    }

    function handlePlayerSearch(e) {
      const term = e.target.value.toLowerCase();
      
      document.querySelectorAll('#playerList .selection-item').forEach(item => {
        const name = item.querySelector('.selection-item-name').textContent.toLowerCase();
        const details = item.querySelector('.selection-item-details').textContent.toLowerCase();
        if (name.includes(term) || details.includes(term)) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    }

    async function confirmAddPlayer() {
      if (!selectedPlayer || !currentUser) return;
      
      const confirmBtn = document.getElementById('confirmPlayerBtn');
      const btnText = confirmBtn.querySelector('span');
      confirmBtn.disabled = true;
      btnText.textContent = 'Adding...';
      
      try {
        const result = await addFavoritePlayer(currentUser.uid, selectedPlayer);
        
        if (result.success) {
          if (!userProfile.favoritePlayers) userProfile.favoritePlayers = [];
          userProfile.favoritePlayers.push(selectedPlayer);
          loadFavorites();
          updateFavoritesCounts();
          closePlayerModal();
        } else {
          throw new Error('Failed to add player');
        }
      } catch (error) {
        console.error('Error adding player:', error);
        alert('Error adding player. Please try again.');
        confirmBtn.disabled = false;
        btnText.textContent = 'Add Player';
      }
    }

    function closePlayerModal() {
      document.getElementById('playerModal').classList.remove('show');
      selectedPlayer = null;
      document.getElementById('confirmPlayerBtn').disabled = true;
    }

    // Make functions available globally for onclick handlers
    window.closeTeamModal = closeTeamModal;
    window.confirmAddTeam = confirmAddTeam;
    window.closePlayerModal = closePlayerModal;
    window.confirmAddPlayer = confirmAddPlayer;
  </script>
  
  <script type="module">
    import { NavigationComponent } from './nav-component.js';
    // Navigation auto-initializes on load!
  </script>
</body>
</html>