<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In - Mountainside Aces</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 450px;
      width: 100%;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #e1e5e9;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      font-size: 16px;
      font-weight: 600;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: -2px;
    }
    
    .tab:hover {
      color: #667eea;
    }
    
    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .google-signin-btn {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 14px 24px;
      background: white;
      border: 2px solid #dadce0;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      color: #3c4043;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 20px;
    }
    
    .google-signin-btn:hover {
      border-color: #667eea;
      background: #f8f9fa;
      transform: translateY(-1px);
    }
    
    .google-signin-btn img {
      width: 24px;
      height: 24px;
    }
    
    .divider {
      display: flex;
      align-items: center;
      gap: 16px;
      margin: 25px 0;
      color: #666;
      font-size: 14px;
    }
    
    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #e1e5e9;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    
    input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.2s;
    }
    
    input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .btn-primary {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }
    
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .alert {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    .alert-success {
      background: #d1fae5;
      border: 1px solid #10b981;
      color: #065f46;
    }
    
    .alert-error {
      background: #fee;
      border: 1px solid #f87171;
      color: #991b1b;
    }
    
    .alert-info {
      background: #dbeafe;
      border: 1px solid #3b82f6;
      color: #1e40af;
    }
    
    .help-text {
      font-size: 13px;
      color: #666;
      margin-top: 5px;
    }
    
    .link {
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
    }
    
    .link:hover {
      text-decoration: underline;
    }
    
    .text-center {
      text-align: center;
      margin-top: 20px;
      font-size: 14px;
      color: #666;
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid white;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      margin-left: 8px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>⚾ Welcome</h1>
    <p class="subtitle">Mountainside Aces Baseball League</p>
    
    <div id="alertContainer"></div>
    
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('signin')">Sign In</button>
      <button class="tab" onclick="switchTab('signup')">Sign Up</button>
    </div>
    
    <!-- Sign In Tab -->
    <div id="signin-tab" class="tab-content active">
      <button class="google-signin-btn" onclick="handleGoogleSignIn()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
        Continue with Google
      </button>
      
      <div class="divider">or sign in with email</div>
      
      <form onsubmit="handleEmailSignIn(event)">
        <div class="form-group">
          <label for="signin-email">Email</label>
          <input type="email" id="signin-email" required autocomplete="email">
        </div>
        
        <div class="form-group">
          <label for="signin-password">Password</label>
          <input type="password" id="signin-password" required autocomplete="current-password">
        </div>
        
        <div class="form-group" style="margin-bottom: 25px;">
          <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
            <input type="checkbox" id="remember-me" style="width: auto; margin-right: 8px;">
            Keep me signed in
          </label>
        </div>
        
        <button type="submit" class="btn-primary" id="signin-btn">
          Sign In
        </button>
      </form>
      
      <div class="text-center">
        <a href="#" class="link" onclick="showForgotPassword(); return false;">Forgot password?</a>
      </div>
    </div>
    
    <!-- Sign Up Tab -->
    <div id="signup-tab" class="tab-content">
      <button class="google-signin-btn" onclick="handleGoogleSignIn()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
        Continue with Google
      </button>
      
      <div class="divider">or sign up with email</div>
      
      <form onsubmit="handleEmailSignUp(event)">
        <div class="form-group">
          <label for="signup-name">Full Name</label>
          <input type="text" id="signup-name" required autocomplete="name">
          <p class="help-text">This will be your display name</p>
        </div>
        
        <div class="form-group">
          <label for="signup-email">Email</label>
          <input type="email" id="signup-email" required autocomplete="email">
        </div>
        
        <div class="form-group">
          <label for="signup-password">Password</label>
          <input type="password" id="signup-password" required minlength="6" autocomplete="new-password">
          <p class="help-text">At least 6 characters</p>
        </div>
        
        <div class="form-group">
          <label for="signup-password-confirm">Confirm Password</label>
          <input type="password" id="signup-password-confirm" required minlength="6" autocomplete="new-password">
        </div>
        
        <button type="submit" class="btn-primary" id="signup-btn">
          Create Account
        </button>
      </form>
      
      <div class="text-center">
        By signing up, you agree to link your account to your player profile
      </div>
    </div>
    
    <!-- Forgot Password Modal (Simple) -->
    <div id="forgot-password-section" style="display: none;">
      <h2 style="margin-bottom: 20px;">Reset Password</h2>
      
      <form onsubmit="handlePasswordReset(event)">
        <div class="form-group">
          <label for="reset-email">Email</label>
          <input type="email" id="reset-email" required>
          <p class="help-text">We'll send you a password reset link</p>
        </div>
        
        <button type="submit" class="btn-primary" id="reset-btn">
          Send Reset Link
        </button>
      </form>
      
      <div class="text-center">
        <a href="#" class="link" onclick="hideForgotPassword(); return false;">Back to sign in</a>
      </div>
    </div>
  </div>
  
  <script type="module">
    import { 
      loginWithGoogle, 
      loginUser, 
      registerUser,
      resetPassword,
      onAuthChange,
      setAuthPersistence
    } from './firebase-auth.js';
    
    // Alert helper
    function showAlert(message, type = 'info') {
      const container = document.getElementById('alertContainer');
      container.innerHTML = `
        <div class="alert alert-${type}">
          ${message}
        </div>
      `;
      
      // Auto-hide success messages after 5 seconds
      if (type === 'success') {
        setTimeout(() => {
          container.innerHTML = '';
        }, 5000);
      }
    }
    
    // Tab switching
    window.switchTab = function(tab) {
      // Get the event target (the clicked tab button)
      const clickedTab = event?.target || document.querySelector(`.tab[onclick*="${tab}"]`);
      
      // Update tabs
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      if (clickedTab) {
        clickedTab.classList.add('active');
      }
      document.getElementById(`${tab}-tab`).classList.add('active');
      
      // Clear alerts
      document.getElementById('alertContainer').innerHTML = '';
    };
    
    // Google Sign-In
    window.handleGoogleSignIn = async function() {
      showAlert('Signing in with Google...', 'info');
      
      const result = await loginWithGoogle();
      
      if (result.success) {
        showAlert('✅ Signed in successfully! Redirecting...', 'success');
        setTimeout(() => {
          window.location.href = 'link-player.html';
        }, 1500);
      } else {
        showAlert(`❌ Sign-in failed: ${result.message}`, 'error');
      }
    };
    
    // Email Sign-In
    window.handleEmailSignIn = async function(event) {
      event.preventDefault();
      
      const email = document.getElementById('signin-email').value;
      const password = document.getElementById('signin-password').value;
      const rememberMe = document.getElementById('remember-me').checked;
      const btn = document.getElementById('signin-btn');
      
      btn.disabled = true;
      btn.innerHTML = 'Signing in<span class="loading"></span>';
      
      // Set persistence based on "remember me" checkbox
      await setAuthPersistence(rememberMe);
      
      const result = await loginUser(email, password);
      
      if (result.success) {
        // Check if email is verified
        if (!result.user.emailVerified) {
          showAlert('⚠️ Please verify your email. We sent a verification link to your inbox.', 'error');
          btn.disabled = false;
          btn.textContent = 'Sign In';
          return;
        }
        
        showAlert('✅ Signed in successfully! Redirecting...', 'success');
        setTimeout(() => {
          window.location.href = 'link-player.html';
        }, 1500);
      } else {
        showAlert(`❌ ${result.message}`, 'error');
        btn.disabled = false;
        btn.textContent = 'Sign In';
      }
    };
    
    // Email Sign-Up
    window.handleEmailSignUp = async function(event) {
      event.preventDefault();
      
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const passwordConfirm = document.getElementById('signup-password-confirm').value;
      const btn = document.getElementById('signup-btn');
      
      // Validate passwords match
      if (password !== passwordConfirm) {
        showAlert('❌ Passwords do not match', 'error');
        return;
      }
      
      btn.disabled = true;
      btn.innerHTML = 'Creating account<span class="loading"></span>';
      
      const result = await registerUser(email, password, name);
      
      if (result.success) {
        showAlert('✅ Account created! Please check your email and click the verification link before signing in.', 'success');
        
        // Switch to sign-in tab after 4 seconds
        setTimeout(() => {
          const tabs = document.querySelectorAll('.tab');
          tabs[0].click(); // Click Sign In tab
          document.getElementById('signin-email').value = email;
          showAlert('📧 Verification email sent! Check your inbox, then sign in.', 'info');
        }, 4000);
      } else {
        showAlert(`❌ ${result.message}`, 'error');
      }
      
      btn.disabled = false;
      btn.textContent = 'Create Account';
    };
    
    // Forgot Password
    window.showForgotPassword = function() {
      document.getElementById('signin-tab').style.display = 'none';
      document.getElementById('forgot-password-section').style.display = 'block';
      document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
    };
    
    window.hideForgotPassword = function() {
      document.getElementById('signin-tab').style.display = 'block';
      document.getElementById('forgot-password-section').style.display = 'none';
      document.querySelectorAll('.tab').forEach(t => t.style.display = 'block');
    };
    
    window.handlePasswordReset = async function(event) {
      event.preventDefault();
      
      const email = document.getElementById('reset-email').value;
      const btn = document.getElementById('reset-btn');
      
      btn.disabled = true;
      btn.innerHTML = 'Sending<span class="loading"></span>';
      
      const result = await resetPassword(email);
      
      if (result.success) {
        showAlert('✅ Password reset email sent! Check your inbox.', 'success');
        setTimeout(() => {
          hideForgotPassword();
        }, 2000);
      } else {
        showAlert(`❌ ${result.message}`, 'error');
      }
      
      btn.disabled = false;
      btn.textContent = 'Send Reset Link';
    };
    
    // Listen for auth state changes - redirect if already signed in
    onAuthChange((user) => {
      if (user) {
        console.log('User already signed in, redirecting...');
        window.location.href = 'link-player.html';
      }
    });
  </script>
</body>
</html>