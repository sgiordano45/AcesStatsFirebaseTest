<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Team Comparison - Aces Stats</title>
<link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="mobile-enhancements.css">
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
  }
  
  .page-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  .page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-align: center;
    padding: 3rem 2rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  
  .page-header h1 {
    margin: 0;
    font-size: 2.5rem;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }
  
  .page-header p {
    margin: 1rem 0 0 0;
    font-size: 1.1rem;
    opacity: 0.9;
  }
  
  .filters-nav {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.07);
    border: 1px solid #e1e5e9;
  }
  
  .nav-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    justify-content: center;
  }
  
  .nav-link {
    padding: 0.8rem 1.5rem;
    border: 2px solid #667eea;
    background: white;
    color: #667eea;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .nav-link:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
  }
  
  .nav-link.pitching {
    border-color: #11998e;
    color: #11998e;
  }
  
  .nav-link.pitching:hover {
    background: #11998e;
    color: white;
  }

  .comparison-section {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.07);
    border: 1px solid #e1e5e9;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
  }
  
  .comparison-section::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
  }
  
  .comparison-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
  }
  
  .team-selector {
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 25px;
    transition: all 0.3s ease;
  }
  
  .team-selector:hover {
    border-color: #667eea;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
  }
  
  .team-selector h3 {
    margin: 0 0 15px 0;
    text-align: center;
    color: #333;
    font-size: 1.3em;
    font-weight: 600;
  }
  
  .team-select {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    margin-bottom: 15px;
    background: white;
    transition: all 0.3s ease;
  }
  
  .team-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .comparison-type {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin: 30px 0;
  }
  
  .comparison-type button {
    padding: 12px 24px;
    border: 2px solid #667eea;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    background: white;
    color: #667eea;
  }
  
  .comparison-type button.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  }
  
  .comparison-type button:not(.active):hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
  }
  
  #seasonSelector {
    text-align: center;
    margin: 20px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 12px;
    border: 1px solid #e9ecef;
  }
  
  #seasonSelector label {
    margin-right: 15px;
    font-weight: 600;
    color: #333;
    font-size: 16px;
  }
  
  #seasonSelect {
    padding: 10px 15px;
    font-size: 16px;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    background: white;
    min-width: 200px;
  }
  
  #seasonSelect:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .comparison-results {
    margin-top: 30px;
  }
  
  .team-comparison {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 30px;
    margin-bottom: 30px;
  }
  
  .team-stats {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
  }
  
  .team-stats:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
  }
  
  .team-stats h4 {
    margin: 0 0 20px 0;
    text-align: center;
    font-size: 1.4em;
    color: #333;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    font-weight: 700;
  }
  
  .team-logo {
    height: 35px;
    width: auto;
    object-fit: contain;
  }
  
  .stat-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #f1f3f4;
  }
  
  .stat-row:last-child {
    border-bottom: none;
  }
  
  .stat-label {
    font-weight: 600;
    color: #666;
    font-size: 14px;
  }
  
  .stat-value {
    font-weight: bold;
    color: #333;
    font-size: 16px;
  }
  
  .comparison-divider {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5em;
    color: #ccc;
    font-weight: bold;
  }
  
  .no-comparison {
    text-align: center;
    padding: 60px 20px;
    color: #666;
    font-style: italic;
    font-size: 1.1em;
    background: #f8f9fa;
    border-radius: 12px;
    border: 2px dashed #dee2e6;
  }
  
  .record-display {
    font-size: 1.1em;
    background: linear-gradient(135deg, #e8f4f8 0%, #d6eaf8 100%);
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    text-align: center;
    border: 1px solid #85c1e9;
  }
  
  .head-to-head {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border: 2px solid #ffeaa7;
    border-radius: 12px;
    padding: 25px;
    margin: 25px 0;
    text-align: center;
    box-shadow: 0 4px 12px rgba(255, 234, 167, 0.3);
  }
  
  .head-to-head h3 {
    margin: 0 0 20px 0;
    color: #856404;
    font-size: 1.4em;
    font-weight: 700;
  }
  
  .h2h-record {
    font-size: 1.6em;
    font-weight: bold;
    color: #495057;
    margin: 15px 0;
  }
  
  .h2h-breakdown {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  
  .h2h-stat {
    background: rgba(255, 255, 255, 0.8);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #e6d3a3;
    transition: all 0.3s ease;
  }
  
  .h2h-stat:hover {
    background: white;
    transform: translateY(-2px);
  }
  
  .h2h-stat-label {
    font-size: 0.9em;
    color: #6c757d;
    margin-bottom: 8px;
    font-weight: 600;
  }
  
  .h2h-stat-value {
    font-size: 1.1em;
    font-weight: bold;
    color: #495057;
  }
  
  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    .page-container {
      padding: 1rem;
    }
    
    .page-header {
      padding: 2rem 1rem;
    }
    
    .page-header h1 {
      font-size: 2rem;
    }
    
    .nav-container {
      justify-content: center;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .nav-link {
      padding: 10px 15px;
      font-size: 14px;
      text-align: center;
      width: 100%;
      justify-content: center;
    }
    
    .comparison-container {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .team-comparison {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .comparison-divider {
      display: none;
    }
    
    .comparison-type {
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    
    .comparison-type button {
      width: 250px;
      padding: 15px 20px;
    }
    
    .h2h-breakdown {
      grid-template-columns: 1fr;
      gap: 15px;
    }
  }
  
  @media (max-width: 480px) {
    .comparison-section {
      padding: 1.5rem;
    }
    
    .team-selector {
      padding: 20px;
    }
    
    .team-stats {
      padding: 20px;
    }
    
    .team-stats h4 {
      font-size: 1.2em;
      flex-direction: column;
      gap: 8px;
    }
    
    .team-logo {
      height: 30px;
    }
    
    .comparison-type button {
      width: 100%;
      padding: 12px 15px;
      font-size: 14px;
    }
  }
</style>
</head>
<body>
<div class="page-container">
  <div class="page-header">
    <h1>Team Comparison Tool</h1>
    <p>Compare team statistics, head-to-head records, and performance across seasons (2022+)</p>
  </div>

  <div class="filters-nav">
    <nav class="nav-container">
      <a href="index.html" class="nav-link">üè† Home</a>
      <a href="current-season.html" class="nav-link">üçÇ Current Season</a>
      <a href="batting.html" class="nav-link batting">‚öæ Batting Stats</a>
      <a href="pitching.html" class="nav-link pitching">ü•é Pitching Stats</a>
      <a href="teams.html" class="nav-link">üèÜ All Teams</a>
      <a href="players.html" class="nav-link">üë§ All Players</a>
      <a href="seasons.html" class="nav-link">üìÖ All Seasons</a>
      <a href="leaders.html" class="nav-link">üìä Career Leaders</a>
      <a href="compare.html" class="nav-link">‚öñÔ∏è Player Comparison</a>
      <a href="h2h_grid.html" class="nav-link">‚öîÔ∏è Head-to-Head Grid</a>
      <a href="pictures.html" class="nav-link">üì∑ Gallery</a>
      <a href="charts.html" class="nav-link">üìà Performance Charts</a>
    </nav>
  </div>

  <!-- Mobile Navigation -->
  <div class="mobile-nav-container">
    <div class="mobile-nav-header">
      <div class="mobile-nav-title">üÜö Team Comparison</div>
      <button class="hamburger-menu" onclick="toggleMobileMenu()" aria-label="Toggle navigation">‚ò∞</button>
    </div>
    <nav class="mobile-nav-menu" id="mobileNavMenu">
      <a href="index.html" class="mobile-nav-item">üè† Home</a>
      <a href="current-season.html" class="mobile-nav-item">üçÇ Current Season</a>
      <a href="weekend-preview.html" class="mobile-nav-item">üîÆ Weekend Preview</a>
      <a href="projections.html" class="mobile-nav-item">üìà Playoff Projections</a>
      <a href="batting.html" class="mobile-nav-item">‚öæ Batting Stats</a>
      <a href="pitching.html" class="mobile-nav-item">ü•é Pitching Stats</a>
      <a href="teams.html" class="mobile-nav-item">üèÜ All Teams</a>
      <a href="players.html" class="mobile-nav-item">üë§ All Players</a>
      <a href="seasons.html" class="mobile-nav-item">üìÖ All Seasons</a>
      <a href="awards.html" class="mobile-nav-item">üèÖ Awards</a>
      <a href="leaders.html" class="mobile-nav-item">üìä Career Leaders</a>
      <a href="milestones.html" class="mobile-nav-item">üéØ Milestones</a>
      <a href="compare.html" class="mobile-nav-item">üìà Player Comparison</a>
      <a href="team_compare.html" class="mobile-nav-item active">üÜö Team Comparison</a>
      <a href="h2h_grid.html" class="mobile-nav-item">‚öîÔ∏è Head-to-Head Grid</a>
	  <a href="pictures.html" class="mobile-nav-item">üì∑ Gallery</a>
    </nav>
  </div>


  <div class="comparison-section">
    <div class="comparison-container">
      <div class="team-selector">
        <h3>Team 1</h3>
        <select id="team1Select" class="team-select">
          <option value="">Select Team 1...</option>
        </select>
      </div>
      
      <div class="team-selector">
        <h3>Team 2</h3>
        <select id="team2Select" class="team-select">
          <option value="">Select Team 2...</option>
        </select>
      </div>
    </div>

    <div class="comparison-type">
      <button id="allTimeBtn" onclick="switchComparison('allTime')" class="active">All-Time Comparison</button>
      <button id="seasonBtn" onclick="switchComparison('season')">Season Comparison</button>
    </div>

    <div id="seasonSelector" style="display: none;">
      <label for="seasonSelect">Select Season:</label>
      <select id="seasonSelect">
        <option value="">Choose a season...</option>
      </select>
    </div>
  </div>

  <div id="comparisonResults" class="comparison-results">
    <div class="no-comparison">
      Select two teams above to begin comparison
    </div>
  </div>
</div>

<script>
let allBattingData = [];
let allGames = [];
let allAwards = [];
let currentComparison = 'allTime';
let team1Data = null;
let team2Data = null;

// Load batting data, games data, and awards
Promise.all([
  fetch("data.json").then(res => res.json()),
  fetch("games.json").then(res => res.ok ? res.json() : []),
  fetch("awards.json").then(res => res.ok ? res.json() : [])
])
  .then(([battingData, gamesData, awardsData]) => {
    allBattingData = cleanData(battingData);
    allGames = gamesData.filter(g => parseInt(g.year) >= 2022); // Filter games to 2022+
    allAwards = awardsData.filter(a => parseInt(a.Year) >= 2022); // Filter awards to 2022+
    populateTeamSelects();
    // Add URL parameter handling for incoming links from h2h_grid
const urlParams = new URLSearchParams(window.location.search);
const team1Param = urlParams.get('team1');
const team2Param = urlParams.get('team2');

if (team1Param && team2Param) {
  // Auto-select teams after a brief delay to ensure DOM is ready
  setTimeout(() => {
    const team1Select = document.getElementById('team1Select');
    const team2Select = document.getElementById('team2Select');
    
    if (team1Select && team2Select) {
      team1Select.value = team1Param;
      team2Select.value = team2Param;
      updateComparison();
    }
  }, 100);
}
  })
  .catch(error => {
    console.error("Error loading data:", error);
    document.getElementById("comparisonResults").innerHTML = 
      '<div class="no-comparison">Error loading team data. Please check that data files are available.</div>';
  });

function cleanData(data) {
  return data.map(p => ({
    ...p,
    name: p.name ? p.name.trim() : "",
    team: p.team ? p.team.trim() : "",
    season: p.season ? p.season.trim() : "",
    year: p.year ? String(p.year).trim() : "",
    games: Number(p.games) || 0,
    atBats: Number(p.atBats) || 0,
    hits: Number(p.hits) || 0,
    runs: Number(p.runs) || 0,
    walks: Number(p.walks) || 0
  })).filter(p => parseInt(p.year) >= 2022); // Filter out seasons before 2022
}

function populateTeamSelects() {
  // Get unique teams, filter out "Kings"
  const teams = [...new Set(allBattingData.map(p => p.team))]
    .filter(team => team && team.toLowerCase() !== "kings")
    .sort();
  
  const team1Select = document.getElementById('team1Select');
  const team2Select = document.getElementById('team2Select');
  
  teams.forEach(teamName => {
    const option1 = document.createElement('option');
    option1.value = teamName;
    option1.textContent = teamName;
    team1Select.appendChild(option1);
    
    const option2 = document.createElement('option');
    option2.value = teamName;
    option2.textContent = teamName;
    team2Select.appendChild(option2);
  });
  
  team1Select.addEventListener('change', updateComparison);
  team2Select.addEventListener('change', updateComparison);
}

function updateComparison() {
  const team1Name = document.getElementById('team1Select').value;
  const team2Name = document.getElementById('team2Select').value;
  
  if (!team1Name || !team2Name) {
    document.getElementById('comparisonResults').innerHTML = 
      '<div class="no-comparison">Select two teams above to begin comparison</div>';
    return;
  }
  
  if (team1Name === team2Name) {
    document.getElementById('comparisonResults').innerHTML = 
      '<div class="no-comparison">Please select two different teams</div>';
    return;
  }
  
  team1Data = allBattingData.filter(p => p.team === team1Name);
  team2Data = allBattingData.filter(p => p.team === team2Name);
  
  // Re-populate season selector if in season mode
  if (currentComparison === 'season') {
    populateSeasonSelector();
  }
  
  renderComparison();
}

function switchComparison(type) {
  currentComparison = type;
  
  // Update button styles
  const allTimeBtn = document.getElementById('allTimeBtn');
  const seasonBtn = document.getElementById('seasonBtn');
  const seasonSelector = document.getElementById('seasonSelector');
  
  if (type === 'allTime') {
    allTimeBtn.classList.add('active');
    seasonBtn.classList.remove('active');
    seasonSelector.style.display = 'none';
  } else {
    seasonBtn.classList.add('active');
    allTimeBtn.classList.remove('active');
    seasonSelector.style.display = 'block';
    populateSeasonSelector();
  }
  
  renderComparison();
}

function populateSeasonSelector() {
  const seasonSelect = document.getElementById('seasonSelect');
  
  if (!team1Data || !team2Data) return;
  
  // Get all unique seasons from both teams
  const allSeasons = new Set();
  
  team1Data.forEach(player => {
    allSeasons.add(`${player.year}-${player.season}`);
  });
  
  team2Data.forEach(player => {
    allSeasons.add(`${player.year}-${player.season}`);
  });
  
  // Clear existing options except first
  seasonSelect.innerHTML = '<option value="">Choose a season...</option>';
  
  // Sort seasons (most recent first)
  const sortedSeasons = Array.from(allSeasons).sort((a, b) => {
    const [yearA, seasonA] = a.split('-');
    const [yearB, seasonB] = b.split('-');
    
    if (yearB !== yearA) return parseInt(yearB) - parseInt(yearA);
    return seasonB.localeCompare(seasonA);
  });
  
  sortedSeasons.forEach(seasonKey => {
    const [year, season] = seasonKey.split('-');
    const option = document.createElement('option');
    option.value = seasonKey;
    option.textContent = `${year} ${season}`;
    seasonSelect.appendChild(option);
  });
  
  // Remove existing event listeners and add new one
  const newSeasonSelect = seasonSelect.cloneNode(true);
  seasonSelect.parentNode.replaceChild(newSeasonSelect, seasonSelect);
  newSeasonSelect.addEventListener('change', renderComparison);
}

function renderComparison() {
  if (!team1Data || !team2Data) return;
  
  const resultsDiv = document.getElementById('comparisonResults');
  
  if (currentComparison === 'allTime') {
    resultsDiv.innerHTML = renderAllTimeComparison();
  } else {
    const selectedSeason = document.getElementById('seasonSelect').value;
    if (selectedSeason) {
      resultsDiv.innerHTML = renderSeasonComparison(selectedSeason);
    } else {
      resultsDiv.innerHTML = '<div class="no-comparison">Please select a season to compare</div>';
    }
  }
}

function renderAllTimeComparison() {
  const team1Stats = aggregateTeamStats(team1Data, team1Data[0].team);
  const team2Stats = aggregateTeamStats(team2Data, team2Data[0].team);
  
  // Get head-to-head record
  const headToHead = calculateHeadToHead(team1Data[0].team, team2Data[0].team);
  
  return `
    ${headToHead ? renderHeadToHeadSection(headToHead, team1Data[0].team, team2Data[0].team) : ''}
    
    <div class="team-comparison">
      <div class="team-stats">
        <h4>
          <img src="logos/${team1Stats.teamName.toLowerCase()}.png" alt="${team1Stats.teamName} Logo" class="team-logo" onerror="this.style.display='none';">
          ${team1Stats.teamName}
        </h4>
        ${renderTeamStatsRows(team1Stats)}
      </div>
      
      <div class="comparison-divider">VS</div>
      
      <div class="team-stats">
        <h4>
          <img src="logos/${team2Stats.teamName.toLowerCase()}.png" alt="${team2Stats.teamName} Logo" class="team-logo" onerror="this.style.display='none';">
          ${team2Stats.teamName}
        </h4>
        ${renderTeamStatsRows(team2Stats)}
      </div>
    </div>
  `;
}

function renderSeasonComparison(selectedSeason) {
  const [year, season] = selectedSeason.split('-');
  
  // Filter data for specific season
  const team1SeasonData = team1Data.filter(p => p.year === year && p.season === season);
  const team2SeasonData = team2Data.filter(p => p.year === year && p.season === season);
  
  if (team1SeasonData.length === 0 && team2SeasonData.length === 0) {
    return '<div class="no-comparison">Neither team played in the selected season</div>';
  }
  
  const team1Stats = team1SeasonData.length > 0 ? 
    aggregateTeamStats(team1SeasonData, team1Data[0].team, year, season) : null;
  const team2Stats = team2SeasonData.length > 0 ? 
    aggregateTeamStats(team2SeasonData, team2Data[0].team, year, season) : null;
  
  // Get head-to-head record for this season
  const headToHead = calculateHeadToHead(team1Data[0].team, team2Data[0].team, year, season);
  
  return `
    ${headToHead ? renderHeadToHeadSection(headToHead, team1Data[0].team, team2Data[0].team, `${year} ${season}`) : ''}
    
    <div class="team-comparison">
      <div class="team-stats">
        <h4>
          <img src="logos/${team1Data[0].team.toLowerCase()}.png" alt="${team1Data[0].team} Logo" class="team-logo" onerror="this.style.display='none';">
          ${team1Data[0].team} - ${year} ${season}
        </h4>
        ${team1Stats ? renderTeamStatsRows(team1Stats) : '<div style="text-align: center; color: #666; font-style: italic;">Did not play this season</div>'}
      </div>
      
      <div class="comparison-divider">VS</div>
      
      <div class="team-stats">
        <h4>
          <img src="logos/${team2Data[0].team.toLowerCase()}.png" alt="${team2Data[0].team} Logo" class="team-logo" onerror="this.style.display='none';">
          ${team2Data[0].team} - ${year} ${season}
        </h4>
        ${team2Stats ? renderTeamStatsRows(team2Stats) : '<div style="text-align: center; color: #666; font-style: italic;">Did not play this season</div>'}
      </div>
    </div>
  `;
}

function renderTeamStatsRows(stats) {
  return `
    <div class="stat-row">
      <span class="stat-label">Total Players:</span>
      <span class="stat-value">${stats.totalPlayers}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Total Team Games:</span>
      <span class="stat-value">${stats.totalTeamGames}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">At Bats:</span>
      <span class="stat-value">${stats.totalAtBats}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Hits:</span>
      <span class="stat-value">${stats.totalHits}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Runs:</span>
      <span class="stat-value">${stats.totalRuns}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Walks:</span>
      <span class="stat-value">${stats.totalWalks}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Team BA:</span>
      <span class="stat-value">${stats.teamBA}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Team OBP:</span>
      <span class="stat-value">${stats.teamOBP}</span>
    </div>
    ${stats.gameRecord ? `
    <div class="record-display">
      <strong>Record: ${stats.gameRecord}</strong><br>
      <small>Win Percentage: ${stats.winPercentage}</small>
    </div>
    ` : ''}
    <div class="stat-row">
      <span class="stat-label">Seasons Active:</span>
      <span class="stat-value">${stats.seasonsActive}</span>
    </div>
    ${stats.awards ? `
    <div class="stat-row">
      <span class="stat-label">Awards:</span>
      <span class="stat-value">${stats.awards}</span>
    </div>
    ` : ''}
  `;
}

function aggregateTeamStats(teamData, teamName, specificYear = null, specificSeason = null) {
  const uniquePlayers = new Set(teamData.map(p => p.name));
  
  const stats = {
    teamName: teamName,
    totalPlayers: uniquePlayers.size,
    totalGames: 0,
    totalAtBats: 0,
    totalHits: 0,
    totalRuns: 0,
    totalWalks: 0,
    seasonsActive: 0
  };
  
  // Aggregate batting stats
  teamData.forEach(player => {
    stats.totalGames += player.games;
    stats.totalAtBats += player.atBats;
    stats.totalHits += player.hits;
    stats.totalRuns += player.runs;
    stats.totalWalks += player.walks;
  });
  
  // Calculate team batting stats
  stats.teamBA = stats.totalAtBats > 0 ? (stats.totalHits / stats.totalAtBats).toFixed(3) : ".000";
  stats.teamOBP = (stats.totalAtBats + stats.totalWalks) > 0 ? 
    ((stats.totalHits + stats.totalWalks) / (stats.totalAtBats + stats.totalWalks)).toFixed(3) : ".000";
  
  // Count unique seasons
  const uniqueSeasons = new Set(teamData.map(p => `${p.year}-${p.season}`));
  stats.seasonsActive = uniqueSeasons.size;
  
  // Calculate team games from games.json (like teams.html)
  let gameFilter;
  if (specificYear && specificSeason) {
    gameFilter = g => (g["home team"] === teamName || g["away team"] === teamName) && 
                      g.year === specificYear && g.season === specificSeason;
  } else {
    gameFilter = g => g["home team"] === teamName || g["away team"] === teamName;
  }
  
  const teamGames = allGames.filter(gameFilter);
  stats.totalTeamGames = teamGames.length;
  
  if (teamGames.length > 0) {
    const record = calculateTeamRecord(teamName, teamGames);
    stats.gameRecord = `${record.wins}-${record.losses}${record.ties > 0 ? `-${record.ties}` : ''}`;
    stats.winPercentage = record.totalDecidedGames > 0 ? 
      (record.wins / record.totalDecidedGames * 100).toFixed(1) + '%' : '0.0%';
  }
  
  // Get awards for this team
  let awardsFilter;
  if (specificYear && specificSeason) {
    awardsFilter = a => a.Team === teamName && a.Year === specificYear && a.Season === specificSeason;
  } else {
    awardsFilter = a => a.Team === teamName;
  }
  
  const teamAwards = allAwards.filter(awardsFilter);
  if (teamAwards.length > 0) {
    const awardCounts = {};
    teamAwards.forEach(award => {
      const awardType = award.Award.trim();
      if (!awardCounts[awardType]) {
        awardCounts[awardType] = 0;
      }
      awardCounts[awardType]++;
    });
    
    const formattedAwards = Object.entries(awardCounts)
      .map(([awardType, count]) => `${awardType}: ${count}`)
      .join(' | ');
    
    stats.awards = formattedAwards;
  }
  
  return stats;
}

function calculateTeamRecord(teamName, games) {
  let wins = 0, losses = 0, ties = 0;
  
  games.forEach(game => {
    const winner = game.winner;
    
    if (winner === "Tie") {
      ties++;
    } else if (winner === teamName) {
      wins++;
    } else if (winner !== teamName && winner !== "Tie" && !winner.includes("Forfeit")) {
      losses++;
    } else if (winner.includes("Forfeit")) {
      // Handle forfeit cases
      const actualWinner = winner.replace("Forfeit - ", "").replace("Tie", "");
      if (actualWinner === teamName) {
        wins++;
      } else if (actualWinner !== teamName && actualWinner !== "" && actualWinner !== "Tie") {
        losses++;
      } else {
        ties++;
      }
    }
  });
  
  return {
    wins: wins,
    losses: losses,
    ties: ties,
    totalDecidedGames: wins + losses
  };
}

function calculateHeadToHead(team1Name, team2Name, specificYear = null, specificSeason = null) {
  // Filter games where these two teams played each other
  let headToHeadGames = allGames.filter(game => {
    const homeTeam = game["home team"];
    const awayTeam = game["away team"];
    
    const isMatchup = (homeTeam === team1Name && awayTeam === team2Name) ||
                      (homeTeam === team2Name && awayTeam === team1Name);
    
    if (!isMatchup) return false;
    
    // If specific season requested, filter by that
    if (specificYear && specificSeason) {
      return game.year === specificYear && game.season === specificSeason;
    }
    
    return true;
  });
  
  if (headToHeadGames.length === 0) {
    return null;
  }
  
  let team1Wins = 0, team2Wins = 0, ties = 0;
  let regularSeasonGames = 0, playoffGames = 0;
  let team1HomeWins = 0, team1AwayWins = 0;
  let team2HomeWins = 0, team2AwayWins = 0;
  
  headToHeadGames.forEach(game => {
    const homeTeam = game["home team"];
    const awayTeam = game["away team"];
    const winner = game.winner;
    const gameType = game.game_type;
    
    // Count game types
    if (gameType === 'Regular') {
      regularSeasonGames++;
    } else if (gameType === 'Playoff') {
      playoffGames++;
    }
    
    // Determine winner
    let actualWinner = winner;
    if (winner.includes("Forfeit")) {
      actualWinner = winner.replace("Forfeit - ", "").replace("Tie", "");
    }
    
    if (actualWinner === "Tie") {
      ties++;
    } else if (actualWinner === team1Name) {
      team1Wins++;
      if (homeTeam === team1Name) {
        team1HomeWins++;
      } else {
        team1AwayWins++;
      }
    } else if (actualWinner === team2Name) {
      team2Wins++;
      if (homeTeam === team2Name) {
        team2HomeWins++;
      } else {
        team2AwayWins++;
      }
    }
  });
  
  const totalGames = team1Wins + team2Wins + ties;
  const totalDecidedGames = team1Wins + team2Wins;
  
  return {
    team1Name: team1Name,
    team2Name: team2Name,
    team1Wins: team1Wins,
    team2Wins: team2Wins,
    ties: ties,
    totalGames: totalGames,
    totalDecidedGames: totalDecidedGames,
    regularSeasonGames: regularSeasonGames,
    playoffGames: playoffGames,
    team1HomeWins: team1HomeWins,
    team1AwayWins: team1AwayWins,
    team2HomeWins: team2HomeWins,
    team2AwayWins: team2AwayWins,
    team1WinPct: totalDecidedGames > 0 ? (team1Wins / totalDecidedGames * 100).toFixed(1) : '0.0',
    team2WinPct: totalDecidedGames > 0 ? (team2Wins / totalDecidedGames * 100).toFixed(1) : '0.0'
  };
}

function renderHeadToHeadSection(h2h, team1Name, team2Name, seasonInfo = '') {
  const recordText = h2h.ties > 0 ? 
    `${h2h.team1Wins}-${h2h.team2Wins}-${h2h.ties}` : 
    `${h2h.team1Wins}-${h2h.team2Wins}`;
  
  const leadingTeam = h2h.team1Wins > h2h.team2Wins ? team1Name : 
                      h2h.team2Wins > h2h.team1Wins ? team2Name : 'Tied';
  
  return `
    <div class="head-to-head">
      <h3>Head-to-Head Record ${seasonInfo ? `(${seasonInfo})` : '(2022+)'}</h3>
      <div class="h2h-record">
        ${team1Name} ${h2h.team1Wins} - ${h2h.team2Wins} ${team2Name}
        ${h2h.ties > 0 ? ` (${h2h.ties} ties)` : ''}
      </div>
      <div style="font-size: 1em; color: #666; margin: 5px 0;">
        ${h2h.totalGames} total games ‚Ä¢ ${leadingTeam !== 'Tied' ? `${leadingTeam} leads series` : 'Series tied'}
      </div>
      
      <div class="h2h-breakdown">
        <div class="h2h-stat">
          <div class="h2h-stat-label">Win Percentage</div>
          <div class="h2h-stat-value">${team1Name}: ${h2h.team1WinPct}%</div>
          <div class="h2h-stat-value">${team2Name}: ${h2h.team2WinPct}%</div>
        </div>
        
        ${h2h.regularSeasonGames > 0 || h2h.playoffGames > 0 ? `
        <div class="h2h-stat">
          <div class="h2h-stat-label">By Game Type</div>
          ${h2h.regularSeasonGames > 0 ? `<div class="h2h-stat-value">Regular: ${h2h.regularSeasonGames}</div>` : ''}
          ${h2h.playoffGames > 0 ? `<div class="h2h-stat-value">Playoff: ${h2h.playoffGames}</div>` : ''}
        </div>
        ` : ''}
        
        <div class="h2h-stat">
          <div class="h2h-stat-label">${team1Name} Home/Away</div>
          <div class="h2h-stat-value">Home: ${h2h.team1HomeWins} wins</div>
          <div class="h2h-stat-value">Away: ${h2h.team1AwayWins} wins</div>
        </div>
        
        <div class="h2h-stat">
          <div class="h2h-stat-label">${team2Name} Home/Away</div>
          <div class="h2h-stat-value">Home: ${h2h.team2HomeWins} wins</div>
          <div class="h2h-stat-value">Away: ${h2h.team2AwayWins} wins</div>
        </div>
      </div>
    </div>
  `;
}
</script>
 <script src="mobile-enhancements.js"></script>
</body>
</html>
