<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#2d5016">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Mountainside Aces">
<title>Mountainside Aces - Softball Statistics Hub</title>
<link rel="stylesheet" href="mobile-enhancements.css">
<link rel="stylesheet" href="nav-styles.css">
<link rel="stylesheet" href="style.css">
<style>
  :root {
    --primary-color: #2d5016;
    --secondary-color: #1a6b4a;
    --accent-color: #ffd700;
    --card-bg: #ffffff;
    --text-dark: #2d3748;
    --text-light: #718096;
    --border-color: #e2e8f0;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
    --shadow-lg: 0 12px 32px rgba(0,0,0,0.16);
  }

  * {
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    min-height: 100vh;
    color: var(--text-dark);
  }
  
  /* Softball-themed loading spinner */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 1;
    transition: opacity 0.5s ease;
  }

  .loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .softball-spinner {
    width: 80px;
    height: 80px;
    position: relative;
    animation: spin 1.5s ease-in-out infinite;
  }

  .softball-spinner::before {
    content: '⚾';
    font-size: 80px;
    position: absolute;
    top: 0;
    left: 0;
  }

  @keyframes spin {
    0%, 100% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(1.1); }
  }

  /* Top Navigation Bar */
  .top-nav-bar {
    background: white;
    box-shadow: var(--shadow-sm);
    position: sticky;
    top: 0;
    z-index: 1000;
    border-bottom: 1px solid var(--border-color);
  }

  .top-nav-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .nav-logo {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .auth-section {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .auth-button {
    padding: 0.6rem 1.5rem;
    border: 2px solid var(--primary-color);
    background: white;
    color: var(--primary-color);
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .auth-button:hover {
    background: var(--primary-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .auth-button.primary {
    background: var(--primary-color);
    color: white;
  }

  .auth-button.primary:hover {
    background: var(--secondary-color);
  }

  .user-profile-nav {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--primary-color);
  }

  .user-name {
    font-weight: 600;
    color: var(--text-dark);
  }

  /* Header with softball pattern */
  .header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    text-align: center;
    padding: 4rem 2rem;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
  }

  .header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    border-radius: 50%;
  }

  .header::after {
    content: '⚾';
    position: absolute;
    bottom: -30px;
    left: 10%;
    font-size: 120px;
    opacity: 0.15;
    transform: rotate(-15deg);
  }
  
  .header h1 {
    margin: 0;
    font-size: 3.5rem;
    font-weight: 800;
    text-shadow: 2px 4px 8px rgba(0,0,0,0.2);
    letter-spacing: -0.5px;
    position: relative;
    z-index: 1;
  }
  
  .header p {
    margin: 1rem 0 0 0;
    font-size: 1.3rem;
    opacity: 0.95;
    font-weight: 300;
    position: relative;
    z-index: 1;
  }

  /* Scrolling News Banner */
  .news-banner {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    color: white;
    overflow: hidden;
    white-space: nowrap;
    position: relative;
    box-shadow: 0 4px 12px rgba(238,90,36,0.3);
    border-bottom: 3px solid #c23616;
  }

  .news-content {
    display: inline-block;
    padding: 14px 0;
    animation: scroll-left 60s linear infinite;
    font-weight: 600;
    font-size: 1.1rem;
  }

  .news-item {
    display: inline-block;
    margin-right: 50px;
    padding: 0 20px;
    position: relative;
  }

  .news-item::after {
    content: "⚾";
    position: absolute;
    right: -25px;
    top: 0;
    font-size: 1rem;
  }

  .news-announcement {
    color: #ffd700;
    font-weight: bold;
  }

  .news-score {
    color: #ffffff;
  }

  .news-winner {
    color: #00ff88;
    font-weight: bold;
  }

  .news-upcoming {
    color: #87ceeb;
    font-weight: 600;
  }

  @keyframes scroll-left {
    0% { transform: translateX(25%); }
    100% { transform: translateX(-100%); }
  }

  .news-banner:hover .news-content {
    animation-play-state: paused;
  }
  
  .dashboard-container {
    max-width: 1400px;
    margin: 3rem auto;
    padding: 0 2rem;
  }
  
  .section {
    margin-bottom: 4rem;
  }
  
  /* Modern section titles */
  .section-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
  }
  
  .section-title::before {
    content: "";
    display: inline-block;
    width: 8px;
    height: 36px;
    background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-radius: 4px;
  }

  .section-title::after {
    content: '';
    flex: 1;
    height: 2px;
    background: linear-gradient(90deg, var(--border-color) 0%, transparent 100%);
    margin-left: 1rem;
  }
  
  /* Modern card grid with better spacing */
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }
  
  /* Enhanced modern cards */
  .card {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 2rem;
    box-shadow: var(--shadow-sm);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
    cursor: pointer;
  }

  /* Gradient accent bar */
  .card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .card:hover::before {
    opacity: 1;
  }

  /* Subtle background pattern on hover */
  .card::after {
    content: '⚾';
    position: absolute;
    bottom: -20px;
    right: -20px;
    font-size: 120px;
    opacity: 0;
    transition: all 0.4s ease;
    color: var(--primary-color);
  }
  
  .card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-color);
  }

  .card:hover::after {
    opacity: 0.05;
    bottom: -10px;
    right: -10px;
  }
  
  .card-link {
    text-decoration: none;
    color: inherit;
    display: block;
  }
  
  .card-icon {
    font-size: 3rem;
    margin-bottom: 1.25rem;
    display: inline-block;
    transition: transform 0.4s ease;
  }

  .card:hover .card-icon {
    transform: scale(1.15) rotate(5deg);
  }
  
  .card-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.75rem;
    letter-spacing: -0.3px;
  }
  
  .card-description {
    color: var(--text-light);
    font-size: 1rem;
    line-height: 1.7;
    margin-bottom: 1.5rem;
  }
  
  .card-stats {
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
    color: var(--text-light);
    font-size: 0.9rem;
  }

  .card-stats div {
    margin: 0.5rem 0;
  }

  /* Seasonal highlight cards */
  .seasonal-card {
    background: linear-gradient(135deg, #ff7b7b 0%, #ff6b6b 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .seasonal-card::before {
    background: linear-gradient(90deg, var(--accent-color) 0%, #ffed4e 100%);
    opacity: 1;
  }

  .seasonal-card::after {
    color: white;
  }
  
  .seasonal-card .card-title,
  .seasonal-card .card-description,
  .seasonal-card .card-stats {
    color: white;
  }
  
  .seasonal-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Deep Winter Navy Card */
  .midnight-card {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .midnight-card::before {
    background: linear-gradient(90deg, #5f9ea0 0%, #4682b4 100%);
    opacity: 1;
  }

  .midnight-card::after {
    content: '🌙';
    color: white;
  }

  .midnight-card .card-title,
  .midnight-card .card-description,
  .midnight-card .card-stats {
    color: white;
  }

  .midnight-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  .note {
    background: white;
    padding: 20px;
    border-radius: 12px;
    margin-top: 30px;
    box-shadow: var(--shadow-sm);
  }

  .note h3 {
    color: var(--text-dark);
    margin-top: 0;
  }

  .note code {
    background: #f7fafc;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    color: #e53e3e;
  }


  /* Autumn themed card */
  .autumn-card {
    background: linear-gradient(135deg, #d2691e 0%, #ff8c00 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }
  
  .autumn-card::before {
    background: linear-gradient(90deg, #ff8c00 0%, #ff7f00 100%);
    opacity: 1;
  }

  .autumn-card::after {
    color: white;
  }
  
  .autumn-card .card-title,
  .autumn-card .card-description,
  .autumn-card .card-stats {
    color: white;
  }
  
  .autumn-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Pumpkin themed card */
  .pumpkin-card {
    background: linear-gradient(135deg, #ff6347 0%, #ff8c42 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .pumpkin-card::before {
    background: linear-gradient(90deg, #ff8c42 0%, #ffa500 100%);
    opacity: 1;
  }

  .pumpkin-card::after {
    color: white;
  }

  .pumpkin-card .card-title,
  .pumpkin-card .card-description,
  .pumpkin-card .card-stats {
    color: white;
  }

  .pumpkin-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Harvest themed card */
  .harvest-card {
    background: linear-gradient(135deg, #8b4513 0%, #cd853f 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }
  
  .harvest-card::before {
    background: linear-gradient(90deg, #cd853f 0%, #daa520 100%);
    opacity: 1;
  }

  .harvest-card::after {
    color: white;
  }
  
  .harvest-card .card-title,
  .harvest-card .card-description,
  .harvest-card .card-stats {
    color: white;
  }
  
  .harvest-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Main stats cards with forest green theme */
  .main-stats-card {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .main-stats-card::before {
    background: linear-gradient(90deg, var(--accent-color) 0%, #ffed4e 100%);
    opacity: 1;
  }

  .main-stats-card::after {
    color: white;
  }
  
  .main-stats-card .card-icon,
  .main-stats-card .card-title,
  .main-stats-card .card-description,
  .main-stats-card .card-stats {
    color: white;
  }
  
  .main-stats-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Pitching card with teal theme */
  .pitching-card {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .pitching-card::before {
    background: linear-gradient(90deg, #38ef7d 0%, #4ade80 100%);
    opacity: 1;
  }

  .pitching-card::after {
    color: white;
  }
  
  .pitching-card .card-icon,
  .pitching-card .card-title,
  .pitching-card .card-description,
  .pitching-card .card-stats {
    color: white;
  }
  
  .pitching-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Purple themed card for personalization */
  .purple-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .purple-card::before {
    background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
    opacity: 1;
  }

  .purple-card::after {
    color: white;
  }
  
  .purple-card .card-icon,
  .purple-card .card-title,
  .purple-card .card-description,
  .purple-card .card-stats {
    color: white;
  }
  
  .purple-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Color-coded category cards */
  .card.batting {
    border-left: 4px solid #f56565;
  }

  .card.batting .card-icon {
    color: #f56565;
  }

  .card.pitching {
    border-left: 4px solid #4299e1;
  }

  .card.pitching .card-icon {
    color: #4299e1;
  }

  .card.teams {
    border-left: 4px solid #48bb78;
  }

  .card.teams .card-icon {
    color: #48bb78;
  }

  .card.awards {
    border-left: 4px solid #ed8936;
  }

  .card.awards .card-icon {
    color: #ed8936;
  }

  .card.media {
    border-left: 4px solid #9f7aea;
  }

  .card.media .card-icon {
    color: #9f7aea;
  }

  /* Quick access navigation */
  .quick-access {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 2.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
  }
  
  .quick-nav {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
  }
  
  .nav-btn {
    padding: 1rem 1.75rem;
    border: 2px solid var(--primary-color);
    background: white;
    color: var(--primary-color);
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    position: relative;
    overflow: hidden;
  }

  .nav-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--primary-color);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: -1;
  }
  
  .nav-btn:hover {
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .nav-btn:hover::before {
    transform: translateX(0);
  }

  .nav-btn.primary {
    background: var(--primary-color);
    color: white;
  }
  
  .nav-btn.primary:hover {
    background: var(--secondary-color);
  }
  
  /* Responsive Design */
  @media (max-width: 768px) {
    .top-nav-content {
      padding: 1rem;
    }

    .nav-logo {
      font-size: 1rem;
    }

    .auth-button {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
    }

    .user-name {
      display: none;
    }

    .header h1 {
      font-size: 2.5rem;
    }

    .header::after {
      font-size: 80px;
      bottom: -20px;
    }
    
    .section-title {
      font-size: 1.6rem;
    }

    .section-title::after {
      display: none;
    }
    
    .cards-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    
    .quick-nav {
      flex-direction: column;
    }
    
    .nav-btn {
      width: 100%;
      justify-content: center;
    }

    .dashboard-container {
      margin: 2rem auto;
      padding: 0 1.25rem;
    }
  }

  /* Smooth scroll behavior */
  html {
    scroll-behavior: smooth;
  }

  /* Fade in animation for cards */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .card {
    animation: fadeInUp 0.6s ease backwards;
  }

  .card:nth-child(1) { animation-delay: 0.1s; }
  .card:nth-child(2) { animation-delay: 0.2s; }
  .card:nth-child(3) { animation-delay: 0.3s; }
  .card:nth-child(4) { animation-delay: 0.4s; }
  .card:nth-child(5) { animation-delay: 0.5s; }
  .card:nth-child(6) { animation-delay: 0.6s; }
</style>
</head>
<body>

  <!-- Loading Spinner -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="softball-spinner"></div>
  </div>


  <!-- Top Navigation Bar -->
  <div class="top-nav-bar">
    <div class="top-nav-content">
      <div class="nav-logo">
        <span>⚾</span>
        <span>Mountainside Aces</span>
      </div>
      <div class="auth-section" id="authSection">
        <!-- Auth buttons will be dynamically inserted here by auth.js -->
        <a href="signin.html" class="auth-button">Sign In</a>
        <a href="signup.html" class="auth-button primary">Sign Up</a>
      </div>
    </div>
  </div>

  <!-- Scrolling News Banner -->
  <div class="news-banner">
    <div class="news-content" id="newsContent">
      <!-- Content will be dynamically loaded -->
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <h1>⚾️ Mountainside Aces</h1>
    <p>Softball Statistics Hub</p>
  </header>

  <!-- Global Search Bar -->
  <div class="global-search-container">
    <div class="search-wrapper">
      <div class="search-icon">🔍</div>
      <input 
        type="text" 
        class="global-search-input" 
        placeholder="Search players, teams, seasons..."
        id="globalSearch"
        autocomplete="off"
      >
      <button class="clear-search" id="clearSearch">✕</button>
    </div>
    <div class="search-results" id="searchResults">
      <!-- Results will be populated here -->
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard-container">
    
    <!-- Current Season Section -->
    <section class="section">
      <h2 class="section-title">Current Season</h2>
      <div class="cards-grid">
        <a href="current-season.html" class="card-link">
          <div class="card seasonal-card">
            <div class="card-icon">🍂</div>
            <h3 class="card-title">2025 Fall Season</h3>
            <p class="card-description">View current standings, upcoming schedule, past results, and projected playoff bracket</p>
            <div class="card-stats">
              <div>📊 Live standings & playoff tracker</div>
              <div>📅 Complete schedule & results</div>
              <div>🏆 Season Hitting Leaders</div>
            </div>
          </div>
        </a>
        
        <a href="weekend-preview.html" class="card-link">
          <div class="card autumn-card">
            <div class="card-icon">🔮</div>
            <h3 class="card-title">Weekend Preview</h3>
            <p class="card-description">High-level overview of upcoming weekend games with matchup analysis and betting odds</p>
            <div class="card-stats">
              <div>⚔️ Team matchups & records</div>
              <div>🎯 Game previews & predictions</div>
              <div>🃏 Odds and analysis</div>
            </div>
          </div>
        </a>

        <a href="league-rules.html" class="card-link">
          <div class="card harvest-card">
            <div class="card-icon">⚖️</div>
            <h3 class="card-title">Game and Roster Rules</h3>
            <p class="card-description">Official league rules, game formats, and player eligibility requirements</p>
            <div class="card-stats">
              <div>📋 Roster Rules</div>
              <div>🛡️ General Game and Scheduling Rules</div>
            </div>
          </div>
        </a>
                
        <a href="projections.html" class="card-link">
          <div class="card pumpkin-card">
            <div class="card-icon">🎱</div>
            <h3 class="card-title">Playoff Predictor</h3>
            <p class="card-description">Use your crystal ball and simulate the rest of the season to see the expected playoff bracket</p>
            <div class="card-stats">
              <div>🔮 See the future and predict the final standings</div>
              <div>👻 Simulate thousands of possible season outcomes</div>
            </div>
          </div>
        </a>
      </div>
    </section>

<!-- My Dashboard Section (Hidden by default, shown when user is signed in) -->
    <section class="section" id="personalizationSection" style="display: none;">
      <h2 class="section-title">My Dashboard</h2>
      <div class="cards-grid">
        <a href="profile.html" class="card-link">
          <div class="card main-stats-card">
            <div class="card-icon">👤</div>
            <h3 class="card-title">My Profile</h3>
            <p class="card-description">View your personal statistics, achievements, and player history</p>
            <div class="card-stats">
              <div>📊 Personal stats dashboard</div>
              <div>🏆 Your achievements & awards</div>
              <div>📈 Career progression</div>
            </div>
          </div>
        </a>
    <a href="roster-management.html" class="card-link">
      <div class="card harvest-card">
        <div class="card-icon">✉️</div>
        <h3 class="card-title">Game RSVP</h3>
        <p class="card-description">RSVP to upcoming games so your captain knows you're coming</p>
        <div class="card-stats">
          <!-- JavaScript will populate this based on captain status -->
        </div>
      </div>
    </a>
        <a href="favorites.html" class="card-link">
          <div class="card purple-card">
            <div class="card-icon">⭐</div>
            <h3 class="card-title">My Favorites</h3>
            <p class="card-description">Quick access to your favorite players, teams, and seasons</p>
            <div class="card-stats">
              <div>❤️ Saved players & teams</div>
              <div>📌 Bookmarked content</div>
              <div>🔔 Follow your favorites</div>
            </div>
          </div>
        </a>
        <!-- Game Tracker Card (Only shown for captains and staff) -->
        <a href="game-tracker.html" class="card-link" id="gameTrackerCard" style="display: none;">
          <div class="card pitching-card">
            <div class="card-icon">🔶</div>
            <h3 class="card-title">Game Tracker</h3>
            <p class="card-description">Track live game stats, batting order, and play-by-play action</p>
            <div class="card-stats">
              <div>⚾ Live game tracking</div>
              <div>📋 Batting order management</div>
              <div>🎯 Real-time statistics</div>
            </div>
          </div>
        </a>
		<!-- Linked Player Approvals (Only shown for admin, league staff & captains ) -->
        <a href="approve-links.html" class="card-link" id="approvalsCard" style="display: none;">
          <div class="card pumpkin-card">
            <div class="card-icon">✅</div>
            <h3 class="card-title">Staff & Player Approvals</h3>
            <p class="card-description">Approve player links, team staff, etc</p>
          </div>
        </a>
		<!-- Offseason Hub -->
        <a href="offseason.html" class="card-link" id="offseasonCard" style="display: none;">
          <div class="card midnight-card">
            <div class="card-icon">🎣</div>
            <h3 class="card-title">Offseason Hub</h3>
            <p class="card-description">Shift players across rosters, analyze the proposed schedule</p>
          </div>
        </a>
      </div>
    </section>

    <!-- Statistics Section -->
    <section class="section">
      <h2 class="section-title">Statistics</h2>
      <div class="cards-grid">
        <a href="batting.html" class="card-link">
          <div class="card main-stats-card">
            <div class="card-icon">⚾</div>
            <h3 class="card-title">Batting Statistics</h3>
            <p class="card-description">Complete batting statistics for all players across all seasons</p>
            <div class="card-stats">
              <div>📊 Advanced metrics & career leaders</div>
              <div>🏆 Filter by season, team, or player</div>
            </div>
          </div>
        </a>
        
        <a href="pitching.html" class="card-link">
          <div class="card pitching-card">
            <div class="card-icon">🥎</div>
            <h3 class="card-title">Pitching Statistics</h3>
            <p class="card-description">Comprehensive pitching stats and analytics</p>
            <div class="card-stats">
              <div>📈 ERA, strikeouts, innings pitched</div>
              <div>🎯 Advanced pitching metrics</div>
            </div>
          </div>
        </a>
      </div>
    </section>

    <!-- Teams & Players Section -->
    <section class="section">
      <h2 class="section-title">Teams & Players</h2>
      <div class="cards-grid">
        <a href="teams.html" class="card-link">
          <div class="card">
            <div class="card-icon">🏆</div>
            <h3 class="card-title">All Teams</h3>
            <p class="card-description">Team profiles, rosters, and championship history</p>
            <div class="card-stats">
              <div>🎖️ Championship records</div>
              <div>👥 Complete roster information</div>
            </div>
          </div>
        </a>
        
        <a href="players.html" class="card-link">
          <div class="card">
            <div class="card-icon">👥</div>
            <h3 class="card-title">All Players</h3>
            <p class="card-description">Individual player profiles and career statistics</p>
            <div class="card-stats">
              <div>📈 Career progression tracking</div>
              <div>🏅 Awards and achievements</div>
            </div>
          </div>
        </a>
        
        <a href="h2h_grid.html" class="card-link">
          <div class="card">
            <div class="card-icon">⚔️</div>
            <h3 class="card-title">Head to Head Grid</h3>
            <p class="card-description">Summary of Head to Head Aces Match-Up</p>
            <div class="card-stats">
              <div>🆚 Summary of Head to Head Performance</div>
              <div>🏅 Rivalry Stats and Records</div>
            </div>
          </div>
        </a>
      </div>
    </section>

    <!-- League Information Section -->
    <section class="section">
      <h2 class="section-title">League Information</h2>
      <div class="cards-grid">
        <a href="seasons.html" class="card-link">
          <div class="card">
            <div class="card-icon">📅</div>
            <h3 class="card-title">All Seasons</h3>
            <p class="card-description">Browse statistics and results by season and year</p>
            <div class="card-stats">
              <div>📊 Historical season data</div>
              <div>🏆 Championship results</div>
            </div>
          </div>
        </a>
        
        <a href="awards.html" class="card-link">
          <div class="card">
            <div class="card-icon">🏅</div>
            <h3 class="card-title">League Awards</h3>
            <p class="card-description">MVP, batting champions, and special recognitions</p>
            <div class="card-stats">
              <div>🏆 Seasonal award winners</div>
              <div>⭐ Special achievements</div>
            </div>
          </div>
        </a>
        
        <a href="leaders.html" class="card-link">
          <div class="card">
            <div class="card-icon">👑</div>
            <h3 class="card-title">Career Leaders</h3>
            <p class="card-description">All-time statistical leaders and records</p>
            <div class="card-stats">
              <div>📈 Batting & pitching leaders</div>
              <div>🎯 League records</div>
            </div>
          </div>
        </a>
        
        <a href="milestones.html" class="card-link">
          <div class="card">
            <div class="card-icon">🎯</div>
            <h3 class="card-title">Batting Milestones</h3>
            <p class="card-description">Career milestones for players who have reached significant thresholds</p>
            <div class="card-stats">
              <div>🎯 Hits</div>
              <div>🏃 Runs</div>
              <div>🚶 Walks</div>
            </div>
          </div>
        </a>
        
        <a href="pictures.html" class="card-link">
          <div class="card">
            <div class="card-icon">📷</div>
            <h3 class="card-title">Aces Media Gallery</h3>
            <p class="card-description">See the photos & videos of the Aces over the years!</p>
            <div class="card-stats">
              <div>🎥 Photos & Videos from over the years</div>
              <div>🎬 Game Day Action Shots</div>
              <div>🎭 Off the Field Memories</div>
            </div>
          </div>
        </a>
      </div>
    </section>
    
    <!-- Tools Section -->
    <section class="section">
      <h2 class="section-title">Tools</h2>
      <div class="cards-grid">
        <a href="compare.html" class="card-link">
          <div class="card">
            <div class="card-icon">🔀</div>
            <h3 class="card-title">Player Comparisons</h3>
            <p class="card-description">Side-by-side comparison tool for analyzing player performance across careers or specific seasons.</p>
            <div class="card-stats">
              <div>🎖️ Career comparisons</div>
              <div>📈 Season analysis</div>
              <div>🆚 Head-to-head stats</div>
            </div>
          </div>
        </a>
        
        <a href="team_compare.html" class="card-link">
          <div class="card">
            <div class="card-icon">🆚</div>
            <h3 class="card-title">Team Comparisons</h3>
            <p class="card-description">Side-by-side comparison tool for analyzing team performance across careers or specific seasons</p>
            <div class="card-stats">
              <div>🆚 Head to Head Record</div>
              <div>📊 Team Synopsis</div>
              <div>🏅 Award Summary</div>
            </div>
          </div>
        </a>
        
        <a href="charts.html" class="card-link">
          <div class="card">
            <div class="card-icon">📊</div>
            <h3 class="card-title">Performance Charts</h3>
            <p class="card-description">Interactive charts and visualizations showing team performance comparisons, win/loss records, batting statistics, and season standings with export capabilities.</p>
            <div class="card-stats">
              <div>📈 Team and Player Charts</div>
              <div>🖼️ Data Visualization</div>
              <div>💾 Export Functionality</div>
            </div>
          </div>
        </a>
      </div>
    </section>

    <!-- Quick Access Section -->
    <section class="section">
      <div class="quick-access">
        <h3 style="margin-bottom: 1.5rem; color: #333;">Quick Access</h3>
        <div class="quick-nav">
          <a href="current-season.html" class="nav-btn primary">🍂 Current Season</a>
          <a href="weekend-preview.html" class="nav-btn">🔮 Weekend Preview</a>
          <a href="league-rules.html" class="nav-btn">⚖️ Rules</a>
          <a href="batting.html" class="nav-btn">⚾ Batting Stats</a>
          <a href="pitching.html" class="nav-btn">🥎 Pitching Stats</a>
          <a href="teams.html" class="nav-btn">🏆 Teams</a>
          <a href="players.html" class="nav-btn">👥 Players</a>
          <a href="seasons.html" class="nav-btn">📅 Seasons</a>
          <a href="https://acesmountainside.com/" class="nav-btn" target="_blank" rel="noopener noreferrer">🛒 ACES SHOP</a>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Hide loading spinner after page loads
    window.addEventListener('load', function() {
      setTimeout(function() {
        document.getElementById('loadingOverlay').classList.add('hidden');
      }, 800);
    });
  </script>

  <script src="mobile-enhancements.js"></script>
  
  <!-- Auth State Management -->


 <!-- Replace the auth state change handler in index.html (around line 1106-1230) with this: -->

<!-- Replace the auth state change handler in index.html (around line 1106-1230) with this: -->

<script type="module">
  import { auth, onAuthChange, getUserProfile, USER_ROLES } from './firebase-auth.js';
  
  const authSection = document.getElementById('authSection');
  const personalizationSection = document.getElementById('personalizationSection');
  
  // Mobile auth is handled by nav-component.js, not directly here

  // Listen for auth state changes
  onAuthChange(async (user) => {
    console.log('🔍 Auth state changed:', user ? user.email : 'No user');
    
    if (user) {
      // User is signed in
      console.log('✅ User signed in:', user.email);
      
      let displayName = user.displayName || user.email.split('@')[0];
      let profile = null;
      
      try {
        const profileResult = await getUserProfile(user.uid);
        if (profileResult.success && profileResult.data) {
          profile = profileResult.data;
          
          if (profile.preferredDisplayName) {
            displayName = profile.preferredDisplayName;
            console.log('✅ Using preferred display name:', displayName);
          }
        }
      } catch (error) {
        console.error('⚠️ Could not load user profile:', error);
      }
      
      // Show personalization section
      if (personalizationSection) {
        personalizationSection.style.display = 'block';
        
        // Update sections based on profile
        if (profile) {
          updateRSVPCard(profile);
          updateGameTrackerCard(profile);
          updateApprovalsCard(profile);
		  updateOffseasonCard(profile);
        }
      }
      
      // Update desktop auth section
      authSection.innerHTML = `
        <div class="user-profile-nav">
          <a href="profile.html" class="auth-button">
            <span>👤</span>
            <span class="user-name">${displayName}</span>
          </a>
          <a href="favorites.html" class="auth-button">
            <span>⭐</span>
            <span>Favorites</span>
          </a>
          <button class="auth-button" id="signOutBtn">Sign Out</button>
        </div>
      `;
      
      // ⭐ KEY FIX: Add event listeners AFTER creating the buttons
      // Use setTimeout to ensure DOM is fully updated
      setTimeout(() => {
        const signOutBtn = document.getElementById('signOutBtn');
        
        if (signOutBtn) {
          signOutBtn.addEventListener('click', handleSignOut);
          console.log('✅ Desktop sign-out button listener attached');
        } else {
          console.error('❌ Could not find signOutBtn');
        }
      }, 0);
      
    } else {
      // User is signed out
      if (personalizationSection) {
        personalizationSection.style.display = 'none';
      }
      
      authSection.innerHTML = `
        <a href="signin.html" class="auth-button">Sign In</a>
        <a href="signup.html" class="auth-button primary">Sign Up</a>
      `;
    }
  });

  // ⭐ Separate sign-out handler function
  async function handleSignOut() {
    console.log('🚪 Sign out clicked');
    try {
      await auth.signOut();
      console.log('✅ User signed out successfully');
      window.location.reload();
    } catch (error) {
      console.error('❌ Sign out error:', error);
      alert('Error signing out. Please try again.');
    }
  }

  // Helper functions for updating cards
  function updateRSVPCard(profile) {
    const rsvpCardStats = document.querySelector('#personalizationSection .harvest-card .card-stats');
    if (!rsvpCardStats) return;
    
    const userRole = profile.userRole;
    const canManageLineups = userRole === USER_ROLES.ADMIN || 
                             userRole === USER_ROLES.LEAGUE_STAFF || 
                             userRole === USER_ROLES.CAPTAIN ||
                             userRole === USER_ROLES.TEAM_STAFF;
    
    const hasTeamRole = profile.teamRoles && 
      Object.values(profile.teamRoles).some(
        teamRole => (teamRole.role === USER_ROLES.CAPTAIN || 
                     teamRole.role === USER_ROLES.TEAM_STAFF) && 
                    teamRole.status === 'active'
      );
    
    const isCaptainLegacy = profile.isCaptain === true;
    const hasManagementAccess = canManageLineups || hasTeamRole || isCaptainLegacy;
    
    let statsHTML = '<div>📅 Update all games at once</div>';
    if (hasManagementAccess) {
      statsHTML += '<div>📌 Set Batting Line-Ups</div>';
      statsHTML += '<div>🔄 Preset your Defense Rotation</div>';
    }
    
    rsvpCardStats.innerHTML = statsHTML;
  }

  function updateGameTrackerCard(profile) {
    const gameTrackerCard = document.getElementById('gameTrackerCard');
    if (!gameTrackerCard) return;
    
    const userRole = profile.userRole;
    const canTrackGames = userRole === USER_ROLES.ADMIN || 
                          userRole === USER_ROLES.LEAGUE_STAFF || 
                          userRole === USER_ROLES.CAPTAIN ||
                          userRole === USER_ROLES.TEAM_STAFF;
    
    const hasTeamRole = profile.teamRoles && 
      Object.values(profile.teamRoles).some(
        teamRole => (teamRole.role === USER_ROLES.CAPTAIN || 
                     teamRole.role === USER_ROLES.TEAM_STAFF) && 
                    teamRole.status === 'active'
      );
    
    const isCaptainLegacy = profile.isCaptain === true;
    
    if (canTrackGames || hasTeamRole || isCaptainLegacy) {
      gameTrackerCard.style.display = 'block';
    } else {
      gameTrackerCard.style.display = 'none';
    }
  }

  function updateApprovalsCard(profile) {
    const approvalsCard = document.getElementById('approvalsCard');
    if (!approvalsCard) return;
    
    const userRole = profile.userRole;
    const canApprove = userRole === USER_ROLES.ADMIN || 
                       userRole === USER_ROLES.LEAGUE_STAFF || 
                       userRole === USER_ROLES.CAPTAIN;
    
    const isCaptainViaTeamRoles = profile.teamRoles && 
      Object.values(profile.teamRoles).some(
        teamRole => teamRole.role === USER_ROLES.CAPTAIN && teamRole.status === 'active'
      );
    
    const isCaptainLegacy = profile.isCaptain === true;
    
    if (canApprove || isCaptainViaTeamRoles || isCaptainLegacy) {
      approvalsCard.style.display = 'block';
    } else {
      approvalsCard.style.display = 'none';
    }
  }
    function updateOffseasonCard(profile) {
    const offseasonCard = document.getElementById('offseasonCard');
    if (!offseasonCard) return;
    
    const userRole = profile.userRole;
    const canApprove = userRole === USER_ROLES.ADMIN || 
                       userRole === USER_ROLES.LEAGUE_STAFF || 
                       userRole === USER_ROLES.CAPTAIN;
    
    const isCaptainViaTeamRoles = profile.teamRoles && 
      Object.values(profile.teamRoles).some(
        teamRole => teamRole.role === USER_ROLES.CAPTAIN && teamRole.status === 'active'
      );
    
    const isCaptainLegacy = profile.isCaptain === true;
    
    if (canApprove || isCaptainViaTeamRoles || isCaptainLegacy) {
      offseasonCard.style.display = 'block';
    } else {
      offseasonCard.style.display = 'none';
    }
  }
</script>
  
  <script type="module">
  // Global Search Functionality - CONVERTED TO FIREBASE
  import {
    getAllPlayerStatsOptimized,
    getCurrentSeason,
    getSeasonGames,
    getAllSeasons
  } from './firebase-data.js';

  class GlobalSearch {
    constructor() {
      this.searchInput = document.getElementById('globalSearch');
      this.searchResults = document.getElementById('searchResults');
      this.clearButton = document.getElementById('clearSearch');
      
      if (!this.searchInput || !this.searchResults || !this.clearButton) {
        console.warn('Global search elements not found');
        return;
      }
      
      this.allData = [];
      this.allTeams = [];
      this.allSeasons = [];
      this.currentHighlight = -1;
      this.searchTimeout = null;
      
      this.init();
    }
    
    async init() {
      await this.loadData();
      this.bindEvents();
    }
    
    async loadData() {
      try {
        console.log('🔍 Loading search data from Firebase...');
        
        const capitalize = (str) => str ? str.charAt(0).toUpperCase() + str.slice(1) : "";
        
        const [allPlayerStats, seasons] = await Promise.all([
          getAllPlayerStatsOptimized(),
          getAllSeasons()
        ]);
        
        console.log(`✅ Loaded ${allPlayerStats.length} players, ${seasons.length} seasons`);
        
        let awardsData = [];
        try {
          const { db, collection, getDocs } = await import('./firebase-config.js');
          const awardsSnapshot = await getDocs(collection(db, 'awards'));
          
          awardsSnapshot.forEach(doc => {
            const data = doc.data();
            awardsData.push({
              Player: data.playerName || data.Player,
              Award: data.category || data.Award,
              Year: data.year || (data.seasonId ? data.seasonId.split('-')[0] : ''),
              Season: data.season || (data.seasonId ? data.seasonId.split('-')[1] : '')
            });
          });
          
          console.log(`✅ Loaded ${awardsData.length} awards from Firebase`);
        } catch (error) {
          console.warn('Could not load awards from Firebase:', error);
          awardsData = [];
        }
        
        const gamePromises = seasons.map(async (season) => {
          try {
            const seasonGames = await getSeasonGames(season.id);
            return seasonGames.map(g => {
              let dateString = "";
              try {
                if (g.date && g.date.seconds) {
                  const dateObj = new Date(g.date.seconds * 1000);
                  const month = dateObj.getMonth() + 1;
                  const day = dateObj.getDate();
                  const year = dateObj.getFullYear();
                  dateString = `${month}/${day}/${year}`;
                } else if (g.date) {
                  dateString = g.date;
                }
              } catch (dateError) {
                console.warn('Date parsing error:', dateError);
                dateString = "";
              }
              
              return {
                "home team": g.homeTeamName || capitalize(g.homeTeamId) || "",
                "away team": g.awayTeamName || capitalize(g.awayTeamId) || "",
                "home score": g.homeScore !== undefined ? g.homeScore : null,
                "away score": g.awayScore !== undefined ? g.awayScore : null,
                winner: capitalize(g.winner || ""),
                game_type: g.gameType || "Regular",
                date: dateString,
                year: season.year.toString(),
                season: capitalize(season.season || "")
              };
            });
          } catch (err) {
            console.warn(`Could not load games for season ${season.id}:`, err);
            return [];
          }
        });
        
        const allSeasonGames = await Promise.all(gamePromises);
        const gamesData = allSeasonGames.flat();
        
        console.log(`✅ Loaded ${gamesData.length} total games`);
        
        this.allData = this.processPlayerData(allPlayerStats, awardsData);
        this.allTeams = this.processTeamData(allPlayerStats, gamesData);
        this.allSeasons = this.processSeasonData(seasons, gamesData);
        
        console.log('✅ Search data processed:', {
          players: this.allData.length,
          teams: this.allTeams.length,
          seasons: this.allSeasons.length
        });
        
      } catch (error) {
        console.error('❌ Error loading search data:', error);
        console.error('Error stack:', error.stack);
        this.allData = [];
        this.allTeams = [];
        this.allSeasons = [];
      }
    }
    
    processPlayerData(allPlayerStats, awardsData) {
      const playerMap = {};
      
      allPlayerStats.forEach(player => {
        const name = player.playerName || player.name || player.id;
        if (!name) return;
        
        if (!playerMap[name]) {
          playerMap[name] = {
            name: name,
            teams: new Set(),
            games: 0,
            atBats: 0,
            hits: 0,
            runs: 0,
            walks: 0,
            mostRecentTeam: player.currentTeam || "",
            awards: 0
          };
        }
        
        const p = playerMap[name];
        
        if (player.currentTeam) {
          p.teams.add(player.currentTeam);
          p.mostRecentTeam = player.currentTeam;
        }
        
        p.games += Number(player.careerGames || 0);
        p.atBats += Number(player.careerAtBats || 0);
        p.hits += Number(player.careerHits || 0);
        p.runs += Number(player.careerRuns || 0);
        p.walks += Number(player.careerWalks || 0);
        
        if (p.games === 0 && player.seasons) {
          Object.values(player.seasons).forEach(season => {
            p.games += Number(season.games || 0);
            p.atBats += Number(season.atBats || 0);
            p.hits += Number(season.hits || 0);
            p.runs += Number(season.runs || 0);
            p.walks += Number(season.walks || 0);
          });
        }
      });
      
      awardsData.forEach(award => {
        if (!award.Player) return;
        const name = award.Player.trim();
        if (playerMap[name]) {
          playerMap[name].awards++;
        }
      });
      
      return Object.values(playerMap).map(player => ({
        ...player,
        team: player.mostRecentTeam,
        avg: player.atBats > 0 ? (player.hits / player.atBats) : 0,
        teamCount: player.teams.size,
        type: 'player'
      }));
    }
    
    processTeamData(allPlayerStats, gamesData) {
      const teamStats = {};
      
      allPlayerStats.forEach(player => {
        const team = player.currentTeam;
        if (!team) return;
        
        if (!teamStats[team]) {
          teamStats[team] = {
            name: team,
            players: new Set(),
            totalGames: 0,
            wins: 0,
            losses: 0,
            type: 'team'
          };
        }
        teamStats[team].players.add(player.playerName || player.name || player.id);
      });
      
      gamesData.forEach(game => {
        const homeTeam = game["home team"];
        const awayTeam = game["away team"];
        const winner = game.winner;
        
        if (teamStats[homeTeam]) {
          teamStats[homeTeam].totalGames++;
          if (winner === homeTeam) {
            teamStats[homeTeam].wins++;
          } else if (winner !== "Tie" && winner) {
            teamStats[homeTeam].losses++;
          }
        }
        
        if (teamStats[awayTeam]) {
          teamStats[awayTeam].totalGames++;
          if (winner === awayTeam) {
            teamStats[awayTeam].wins++;
          } else if (winner !== "Tie" && winner) {
            teamStats[awayTeam].losses++;
          }
        }
      });
      
      return Object.values(teamStats).map(team => ({
        ...team,
        pct: (team.wins + team.losses) > 0 ? team.wins / (team.wins + team.losses) : 0,
        playerCount: team.players.size
      }));
    }
    
    processSeasonData(seasons, gamesData) {
      const seasonStats = {};
      
      seasons.forEach(season => {
        const key = `${season.year}_${season.season}`;
        seasonStats[key] = {
          year: season.year,
          season: season.season,
          teams: new Set(),
          players: new Set(),
          games: 0,
          type: 'season'
        };
      });
      
      gamesData.forEach(game => {
        const key = `${game.year}_${game.season}`;
        if (seasonStats[key]) {
          seasonStats[key].games++;
          seasonStats[key].teams.add(game["home team"]);
          seasonStats[key].teams.add(game["away team"]);
        }
      });
      
      return Object.values(seasonStats).map(season => ({
        ...season,
        teamCount: season.teams.size,
        playerCount: 0
      }));
    }
    
    bindEvents() {
      this.searchInput.addEventListener('input', (e) => {
        this.handleSearch(e.target.value);
      });
      
      this.searchInput.addEventListener('keydown', (e) => {
        this.handleKeyNavigation(e);
      });
      
      this.searchInput.addEventListener('focus', () => {
        if (this.searchInput.value.trim()) {
          this.showResults();
        }
      });
      
      this.clearButton.addEventListener('click', () => {
        this.clearSearch();
      });
      
      document.addEventListener('click', (e) => {
        if (!this.searchInput.contains(e.target) && !this.searchResults.contains(e.target)) {
          this.hideResults();
        }
      });
    }
    
    handleSearch(query) {
      if (this.searchTimeout) {
        clearTimeout(this.searchTimeout);
      }
      
      this.clearButton.classList.toggle('show', query.length > 0);
      
      if (query.trim().length === 0) {
        this.hideResults();
        return;
      }
      
      this.searchTimeout = setTimeout(() => {
        this.performSearch(query.trim());
      }, 150);
    }
    
    performSearch(query) {
      const results = {
        players: this.searchPlayers(query),
        teams: this.searchTeams(query),
        seasons: this.searchSeasons(query)
      };
      
      const shouldPrioritizeTeams = this.shouldPrioritizeTeams(query, results);
      this.displayResults(results, query, shouldPrioritizeTeams);
    }
    
    shouldPrioritizeTeams(query, results) {
      const q = query.toLowerCase().trim();
      
      return results.teams.some(team => {
        const teamName = team.name.toLowerCase();
        return teamName === q || teamName.startsWith(q) || q.startsWith(teamName);
      });
    }
    
    searchPlayers(query) {
      const q = query.toLowerCase();
      return this.allData
        .filter(player =>
          player.name.toLowerCase().includes(q) ||
          player.team.toLowerCase().includes(q)
        )
        .slice(0, 8)
        .map(player => ({
          ...player,
          type: 'player'
        }));
    }
    
    searchTeams(query) {
      const q = query.toLowerCase();
      return this.allTeams
        .filter(team => team.name.toLowerCase().includes(q))
        .slice(0, 5)
        .map(team => ({
          ...team,
          type: 'team'
        }));
    }
    
    searchSeasons(query) {
      const q = query.toLowerCase();
      return this.allSeasons
        .filter(season =>
          season.year.toString().includes(query) ||
          season.season.toLowerCase().includes(q) ||
          `${season.year} ${season.season}`.toLowerCase().includes(q)
        )
        .sort((a, b) => {
          if (a.year !== b.year) {
            return b.year - a.year;
          }
          if (a.season === b.season) return 0;
          return a.season === 'Fall' ? -1 : 1;
        })
        .slice(0, 6)
        .map(season => ({
          ...season,
          type: 'season'
        }));
    }
    
    displayResults(results, query, prioritizeTeams = false) {
      const totalResults = results.players.length + results.teams.length + results.seasons.length;
      
      if (totalResults === 0) {
        this.searchResults.innerHTML = `
          <div class="no-results">
            No results found for "${query}"
          </div>
        `;
        this.showResults();
        return;
      }
      
      let html = '';
      
      if (prioritizeTeams) {
        if (results.teams.length > 0) {
          html += this.renderTeamsSection(results.teams, query);
        }
        if (results.players.length > 0) {
          html += this.renderPlayersSection(results.players, query);
        }
      } else {
        if (results.players.length > 0) {
          html += this.renderPlayersSection(results.players, query);
        }
        if (results.teams.length > 0) {
          html += this.renderTeamsSection(results.teams, query);
        }
      }
      
      if (results.seasons.length > 0) {
        html += this.renderSeasonsSection(results.seasons, query);
      }
      
      this.searchResults.innerHTML = html;
      this.showResults();
      this.bindResultEvents();
    }
    
    renderPlayersSection(players, query) {
      return `
        <div class="search-category">
          <div class="category-header">Players</div>
          ${players.map(player => `
            <div class="search-item" data-type="player" data-name="${player.name}" data-team="${player.team}">
              <div class="search-item-icon">👤</div>
              <div class="search-item-content">
                <div class="search-item-title">${this.highlightMatch(player.name, query)}</div>
               <div class="search-item-subtitle">  <span class="team-badge-${player.team.toLowerCase()}">${player.team}</span> • ${player.games} games </div>
              </div>
              <div class="search-item-stats">
                ${player.atBats > 0 ? `.${player.avg.toFixed(3).substring(2)} AVG<br>${player.hits} hits` : `${player.runs} runs`}
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    renderTeamsSection(teams, query) {
      return `
        <div class="search-category">
          <div class="category-header">Teams</div>
          ${teams.map(team => `
            <div class="search-item" data-type="team" data-name="${team.name}">
              <div class="search-item-icon">🏆</div>
              <div class="search-item-content">
                <div class="search-item-title team-text-${team.name.toLowerCase()}">  ${this.highlightMatch(team.name, query)}</div>
                <div class="search-item-subtitle">${team.wins}-${team.losses} record • ${team.playerCount} players</div>
              </div>
              <div class="search-item-stats">
                ${team.wins + team.losses > 0 ? `.${team.pct.toFixed(3).substring(2)} PCT` : 'New team'}
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    renderSeasonsSection(seasons, query) {
      return `
        <div class="search-category">
          <div class="category-header">Seasons</div>
          ${seasons.map(season => `
            <div class="search-item" data-type="season" data-year="${season.year}" data-season="${season.season}">
              <div class="search-item-icon">📅</div>
              <div class="search-item-content">
                <div class="search-item-title">${this.highlightMatch(`${season.year} ${season.season}`, query)}</div>
                <div class="search-item-subtitle">${season.teamCount} teams • ${season.games} games</div>
              </div>
              <div class="search-item-stats">
                ${season.games} games
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    highlightMatch(text, query) {
      const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      return text.replace(regex, '<span class="highlight">$1</span>');
    }
    
    bindResultEvents() {
      const items = this.searchResults.querySelectorAll('.search-item');
      items.forEach((item, index) => {
        item.addEventListener('click', () => {
          this.selectResult(item);
        });
        
        item.addEventListener('mouseenter', () => {
          this.currentHighlight = index;
          this.updateHighlight();
        });
      });
    }
    
    selectResult(item) {
      const type = item.dataset.type;
      
      switch(type) {
        case 'player':
          const playerName = item.dataset.name;
          window.location.href = `player.html?name=${encodeURIComponent(playerName)}`;
          break;
          
        case 'team':
          const team = item.dataset.name;
          window.location.href = `team.html?team=${encodeURIComponent(team)}`;
          break;
          
        case 'season':
          const year = item.dataset.year;
          const season = item.dataset.season;
          window.location.href = `season.html?year=${year}&season=${encodeURIComponent(season)}`;
          break;
      }
      
      this.hideResults();
      this.clearSearch();
    }
    
    handleKeyNavigation(e) {
      const items = this.searchResults.querySelectorAll('.search-item');
      
      switch(e.key) {
        case 'ArrowDown':
          e.preventDefault();
          this.currentHighlight = Math.min(this.currentHighlight + 1, items.length - 1);
          this.updateHighlight();
          break;
          
        case 'ArrowUp':
          e.preventDefault();
          this.currentHighlight = Math.max(this.currentHighlight - 1, -1);
          this.updateHighlight();
          break;
          
        case 'Enter':
          e.preventDefault();
          if (this.currentHighlight >= 0 && items[this.currentHighlight]) {
            this.selectResult(items[this.currentHighlight]);
          }
          break;
          
        case 'Escape':
          this.hideResults();
          this.searchInput.blur();
          break;
      }
    }
    
    updateHighlight() {
      const items = this.searchResults.querySelectorAll('.search-item');
      items.forEach((item, index) => {
        item.classList.toggle('highlighted', index === this.currentHighlight);
      });
    }
    
    showResults() {
      this.searchResults.classList.add('show');
      this.currentHighlight = -1;
    }
    
    hideResults() {
      this.searchResults.classList.remove('show');
      this.currentHighlight = -1;
    }
    
    clearSearch() {
      this.searchInput.value = '';
      this.clearButton.classList.remove('show');
      this.hideResults();
      this.searchInput.focus();
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    new GlobalSearch();
  });
  </script>

  <script type="module">
  // News Banner - CONVERTED TO FIREBASE
  import {
    getCurrentSeason,
    getSeasonGames,
    getSeasonPreviews  // ADD THIS IMPORT
  } from './firebase-data.js';

  const announcements = [
    { type: 'announcement', text: '🏆 2025 Fall Playoffs starts November 16th!', className: 'news-announcement' },
    { type: 'announcement', text: '⭐ Remember to clean up all trash after your games!', className: 'news-announcement' }
  ];

  let recentScores = [];
  let upcomingSchedule = [];

  async function loadRecentScores() {
    try {
      console.log('📰 Loading news banner data from Firebase...');
      
      const capitalize = (str) => str ? str.charAt(0).toUpperCase() + str.slice(1) : "";
      
      const currentSeasonData = await getCurrentSeason();
      const [seasonGames, previews] = await Promise.all([
        getSeasonGames(currentSeasonData.id),
        getSeasonPreviews(currentSeasonData.id)  // USE FIREBASE FUNCTION
      ]);
      
      console.log(`✅ Loaded ${seasonGames.length} games and ${previews.length} previews for banner`);
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const mappedGames = seasonGames.map(g => {
        let dateString = "";
        if (g.date && g.date.seconds) {
          const dateObj = new Date(g.date.seconds * 1000);
          dateString = dateObj.toLocaleDateString('en-US');
        } else if (g.date) {
          dateString = g.date;
        }
        
        return {
          "home team": g.homeTeamName || capitalize(g.homeTeamId) || "",
          "away team": g.awayTeamName || capitalize(g.awayTeamId) || "",
          "home score": g.homeScore !== undefined ? g.homeScore : null,
          "away score": g.awayScore !== undefined ? g.awayScore : null,
          winner: capitalize(g.winner || ""),
          date: dateString,
          year: currentSeasonData.year.toString(),
          season: capitalize(currentSeasonData.season)
        };
      });
      
      const completedGames = mappedGames
        .filter(game => {
          const gameDate = new Date(game.date);
          return game.winner &&
                 game.winner.trim() !== "" &&
                 gameDate < today;
        })
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 5);

      recentScores = completedGames.map(game => ({
        type: 'score',
        text: formatGameResult(game),
        className: 'news-score'
      }));
      
      // Filter previews for upcoming games
      const upcomingGames = previews
        .filter(preview => {
          const gameDate = new Date(preview.date);
          return gameDate >= today;
        })
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .slice(0, 5);

      upcomingSchedule = upcomingGames.map(game => ({
        type: 'upcoming',
        text: formatUpcomingGame(game),
        className: 'news-upcoming'
      }));
      
      console.log(`✅ Banner loaded: ${recentScores.length} scores, ${upcomingSchedule.length} upcoming`);
      
    } catch (error) {
      console.log('Could not load games data:', error);
      recentScores = [
        { type: 'score', text: '🏆 Blue defeats Orange 12-8 in thriller!', className: 'news-score' }
      ];
      upcomingSchedule = [
        { type: 'upcoming', text: '📅 Gold @ Silver - Oct 15 7:00 PM', className: 'news-upcoming' }
      ];
    }
    
    updateNewsBanner();
  }

  function formatGameResult(game) {
    const homeTeam = game["home team"];
    const awayTeam = game["away team"];
    const homeScore = game["home score"];
    const awayScore = game["away score"];
    const winner = game.winner;
    
    let scoreText;
    if (homeScore === "W" && awayScore === "L") {
      scoreText = `${homeTeam} defeats ${awayTeam}`;
    } else if (homeScore === "L" && awayScore === "W") {
      scoreText = `${awayTeam} defeats ${homeTeam}`;
    } else if (winner === "Tie") {
      scoreText = `${homeTeam} ties ${awayTeam} ${homeScore}-${awayScore}`;
    } else {
      const winnerTeam = winner;
      const loserTeam = winner === homeTeam ? awayTeam : homeTeam;
      
      let winnerScore, loserScore;
      if (winner === homeTeam) {
        winnerScore = homeScore;
        loserScore = awayScore;
      } else {
        winnerScore = awayScore;
        loserScore = homeScore;
      }
      
      scoreText = `${winnerTeam} defeats ${loserTeam} ${winnerScore}-${loserScore}`;
    }
    
    return `⚾ ${scoreText}`;
  }

  function formatUpcomingGame(game) {
    const homeTeam = game["home team"];
    const awayTeam = game["away team"];
    const gameDate = game.date;
    const gameTime = game.time || "TBD";
    
    const dateObj = new Date(gameDate);
    const formattedDate = dateObj.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric'
    });
    
    const timeDisplay = gameTime && gameTime.trim() !== "" ? ` ${gameTime}` : "";
    
    return `📅 ${awayTeam} @ ${homeTeam} - ${formattedDate}${timeDisplay}`;
  }

  function updateNewsBanner() {
    const newsContent = document.getElementById('newsContent');
    const allNews = [...announcements, ...recentScores, ...upcomingSchedule];
    
    if (allNews.length === 0) {
      newsContent.innerHTML = '<span class="news-item news-announcement">🏆 Welcome to Mountainside Aces Statistics Hub!</span>';
      return;
    }
    
    const newsHTML = allNews.map(item =>
      `<span class="news-item ${item.className}">${item.text}</span>`
    ).join('');
    
    newsContent.innerHTML = newsHTML;
  }

  document.addEventListener('DOMContentLoaded', function() {
    loadRecentScores();
  });

  setInterval(loadRecentScores, 5 * 60 * 1000);
  </script>
<script type="module">
  import { NavigationComponent } from './nav-component.js';
  // Navigation auto-initializes on load!
</script>
</body>
</html>
