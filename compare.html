<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player Comparison - Aces Stats</title>
<meta name="theme-color" content="#2d5016">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" href="mobile-enhancements.css">
<link rel="stylesheet" href="nav-styles.css">
<style>
  :root {
    --primary-color: #2d5016;
    --secondary-color: #1a6b4a;
    --accent-color: #ffd700;
    --card-bg: #ffffff;
    --text-dark: #2d3748;
    --text-light: #718096;
    --border-color: #e2e8f0;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
    --shadow-lg: 0 12px 32px rgba(0,0,0,0.16);
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    min-height: 100vh;
    color: var(--text-dark);
  }
  
  .page-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  /* Loading Spinner */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s ease;
  }

  .loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .softball-spinner::before {
    content: '‚öæ';
    font-size: 80px;
    animation: spin 1.5s ease-in-out infinite;
  }

  @keyframes spin {
    0%, 100% { 
      transform: rotate(0deg) scale(1); 
    }
    50% { 
      transform: rotate(180deg) scale(1.1); 
    }
  }
  
  /* Page Header */
  .page-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    text-align: center;
    padding: 4rem 2rem;
    border-radius: 16px;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
  }

  .page-header::before {
    content: "";
    position: absolute;
    top: -50%;
    right: -10%;
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
    border-radius: 50%;
  }

  .page-header::after {
    content: 'üìä';
    position: absolute;
    bottom: -30px;
    left: -30px;
    font-size: 200px;
    opacity: 0.08;
    transform: rotate(-15deg);
  }
  
  .page-header h1 {
    margin: 0;
    font-size: 3rem;
    font-weight: 800;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    position: relative;
    z-index: 1;
  }
  
  .page-header p {
    margin: 1rem 0 0 0;
    font-size: 1.1rem;
    opacity: 0.95;
    font-weight: 500;
    position: relative;
    z-index: 1;
  }
  
  /* Navigation */
  .filters-nav {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 16px;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
  }
  
  .nav-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    justify-content: center;
  }
  
  .nav-link {
    padding: 1rem 1.75rem;
    border: 2px solid var(--primary-color);
    background: white;
    color: var(--primary-color);
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    position: relative;
    overflow: hidden;
    z-index: 1;
  }

  .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: -1;
  }

  .nav-link:hover::before {
    transform: translateX(0);
  }

  .nav-link:hover {
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: var(--secondary-color);
  }
  
  .nav-link.active {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    border-color: var(--primary-color);
  }
  
  .nav-link.batting {
    border-color: var(--primary-color);
    color: var(--primary-color);
  }
  
  .nav-link.pitching {
    border-color: var(--secondary-color);
    color: var(--secondary-color);
  }
  
  .nav-link.pitching::before {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  }

  /* Comparison Section */
  .comparison-section {
    background: var(--card-bg);
    padding: 2rem;
    border-radius: 16px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
  }
  
  .comparison-section::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  }
  
  .comparison-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-top: 1.5rem;
  }
  
  .player-selector {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 2rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .player-selector::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .player-selector:hover::before {
    opacity: 1;
  }
  
  .player-selector:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
    transform: translateY(-4px);
  }
  
  .player-selector h3 {
    margin: 0 0 1.25rem 0;
    text-align: center;
    color: var(--text-dark);
    font-size: 1.4em;
    font-weight: 700;
  }
  
  .player-select {
    width: 100%;
    padding: 1rem;
    font-size: 1rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 1rem;
    background: white;
    transition: all 0.3s ease;
    font-weight: 600;
    color: var(--text-dark);
  }
  
  .player-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.1);
  }

  .player-select:hover {
    border-color: var(--secondary-color);
  }
  
  .comparison-type {
    display: flex;
    gap: 1.25rem;
    justify-content: center;
    margin: 2rem 0;
  }
  
  .comparison-type button {
    padding: 1rem 2rem;
    border: 2px solid var(--primary-color);
    border-radius: 12px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 700;
    transition: all 0.3s ease;
    background: white;
    color: var(--primary-color);
    position: relative;
    overflow: hidden;
    z-index: 1;
  }

  .comparison-type button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: -1;
  }

  .comparison-type button:hover::before {
    transform: translateX(0);
  }
  
  .comparison-type button.active {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .comparison-type button.active::before {
    transform: translateX(0);
  }
  
  .comparison-type button:not(.active):hover {
    color: white;
    transform: translateY(-2px);
  }
  
  #seasonSelector {
    text-align: center;
    margin: 1.5rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-radius: 12px;
    border: 2px solid var(--border-color);
  }
  
  #seasonSelector label {
    margin-right: 1rem;
    font-weight: 700;
    color: var(--text-dark);
    font-size: 1rem;
  }
  
  #seasonSelect {
    padding: 0.75rem 1.25rem;
    font-size: 1rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    background: white;
    min-width: 200px;
    font-weight: 600;
    color: var(--text-dark);
    transition: all 0.3s ease;
  }
  
  #seasonSelect:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.1);
  }

  #seasonSelect:hover {
    border-color: var(--secondary-color);
  }
  
  /* Comparison Results */
  .comparison-results {
    margin-top: 2rem;
  }
  
  .career-comparison {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
  }
  
  .player-career-stats {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 2rem;
    box-shadow: var(--shadow-sm);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .player-career-stats::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  }

  .player-career-stats::after {
    content: '‚öæ';
    position: absolute;
    bottom: -20px;
    right: -20px;
    font-size: 120px;
    opacity: 0;
    color: var(--primary-color);
    transition: all 0.4s ease;
  }
  
  .player-career-stats:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-4px);
  }

  .player-career-stats:hover::after {
    opacity: 0.03;
    bottom: -10px;
    right: -10px;
  }
  
  .player-career-stats h4 {
    margin: 0 0 1.5rem 0;
    text-align: center;
    font-size: 1.5em;
    color: var(--text-dark);
    font-weight: 800;
  }
  
  .stat-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.2s ease;
  }
  
  .stat-row:last-child {
    border-bottom: none;
  }

  .stat-row:hover {
    background: linear-gradient(135deg, #f0f4f8 0%, #e9f0f7 100%);
    margin: 0 -0.5rem;
    padding: 1rem 0.5rem;
    border-radius: 8px;
  }
  
  .stat-label {
    font-weight: 700;
    color: var(--text-light);
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .stat-value {
    font-weight: 800;
    color: var(--text-dark);
    font-size: 1.1rem;
  }
  
  .comparison-divider {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3em;
    color: var(--primary-color);
    font-weight: 800;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  }
  
  .no-comparison {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-light);
    font-style: italic;
    font-size: 1.2em;
    background: var(--card-bg);
    border-radius: 16px;
    border: 2px dashed var(--border-color);
    box-shadow: var(--shadow-sm);
  }

  .no-comparison::before {
    content: 'üìä';
    display: block;
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.3;
  }
  
  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    .page-container {
      padding: 1rem;
    }
    
    .page-header {
      padding: 2.5rem 1.5rem;
    }
    
    .page-header h1 {
      font-size: 2rem;
    }

    .page-header::after {
      font-size: 150px;
      bottom: -20px;
      left: -20px;
    }
    
    .nav-container {
      justify-content: center;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .nav-link {
      padding: 0.75rem 1.25rem;
      font-size: 0.9rem;
      text-align: center;
      width: 100%;
      justify-content: center;
    }
    
    .comparison-container {
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }
    
    .career-comparison {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    
    .comparison-divider {
      display: none;
    }
    
    .comparison-type {
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
    }
    
    .comparison-type button {
      width: 250px;
      padding: 1rem 1.5rem;
    }

    .comparison-section {
      padding: 1.5rem;
    }
  }
  
  @media (max-width: 480px) {
    .comparison-section {
      padding: 1.25rem;
    }
    
    .player-selector {
      padding: 1.5rem;
    }

    .player-selector h3 {
      font-size: 1.2em;
    }
    
    .player-career-stats {
      padding: 1.5rem;
    }
    
    .player-career-stats h4 {
      font-size: 1.3em;
    }
    
    .comparison-type button {
      width: 100%;
      padding: 1rem;
      font-size: 0.95rem;
    }

    .page-header h1 {
      font-size: 1.75rem;
    }

    .stat-label {
      font-size: 0.85rem;
    }

    .stat-value {
      font-size: 1rem;
    }
  }
</style>
</head>
<body>
<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
  <div class="softball-spinner"></div>
</div>

<div class="page-container">
  <div class="page-header">
    <h1>Player Comparison Tool</h1>
    <p>Compare player statistics, performance, and achievements across their careers</p>
  </div>

  <div class="filters-nav">

  </div>



  <div class="comparison-section">
    <div class="comparison-container">
      <div class="player-selector">
        <h3>Player 1</h3>
        <select id="player1Select" class="player-select">
          <option value="">Select Player 1...</option>
        </select>
      </div>
      
      <div class="player-selector">
        <h3>Player 2</h3>
        <select id="player2Select" class="player-select">
          <option value="">Select Player 2...</option>
        </select>
      </div>
    </div>

    <div class="comparison-type">
      <button id="careerBtn" onclick="switchComparison('career')" class="active">Career Comparison</button>
      <button id="seasonBtn" onclick="switchComparison('season')">Season Comparison</button>
    </div>

    <div id="seasonSelector" style="display: none;">
      <label for="seasonSelect">Select Season:</label>
      <select id="seasonSelect">
        <option value="">Choose a season...</option>
      </select>
    </div>
  </div>

  <div id="comparisonResults" class="comparison-results">
    <div class="no-comparison">
      Select two players above to begin comparison
    </div>
  </div>
</div>

<script type="module">
// Hide loading overlay when page loads
window.addEventListener('load', function() {
  setTimeout(function() {
    document.getElementById('loadingOverlay').classList.add('hidden');
  }, 800);
});

// ========================================
// PLAYER COMPARISON - CONVERTED TO FIREBASE
// ========================================
import {
  getAllPlayerStatsOptimized,
  seasonsObjectToArray
} from './firebase-data.js';

let allPlayers = [];
let allAwards = [];
let currentComparison = 'career';
let player1Data = null;
let player2Data = null;

async function loadData() {
  try {
    console.log('üîç Loading comparison data from Firebase...');
    
    // Load players from Firebase
    const playerStats = await getAllPlayerStatsOptimized();
    
    // Load awards from Firebase
    const { db, collection, getDocs } = await import('./firebase-config.js');
    const awardsSnapshot = await getDocs(collection(db, 'awards'));
    
    allAwards = [];
    awardsSnapshot.forEach(doc => {
      const data = doc.data();
      allAwards.push({
        Player: data.playerName || data.Player,
        Award: data.category || data.Award,
        Year: data.year || (data.seasonId ? data.seasonId.split('-')[0] : ''),
        Season: data.season || (data.seasonId ? data.seasonId.split('-')[1] : '')
      });
    });
    
    console.log(`‚úÖ Loaded ${playerStats.length} players, ${allAwards.length} awards`);
    
    // Convert Firebase data to format expected by comparison tool
    allPlayers = playerStats.map(player => {
      // Convert seasons object to array
      const seasonArray = seasonsObjectToArray(player);
      
      // Map each season to expected format
      return seasonArray.map(season => {
        // Extract year and season from seasonId (e.g., "2025-fall" or "2025-fall-orange")
        const parts = season.seasonId.split('-');
        const year = parts[0];
        const seasonName = parts[1] ? parts[1].charAt(0).toUpperCase() + parts[1].slice(1) : '';
        
        return {
          id: player.id,  // ‚Üê ADD THIS LINE
		  playerId: player.id,  // ‚Üê ADD THIS LINE (for consistency)
		  name: player.name || player.playerName || player.id,
          team: season.team || player.currentTeam || '',
          season: seasonName,
          year: year,
          games: Number(season.games || 0),
          atBats: Number(season.atBats || 0),
          hits: Number(season.hits || 0),
          runs: Number(season.runs || 0),
          walks: Number(season.walks || 0),
          doubles: Number(season.doubles || 0),
          triples: Number(season.triples || 0),
          homeRuns: Number(season.homeRuns || 0),
          rbis: Number(season.rbis || 0),
          AcesWar: season.acesBPI || season.AcesWar || "N/A",
          Sub: season.isSub || season.Sub || "No"
        };
      });
    }).flat();
    
    console.log(`‚úÖ Processed ${allPlayers.length} player-season records`);
    
    populatePlayerSelects();
    
  } catch (error) {
    console.error('‚ùå Error loading data:', error);
    console.error('Error stack:', error.stack);
    document.getElementById("comparisonResults").innerHTML =
      '<div class="no-comparison">Error loading player data. Please check your connection.</div>';
  }
}

function populatePlayerSelects() {
  // Get unique players with their IDs
  const playersMap = new Map();
  
  // Build a map of player names to their IDs
  allPlayers.forEach(p => {
    if (p.name && p.id) {
      playersMap.set(p.name, p.id);
    }
  });
  
  // Sort by name
  const players = Array.from(playersMap.entries()).sort((a, b) => a[0].localeCompare(b[0]));
  
  const player1Select = document.getElementById('player1Select');
  const player2Select = document.getElementById('player2Select');
  
  players.forEach(([playerName, playerId]) => {
    const option1 = document.createElement('option');
    option1.value = playerId;  // ‚Üê CHANGED: Use ID instead of name
    option1.textContent = playerName;
    option1.dataset.playerName = playerName; // Store name for display
    player1Select.appendChild(option1);
    
    const option2 = document.createElement('option');
    option2.value = playerId;  // ‚Üê CHANGED: Use ID instead of name
    option2.textContent = playerName;
    option2.dataset.playerName = playerName; // Store name for display
    player2Select.appendChild(option2);
  });
  
  player1Select.addEventListener('change', updateComparison);
  player2Select.addEventListener('change', updateComparison);
}

function updateComparison() {
  const player1Id = document.getElementById('player1Select').value;  // ‚Üê CHANGED: Get ID
  const player2Id = document.getElementById('player2Select').value;  // ‚Üê CHANGED: Get ID
  
  if (!player1Id || !player2Id) {
    document.getElementById('comparisonResults').innerHTML =
      '<div class="no-comparison">Select two players above to begin comparison</div>';
    return;
  }
  
  if (player1Id === player2Id) {
    document.getElementById('comparisonResults').innerHTML =
      '<div class="no-comparison">Please select two different players</div>';
    return;
  }
  
  // Get the player names for filtering
  const player1Name = document.querySelector(`#player1Select option[value="${player1Id}"]`).textContent;
  const player2Name = document.querySelector(`#player2Select option[value="${player2Id}"]`).textContent;
  
  player1Data = allPlayers.filter(p => p.name === player1Name);  // Filter by name for now
  player2Data = allPlayers.filter(p => p.name === player2Name);  // Filter by name for now
  
  // Re-populate season selector if in season mode
  if (currentComparison === 'season') {
    populateSeasonSelector();
  }
  
  renderComparison();
}

function switchComparison(type) {
  currentComparison = type;
  
  // Update button styles
  const careerBtn = document.getElementById('careerBtn');
  const seasonBtn = document.getElementById('seasonBtn');
  const seasonSelector = document.getElementById('seasonSelector');
  
  if (type === 'career') {
    careerBtn.classList.add('active');
    seasonBtn.classList.remove('active');
    seasonSelector.style.display = 'none';
  } else {
    seasonBtn.classList.add('active');
    careerBtn.classList.remove('active');
    seasonSelector.style.display = 'block';
    populateSeasonSelector();
  }
  
  renderComparison();
}

function populateSeasonSelector() {
  const seasonSelect = document.getElementById('seasonSelect');
  
  if (!player1Data || !player2Data) return;
  
  // Get all unique seasons from both players
  const allSeasons = new Set();
  
  player1Data.forEach(season => {
    allSeasons.add(`${season.year}-${season.season}`);
  });
  
  player2Data.forEach(season => {
    allSeasons.add(`${season.year}-${season.season}`);
  });
  
  // Clear existing options except first
  seasonSelect.innerHTML = '<option value="">Choose a season...</option>';
  
  // Sort seasons (most recent first)
  const sortedSeasons = Array.from(allSeasons).sort((a, b) => {
    const [yearA, seasonA] = a.split('-');
    const [yearB, seasonB] = b.split('-');
    
    if (yearB !== yearA) return parseInt(yearB) - parseInt(yearA);
    return seasonB.localeCompare(seasonA);
  });
  
  sortedSeasons.forEach(seasonKey => {
    const [year, season] = seasonKey.split('-');
    const option = document.createElement('option');
    option.value = seasonKey;
    option.textContent = `${year} ${season}`;
    seasonSelect.appendChild(option);
  });
  
  // Remove existing event listeners and add new one
  const newSeasonSelect = seasonSelect.cloneNode(true);
  seasonSelect.parentNode.replaceChild(newSeasonSelect, seasonSelect);
  newSeasonSelect.addEventListener('change', renderComparison);
}

function renderComparison() {
  if (!player1Data || !player2Data) return;
  
  const resultsDiv = document.getElementById('comparisonResults');
  
  if (currentComparison === 'career') {
    resultsDiv.innerHTML = renderCareerComparison();
  } else {
    const selectedSeason = document.getElementById('seasonSelect').value;
    if (selectedSeason) {
      resultsDiv.innerHTML = renderSeasonComparison(selectedSeason);
    } else {
      resultsDiv.innerHTML = '<div class="no-comparison">Please select a season to compare</div>';
    }
  }
}

function renderCareerComparison() {
  const player1Stats = aggregatePlayerStats(player1Data);
  const player2Stats = aggregatePlayerStats(player2Data);
  
  return `
    <div class="career-comparison">
      <div class="player-career-stats">
        <h4>${player1Stats.name}</h4>
        <div class="stat-row">
          <span class="stat-label">Games:</span>
          <span class="stat-value">${player1Stats.totalGames}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">At Bats:</span>
          <span class="stat-value">${player1Stats.totalAtBats}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Hits:</span>
          <span class="stat-value">${player1Stats.totalHits}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Runs:</span>
          <span class="stat-value">${player1Stats.totalRuns}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Walks:</span>
          <span class="stat-value">${player1Stats.totalWalks}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Batting Average:</span>
          <span class="stat-value">${player1Stats.battingAverage}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">On-Base %:</span>
          <span class="stat-value">${player1Stats.onBasePercentage}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Avg AcesBPI:</span>
          <span class="stat-value">${player1Stats.avgAcesWar}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Seasons Played:</span>
          <span class="stat-value">${player1Stats.seasonsPlayed}</span>
        </div>
        ${player1Stats.awards && player1Stats.awards !== '' ? `
        <div class="stat-row">
          <span class="stat-label">Awards:</span>
          <span class="stat-value">${player1Stats.awards}</span>
        </div>
        ` : ''}
      </div>
      
      <div class="comparison-divider">VS</div>
      
      <div class="player-career-stats">
        <h4>${player2Stats.name}</h4>
        <div class="stat-row">
          <span class="stat-label">Games:</span>
          <span class="stat-value">${player2Stats.totalGames}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">At Bats:</span>
          <span class="stat-value">${player2Stats.totalAtBats}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Hits:</span>
          <span class="stat-value">${player2Stats.totalHits}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Runs:</span>
          <span class="stat-value">${player2Stats.totalRuns}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Walks:</span>
          <span class="stat-value">${player2Stats.totalWalks}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Batting Average:</span>
          <span class="stat-value">${player2Stats.battingAverage}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">On-Base %:</span>
          <span class="stat-value">${player2Stats.onBasePercentage}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Avg AcesBPI:</span>
          <span class="stat-value">${player2Stats.avgAcesWar}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Seasons Played:</span>
          <span class="stat-value">${player2Stats.seasonsPlayed}</span>
        </div>
        ${player2Stats.awards && player2Stats.awards !== '' ? `
        <div class="stat-row">
          <span class="stat-label">Awards:</span>
          <span class="stat-value">${player2Stats.awards}</span>
        </div>
        ` : ''}
      </div>
    </div>
  `;
}

function renderSeasonComparison(selectedSeason) {
  const [year, season] = selectedSeason.split('-');
  
  // Find the specific season data for each player
  const player1Season = player1Data.find(s => s.year === year && s.season === season);
  const player2Season = player2Data.find(s => s.year === year && s.season === season);
  
  // Get season awards for both players
  const player1SeasonAwards = getSeasonAwards(player1Data[0].name, year, season);
  const player2SeasonAwards = getSeasonAwards(player2Data[0].name, year, season);
  
  return `
    <div class="career-comparison">
      <div class="player-career-stats">
        <h4>${player1Data[0].name} - ${year} ${season}</h4>
        ${player1Season ? renderSeasonStats(player1Season, player1SeasonAwards) : '<div style="text-align: center; color: #666; font-style: italic;">Did not play this season</div>'}
      </div>
      
      <div class="comparison-divider">VS</div>
      
      <div class="player-career-stats">
        <h4>${player2Data[0].name} - ${year} ${season}</h4>
        ${player2Season ? renderSeasonStats(player2Season, player2SeasonAwards) : '<div style="text-align: center; color: #666; font-style: italic;">Did not play this season</div>'}
      </div>
    </div>
  `;
}

function renderSeasonStats(seasonData, seasonAwards) {
  const BA = seasonData.atBats > 0 ? (seasonData.hits / seasonData.atBats).toFixed(3) : ".000";
  const OBP = (seasonData.atBats + seasonData.walks) > 0
    ? ((seasonData.hits + seasonData.walks) / (seasonData.atBats + seasonData.walks)).toFixed(3)
    : ".000";
  const AcesWar = seasonData.AcesWar !== "N/A" && !isNaN(seasonData.AcesWar)
    ? Number(seasonData.AcesWar).toFixed(2)
    : "N/A";
  const subStatus = (seasonData.Sub || "").toString().trim().toLowerCase() === "yes" ? "Yes" : "No";
  
  return `
    <div class="stat-row">
      <span class="stat-label">Team:</span>
      <span class="stat-value">${seasonData.team}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Games:</span>
      <span class="stat-value">${seasonData.games}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">At Bats:</span>
      <span class="stat-value">${seasonData.atBats}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Hits:</span>
      <span class="stat-value">${seasonData.hits}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Runs:</span>
      <span class="stat-value">${seasonData.runs}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Walks:</span>
      <span class="stat-value">${seasonData.walks}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">AcesBPI:</span>
      <span class="stat-value">${AcesWar}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Batting Average:</span>
      <span class="stat-value">${BA}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">On-Base %:</span>
      <span class="stat-value">${OBP}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Substitute:</span>
      <span class="stat-value">${subStatus}</span>
    </div>
    ${seasonAwards ? `
    <div class="stat-row">
      <span class="stat-label">Season Awards:</span>
      <span class="stat-value">${seasonAwards}</span>
    </div>
    ` : ''}
  `;
}

function getSeasonAwards(playerName, year, season) {
  const seasonAwards = allAwards.filter(award =>
    award.Player && award.Player.trim() === playerName &&
    award.Year === year && award.Season === season &&
    award.Award && award.Award.trim() !== ""
  );
  
  if (seasonAwards.length === 0) return null;
  
  // Group awards by type and count
  const awardCounts = {};
  seasonAwards.forEach(award => {
    const awardType = award.Award.trim();
    if (!awardCounts[awardType]) {
      awardCounts[awardType] = 0;
    }
    awardCounts[awardType]++;
  });
  
  // Format awards as "Award Type: Count | Award Type: Count"
  const formattedAwards = Object.entries(awardCounts)
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([awardType, count]) => count > 1 ? `${awardType}: ${count}` : awardType);
  
  return formattedAwards.join(' | ');
}

function aggregatePlayerStats(playerData) {
  const stats = {
    name: playerData[0].name,
    totalGames: 0,
    totalAtBats: 0,
    totalHits: 0,
    totalRuns: 0,
    totalWalks: 0,
    acesWarValues: [],
    seasonsPlayed: 0,
    awards: ''
  };
  
  // Track unique year-season combinations (ignoring team)
  // to count seasons correctly when player trades mid-season
  const uniqueSeasons = new Set();
  
  playerData.forEach(season => {
    // Always aggregate stats (even from sub seasons)
    stats.totalGames += season.games;
    stats.totalAtBats += season.atBats;
    stats.totalHits += season.hits;
    stats.totalRuns += season.runs;
    stats.totalWalks += season.walks;
    
    if (season.AcesWar !== "N/A" && !isNaN(season.AcesWar)) {
      stats.acesWarValues.push(Number(season.AcesWar));
    }
    
    // Only count season if NOT a sub
    const subStatus = (season.Sub || "").toString().trim().toLowerCase();
    if (subStatus !== "yes") {
      // Create unique key: "2022-Fall" (without team)
      const seasonKey = `${season.year}-${season.season}`;
      uniqueSeasons.add(seasonKey);
    }
  });
  
  // Count unique seasons (ignoring multiple teams per season)
  stats.seasonsPlayed = uniqueSeasons.size;
  
  // Calculate awards for this player
  const playerAwards = allAwards.filter(award =>
    award.Player && award.Player.trim() === stats.name && award.Award && award.Award.trim() !== ""
  );
  
  // Group awards by type and count
  const awardCounts = {};
  playerAwards.forEach(award => {
    const awardType = award.Award.trim();
    if (!awardCounts[awardType]) {
      awardCounts[awardType] = 0;
    }
    awardCounts[awardType]++;
  });
  
  // Format awards as "Award Type: Count | Award Type: Count"
  const formattedAwards = Object.entries(awardCounts)
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([awardType, count]) => `${awardType}: ${count}`);
  
  stats.awards = formattedAwards.length > 0 ? formattedAwards.join(' | ') : '';
  
  stats.battingAverage = stats.totalAtBats > 0 ?
    (stats.totalHits / stats.totalAtBats).toFixed(3) : ".000";
  
  stats.onBasePercentage = (stats.totalAtBats + stats.totalWalks) > 0 ?
    ((stats.totalHits + stats.totalWalks) / (stats.totalAtBats + stats.totalWalks)).toFixed(3) : ".000";
  
  stats.avgAcesWar = stats.acesWarValues.length > 0 ?
    (stats.acesWarValues.reduce((a, b) => a + b, 0) / stats.acesWarValues.length).toFixed(2) : "N/A";
  
  return stats;
}

// Make switchComparison available globally
window.switchComparison = switchComparison;

// Load data when page loads
loadData();
</script>
<script type="module">
  import { NavigationComponent } from './nav-component.js';
  // Navigation auto-initializes on load!
</script>
<script src="team-colors.js"></script>
<script src="mobile-enhancements.js"></script>
</body>
</html>
