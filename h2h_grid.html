<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Head-to-Head Grid - Mountainside Aces</title>
<meta name="theme-color" content="#2d5016">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" href="mobile-enhancements.css">
<style>
:root {
  --primary-color: #2d5016;
  --secondary-color: #1a6b4a;
  --accent-color: #ffd700;
  --card-bg: #ffffff;
  --text-dark: #2d3748;
  --text-light: #718096;
  --border-color: #e2e8f0;
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
  --shadow-lg: 0 12px 32px rgba(0,0,0,0.16);
}

* {
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
  min-height: 100vh;
  line-height: 1.6;
  color: var(--text-dark);
}

/* Loading Overlay */
.loading-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(255,255,255,0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.5s ease, visibility 0.5s ease;
}

.loading-overlay.hidden {
  opacity: 0;
  visibility: hidden;
}

.softball-spinner {
  position: relative;
}

.softball-spinner::before {
  content: '‚öæ';
  font-size: 80px;
  animation: spin 1.5s ease-in-out infinite;
  display: block;
}

@keyframes spin {
  0%, 100% { transform: rotate(0deg) scale(1); }
  50% { transform: rotate(180deg) scale(1.1); }
}

/* Page Container */
.page-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 2rem;
}

/* Page Header */
.page-header {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  text-align: center;
  padding: 4rem 2rem;
  border-radius: 16px;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
}

.page-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background: linear-gradient(90deg, var(--accent-color) 0%, #ffed4e 100%);
}

.page-header::after {
  content: '‚öæ';
  position: absolute;
  bottom: -40px;
  right: -40px;
  font-size: 200px;
  opacity: 0.05;
}

.page-header h1 {
  margin: 0;
  font-size: 3.5rem;
  font-weight: 800;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  position: relative;
  z-index: 1;
}

.page-header p {
  margin: 1rem 0 0 0;
  font-size: 1.2rem;
  opacity: 0.95;
  position: relative;
  z-index: 1;
}

/* Navigation */
.filters-nav {
  background: var(--card-bg);
  padding: 1.5rem;
  border-radius: 16px;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border-color);
}

.nav-container {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
  justify-content: center;
}

.nav-link {
  padding: 1rem 1.75rem;
  border: 2px solid var(--primary-color);
  background: white;
  color: var(--primary-color);
  text-decoration: none;
  border-radius: 12px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  position: relative;
  overflow: hidden;
  z-index: 1;
}

.nav-link::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: var(--primary-color);
  transform: translateX(-100%);
  transition: transform 0.3s ease;
  z-index: -1;
}

.nav-link:hover::before,
.nav-link.active::before {
  transform: translateX(0);
}

.nav-link:hover,
.nav-link.active {
  color: white;
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.nav-link.pitching {
  border-color: #11998e;
  color: #11998e;
}

.nav-link.pitching::before {
  background: #11998e;
}

.nav-link.batting {
  border-color: var(--primary-color);
  color: var(--primary-color);
}

/* Summary Stats */
.summary-stats {
  background: var(--card-bg);
  padding: 2rem;
  margin-bottom: 2rem;
  border-radius: 16px;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border-color);
  position: relative;
  overflow: hidden;
}

.summary-stats::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
}

.summary-stats h3 {
  margin: 0 0 1.5rem 0;
  color: var(--text-dark);
  font-size: 1.75rem;
  text-align: center;
  font-weight: 700;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.stat-item {
  background: #f8f9fa;
  padding: 1.5rem 1rem;
  border-radius: 12px;
  border: 1px solid var(--border-color);
  text-align: center;
  transition: all 0.3s ease;
  border-left: 3px solid var(--primary-color);
}

.stat-item:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-sm);
  border-left-color: var(--secondary-color);
}

.stat-label {
  font-size: 0.9rem;
  color: var(--text-light);
  margin-bottom: 0.5rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 800;
  color: var(--text-dark);
}

.stat-subtext {
  font-size: 0.85rem;
  color: var(--text-light);
  margin-top: 0.5rem;
  font-weight: 500;
}

/* Legend */
.legend {
  background: var(--card-bg);
  padding: 1.5rem;
  border-radius: 16px;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border-color);
  margin-bottom: 2rem;
}

.legend-container {
  display: flex;
  justify-content: center;
  gap: 2rem;
  flex-wrap: wrap;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.95rem;
  font-weight: 600;
}

.legend-color {
  width: 24px;
  height: 24px;
  border-radius: 6px;
  border: 1px solid var(--border-color);
}

/* H2H Container */
.h2h-container {
  background: var(--card-bg);
  border-radius: 16px;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border-color);
  overflow: hidden;
  position: relative;
}

.h2h-container::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  z-index: 10;
}

.h2h-scroll {
  overflow-x: auto;
  margin-top: 5px;
}

/* H2H Grid */
.h2h-grid {
  border-collapse: collapse;
  width: 100%;
  min-width: 600px;
  background-color: white;
}

.h2h-grid th,
.h2h-grid td {
  border: 1px solid var(--border-color);
  padding: 12px 8px;
  text-align: center;
  vertical-align: middle;
  font-size: 0.9rem;
}

.h2h-grid th {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  font-weight: 700;
  position: sticky;
  top: 0;
  z-index: 10;
}

.h2h-grid .row-header {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  font-weight: 700;
  position: sticky;
  left: 0;
  z-index: 5;
  min-width: 70px;
  font-size: 0.85rem;
  max-width: 70px;
  overflow: hidden;
}

.h2h-grid .corner-cell {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  position: sticky;
  left: 0;
  top: 0;
  z-index: 15;
}

.team-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
}

.team-header img {
  width: 30px;
  height: 30px;
  object-fit: contain;
  border-radius: 4px;
  filter: brightness(1.1) drop-shadow(0 1px 2px rgba(0,0,0,0.2));
}

.team-row-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 4px;
  font-size: 0.75rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.2;
}

.team-row-header .vs-text {
  font-size: 0.7rem;
  margin-bottom: 2px;
  opacity: 0.9;
}

.team-row-header .team-info {
  display: flex;
  align-items: center;
  gap: 3px;
  font-size: 0.75rem;
}

.team-row-header img {
  width: 22px;
  height: 22px;
  object-fit: contain;
  flex-shrink: 0;
  border-radius: 4px;
  filter: brightness(1.1) drop-shadow(0 1px 2px rgba(0,0,0,0.2));
}

.diagonal-cell {
  background-color: #f8f9fa;
  color: var(--text-light);
  font-style: italic;
  font-weight: 600;
}

.h2h-cell {
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 90px;
}

.h2h-cell:hover {
  background-color: rgba(45, 80, 22, 0.1);
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(45, 80, 22, 0.2);
}

.h2h-record {
  font-weight: 800;
  color: var(--text-dark);
  font-size: 1.05rem;
}

.h2h-details {
  font-size: 0.85rem;
  color: var(--text-light);
  margin-top: 4px;
  font-weight: 600;
}

.winning-record {
  background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
  color: #155724;
}

.losing-record {
  background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
  color: #721c24;
}

.tied-record {
  background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
  color: #856404;
}

.no-games {
  background-color: #f8f9fa;
  color: var(--text-light);
  font-style: italic;
}

.loading {
  text-align: center;
  padding: 3rem 2rem;
  color: var(--text-light);
  font-size: 1.1rem;
}

.loading::before {
  content: "‚öæ";
  display: block;
  font-size: 4rem;
  margin-bottom: 1.5rem;
  animation: bounce 1s ease-in-out infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-20px) scale(1.1); }
}

/* Responsive design */
@media (max-width: 768px) {
  .page-container {
    padding: 1rem;
  }
  
  .page-header {
    padding: 2rem 1rem;
  }
  
  .page-header h1 {
    font-size: 2.5rem;
  }
  
  .nav-container {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .nav-link {
    width: 100%;
    justify-content: center;
    padding: 0.8rem 1.25rem;
    font-size: 0.95rem;
  }
  
  .h2h-grid th,
  .h2h-grid td {
    padding: 8px 6px;
    font-size: 0.85rem;
  }
  
  .team-header {
    gap: 4px;
  }
  
  .team-header img {
    width: 24px;
    height: 24px;
  }
  
  .team-row-header img {
    width: 20px;
    height: 20px;
  }
  
  .legend-container {
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .summary-stats {
    padding: 1.5rem;
  }
  
  .summary-stats h3 {
    font-size: 1.5rem;
  }
}

@media (max-width: 480px) {
  .page-header h1 {
    font-size: 2rem;
  }
  
  .h2h-grid th,
  .h2h-grid td {
    padding: 6px 4px;
    font-size: 0.8rem;
  }
  
  .team-header img {
    width: 20px;
    height: 20px;
  }
  
  .team-row-header img {
    width: 18px;
    height: 18px;
  }
  
  .summary-stats {
    padding: 1.25rem;
  }
  
  .summary-stats h3 {
    font-size: 1.3rem;
  }
  
  .stat-item {
    padding: 1.25rem 0.875rem;
  }
}
</style>
</head>
<body>
<div id="loadingOverlay" class="loading-overlay">
  <div class="softball-spinner"></div>
</div>

<!-- Mobile Navigation -->
<div class="mobile-nav-container">
  <div class="mobile-nav-header">
    <div class="mobile-nav-title">‚öîÔ∏è Head-to-Head Grid</div>
    <button class="hamburger-menu" onclick="toggleMobileMenu()" aria-label="Toggle navigation">‚ò∞</button>
  </div>
  <nav class="mobile-nav-menu" id="mobileNavMenu">
    <a href="index.html" class="mobile-nav-item">üè† Home</a>
    <a href="current-season.html" class="mobile-nav-item">üçÇ Current Season</a>
    <a href="weekend-preview.html" class="mobile-nav-item">üîÆ Weekend Preview</a>
    <a href="projections.html" class="mobile-nav-item">üìà Playoff Projections</a>
    <a href="batting.html" class="mobile-nav-item">‚öæ Batting Stats</a>
    <a href="pitching.html" class="mobile-nav-item">ü•é Pitching Stats</a>
    <a href="teams.html" class="mobile-nav-item">üèÜ All Teams</a>
    <a href="players.html" class="mobile-nav-item">üë§ All Players</a>
    <a href="seasons.html" class="mobile-nav-item">üìÖ All Seasons</a>
    <a href="awards.html" class="mobile-nav-item">üèÖ Awards</a>
    <a href="leaders.html" class="mobile-nav-item">üìä Career Leaders</a>
    <a href="milestones.html" class="mobile-nav-item">üéØ Milestones</a>
    <a href="compare.html" class="mobile-nav-item">üìà Player Comparison</a>
    <a href="team_compare.html" class="mobile-nav-item">üÜö Team Comparison</a>
    <a href="h2h_grid.html" class="mobile-nav-item active">‚öîÔ∏è Head-to-Head Grid</a>
    <a href="pictures.html" class="mobile-nav-item">üì∑ Gallery</a>
  </nav>
</div>

<div class="page-container">
  <div class="page-header">
    <h1>‚öîÔ∏è Head-to-Head Results Grid</h1>
    <p>Complete matchup records between teams (2022+)</p>
  </div>

  <div class="filters-nav">
    <nav class="nav-container">
      <a href="index.html" class="nav-link">üè† Home</a>
      <a href="current-season.html" class="nav-link">üçÇ Current Season</a>
      <a href="batting.html" class="nav-link batting">‚öæ Batting Stats</a>
      <a href="pitching.html" class="nav-link pitching">ü•é Pitching Stats</a>
      <a href="teams.html" class="nav-link">üèÜ All Teams</a>
      <a href="players.html" class="nav-link">üë§ All Players</a>
      <a href="seasons.html" class="nav-link">üìÖ All Seasons</a>
      <a href="leaders.html" class="nav-link">üìä Career Leaders</a>
      <a href="compare.html" class="nav-link">‚öñÔ∏è Player Comparison</a>
      <a href="h2h_grid.html" class="nav-link active">‚öîÔ∏è Head-to-Head Grid</a>
      <a href="pictures.html" class="nav-link">üì∑ Gallery</a>
      <a href="charts.html" class="nav-link">üìà Performance Charts</a>
    </nav>
  </div>

  <div class="summary-stats" id="summaryStats">
    <h3>League Head-to-Head Summary (2022+)</h3>
    <div class="stats-grid" id="statsGrid">
      <div class="loading">Loading statistics...</div>
    </div>
  </div>

  <div class="legend">
    <div class="legend-container">
      <div class="legend-item">
        <div class="legend-color winning-record" style="background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);"></div>
        <span>Winning Record</span>
      </div>
      <div class="legend-item">
        <div class="legend-color tied-record" style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);"></div>
        <span>Even Record</span>
      </div>
      <div class="legend-item">
        <div class="legend-color losing-record" style="background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);"></div>
        <span>Losing Record</span>
      </div>
      <div class="legend-item">
        <div class="legend-color no-games" style="background-color: #f8f9fa;"></div>
        <span>No Games</span>
      </div>
      <div class="legend-item">
        <div class="legend-color diagonal-cell" style="background-color: #f8f9fa;"></div>
        <span>Same Team</span>
      </div>
    </div>
  </div>

  <div class="h2h-container">
    <div class="h2h-scroll">
      <table class="h2h-grid" id="h2hGrid">
        <tr><td class="loading">Loading head-to-head grid...</td></tr>
      </table>
    </div>
  </div>
</div>

<script type="module">
import { getAllSeasons } from './firebase-data.js';

let allGames = [];
let teams = [];

// Mobile menu toggle
function toggleMobileMenu() {
  const menu = document.getElementById('mobileNavMenu');
  menu.classList.toggle('open');
}
window.toggleMobileMenu = toggleMobileMenu;

// Hide loading overlay after page loads
window.addEventListener('load', function() {
  setTimeout(function() {
    document.getElementById('loadingOverlay').classList.add('hidden');
  }, 800);
});

// Helper function to capitalize team names
const capitalize = (str) => str ? str.charAt(0).toUpperCase() + str.slice(1) : "";

// Function to get team logo path
function getTeamLogoPath(teamName) {
  const logoFileName = teamName.toLowerCase().replace(/\s+/g, '_') + '.png';
  return `logos/${logoFileName}`;
}

// Function to create team header with logo
function createTeamHeader(teamName) {
  return `
    <div class="team-header">
      <img src="${getTeamLogoPath(teamName)}" alt="${teamName}" onerror="this.style.display='none'">
      <div>${teamName}</div>
    </div>
  `;
}

// Function to create team row header with logo
function createTeamRowHeader(teamName) {
  return `
    <div class="team-row-header">
      <div class="vs-text">vs</div>
      <div class="team-info">
        <img src="${getTeamLogoPath(teamName)}" alt="${teamName}" onerror="this.style.display='none'">
        <div>${teamName}</div>
      </div>
    </div>
  `;
}

// Load all games from Firebase
async function loadData() {
  try {
    console.log('üìä Loading all games from Firebase...');
    
    // Get all seasons
    const seasons = await getAllSeasons();
    console.log(`‚úÖ Found ${seasons.length} seasons`);
    
    // Load games from all seasons
    const gamePromises = seasons.map(async (season) => {
      try {
        // Import getSeasonGames dynamically to avoid circular dependency
        const { getSeasonGames } = await import('./firebase-data.js');
        const seasonGames = await getSeasonGames(season.id);
        
        // Map games to expected format with proper field names
        return seasonGames.map(g => {
          // Convert Firebase Timestamp to date
          let dateString = "";
          if (g.date && g.date.seconds) {
            const dateObj = new Date(g.date.seconds * 1000);
            dateString = dateObj.toLocaleDateString('en-US');
          } else if (g.date) {
            dateString = g.date;
          }
          
          return {
            "home team": g.homeTeamName || capitalize(g.homeTeamId) || "",
            "away team": g.awayTeamName || capitalize(g.awayTeamId) || "",
            "home score": g.homeScore !== undefined ? g.homeScore : null,
            "away score": g.awayScore !== undefined ? g.awayScore : null,
            winner: capitalize(g.winner || ""),
            game_type: g.gameType || "Regular",
            date: dateString,
            year: season.year || "",
            season: capitalize(season.season || ""),
            forfeit: g.forfeit ? "Yes" : "No"
          };
        });
      } catch (err) {
        console.warn(`Could not load games for season ${season.id}:`, err);
        return [];
      }
    });
    
    const allSeasonGames = await Promise.all(gamePromises);
    allGames = allSeasonGames.flat();
    
    console.log(`‚úÖ Loaded ${allGames.length} total games`);
    
    // Filter for 2022+ only
    allGames = allGames.filter(g => {
      const year = parseInt(g.year);
      return year >= 2022;
    });
    
    console.log(`‚úÖ Filtered to ${allGames.length} games from 2022+`);
    
    // Define official Aces teams (in preferred display order)
    const officialAcesTeams = [
      "Army", "Black", "Blue", "Carolina", "Gold", "Green", 
      "Orange", "Purple", "Red", "Silver", "White"
    ];
    
    // Extract unique teams from games
    const teamSet = new Set();
    allGames.forEach(game => {
      if (game["home team"]) teamSet.add(game["home team"]);
      if (game["away team"]) teamSet.add(game["away team"]);
    });
    
    // Filter to only official Aces teams (case-insensitive matching)
    teams = officialAcesTeams.filter(officialTeam => {
      return Array.from(teamSet).some(gameTeam => 
        gameTeam.toLowerCase() === officialTeam.toLowerCase()
      );
    });
    
    console.log(`‚úÖ Found ${teams.length} Aces teams with games:`, teams);
    
    generateH2HGrid();
    generateSummaryStats();
    
  } catch (error) {
    console.error('‚ùå Error loading data:', error);
    document.getElementById('h2hGrid').innerHTML = 
      '<tr><td>Error loading head-to-head data. Please refresh the page.</td></tr>';
    document.getElementById('statsGrid').innerHTML = 
      '<div class="stat-item"><div class="stat-value">Error loading data</div></div>';
  }
}

function generateH2HGrid() {
  const table = document.getElementById('h2hGrid');
  
  // Create header row with teams across the top
  let headerRow = '<tr><th class="corner-cell">vs Team</th>';
  teams.forEach(team => {
    headerRow += `<th>${createTeamHeader(team)}</th>`;
  });
  headerRow += '</tr>';
  
  // Create data rows with team headers
  let dataRows = '';
  teams.forEach(vsTeam => {
    let row = `<tr><td class="row-header">${createTeamRowHeader(vsTeam)}</td>`;
    
    teams.forEach(firstTeam => {
      if (firstTeam === vsTeam) {
        // Diagonal cell (same team)
        row += '<td class="diagonal-cell">‚Äî</td>';
      } else {
        // Calculate H2H record from firstTeam's perspective against vsTeam
        const h2h = calculateHeadToHead(firstTeam, vsTeam);
        const cellClass = getCellClass(h2h, firstTeam);
        const cellContent = formatCellContent(h2h, firstTeam, vsTeam);
        
        row += `<td class="h2h-cell ${cellClass}" onclick="showH2HDetails('${firstTeam}', '${vsTeam}')">${cellContent}</td>`;
      }
    });
    
    row += '</tr>';
    dataRows += row;
  });
  
  table.innerHTML = headerRow + dataRows;
}

function calculateHeadToHead(team1, team2) {
  // Filter games where these two teams played each other (case-insensitive)
  const team1Lower = team1.toLowerCase();
  const team2Lower = team2.toLowerCase();
  
  const headToHeadGames = allGames.filter(game => {
    const homeTeam = (game["home team"] || "").toLowerCase();
    const awayTeam = (game["away team"] || "").toLowerCase();
    
    const isMatchup = (homeTeam === team1Lower && awayTeam === team2Lower) ||
                     (homeTeam === team2Lower && awayTeam === team1Lower);
    
    return isMatchup;
  });
  
  if (headToHeadGames.length === 0) {
    return null;
  }
  
  let team1Wins = 0, team2Wins = 0, ties = 0;
  
  headToHeadGames.forEach(game => {
    const winner = (game.winner || "").toLowerCase();
    
    // Handle different winner formats (case-insensitive)
    if (winner.includes("tie")) {
      ties++;
    } else if (winner === team1Lower) {
      team1Wins++;
    } else if (winner === team2Lower) {
      team2Wins++;
    }
  });
  
  return {
    team1: team1,
    team2: team2,
    team1Wins: team1Wins,
    team2Wins: team2Wins,
    ties: ties,
    totalGames: team1Wins + team2Wins + ties
  };
}

function getCellClass(h2h, perspective) {
  if (!h2h) return 'no-games';
  
  const perspectiveWins = h2h.team1 === perspective ? h2h.team1Wins : h2h.team2Wins;
  const opponentWins = h2h.team1 === perspective ? h2h.team2Wins : h2h.team1Wins;
  
  if (perspectiveWins > opponentWins) {
    return 'winning-record';
  } else if (perspectiveWins < opponentWins) {
    return 'losing-record';
  } else {
    return 'tied-record';
  }
}

function formatCellContent(h2h, team1, team2) {
  if (!h2h) {
    return '<div class="h2h-record">‚Äî</div><div class="h2h-details">No games</div>';
  }
  
  // Show record from team1's perspective (row team)
  const team1Wins = h2h.team1 === team1 ? h2h.team1Wins : h2h.team2Wins;
  const team2Wins = h2h.team1 === team1 ? h2h.team2Wins : h2h.team1Wins;
  
  const record = h2h.ties > 0 ? 
    `${team1Wins}-${team2Wins}-${h2h.ties}` : 
    `${team1Wins}-${team2Wins}`;
  
  return `<div class="h2h-record">${record}</div><div class="h2h-details">${h2h.totalGames} games</div>`;
}

window.showH2HDetails = function(team1, team2) {
  // Redirect to team comparison page with these teams pre-selected
  window.location.href = `team_compare.html?team1=${encodeURIComponent(team1)}&team2=${encodeURIComponent(team2)}`;
}

function generateSummaryStats() {
  const statsGrid = document.getElementById('statsGrid');
  
  // Calculate summary statistics
  let totalMatchups = 0;
  let totalGames = 0;
  let competitiveMatchups = 0; // Matchups with games played
  let mostGamesMatchup = { teams: '', games: 0 };
  let biggestRivalryLead = { team: '', opponent: '', wins: 0, losses: 0 };
  
  teams.forEach(team1 => {
    teams.forEach(team2 => {
      if (team1 !== team2) {
        totalMatchups++;
        const h2h = calculateHeadToHead(team1, team2);
        
        if (h2h && h2h.totalGames > 0) {
          if (totalMatchups % 2 === 0) { // Only count each matchup once
            competitiveMatchups++;
            totalGames += h2h.totalGames;
            
            if (h2h.totalGames > mostGamesMatchup.games) {
              mostGamesMatchup = {
                teams: `${team1} vs ${team2}`,
                games: h2h.totalGames
              };
            }
          }
          
          // Check for biggest rivalry lead (difference in wins)
          const team1Wins = h2h.team1 === team1 ? h2h.team1Wins : h2h.team2Wins;
          const team2Wins = h2h.team1 === team1 ? h2h.team2Wins : h2h.team1Wins;
          const leadDifference = Math.abs(team1Wins - team2Wins);
          
          if (leadDifference > Math.abs(biggestRivalryLead.wins - biggestRivalryLead.losses)) {
            if (team1Wins > team2Wins) {
              biggestRivalryLead = {
                team: team1,
                opponent: team2,
                wins: team1Wins,
                losses: team2Wins
              };
            } else if (team2Wins > team1Wins) {
              biggestRivalryLead = {
                team: team2,
                opponent: team1,
                wins: team2Wins,
                losses: team1Wins
              };
            }
          }
        }
      }
    });
  });
  
  // Adjust for double counting
  totalMatchups = totalMatchups / 2;
  competitiveMatchups = competitiveMatchups / 2;
  
  const statsHTML = `
    <div class="stat-item">
      <div class="stat-label">Total Teams</div>
      <div class="stat-value">${teams.length}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Possible Matchups</div>
      <div class="stat-value">${totalMatchups}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Matchups with Games</div>
      <div class="stat-value">${competitiveMatchups}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Total H2H Games</div>
      <div class="stat-value">${totalGames}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Most Games Played</div>
      <div class="stat-value">${mostGamesMatchup.games}</div>
      <div class="stat-subtext">${mostGamesMatchup.teams}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Biggest Rivalry Lead</div>
      <div class="stat-value">${biggestRivalryLead.wins}-${biggestRivalryLead.losses}</div>
      <div class="stat-subtext">${biggestRivalryLead.team} over ${biggestRivalryLead.opponent}</div>
    </div>
  `;
  
  statsGrid.innerHTML = statsHTML;
}

// Load data on page load
document.addEventListener('DOMContentLoaded', loadData);
</script>
<script src="team-colors.js"></script>
<script src="mobile-enhancements.js"></script>
</body>
</html>
