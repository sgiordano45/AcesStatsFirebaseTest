<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Charts - Mountainside Aces</title>
    <!-- D3.js no longer needed - using vanilla JavaScript -->
    <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="mobile-enhancements.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }

        .page-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .page-header p {
            margin: 1rem 0 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-back {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .nav-back:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            text-decoration: none;
        }

        .filters-nav {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            border: 1px solid #e1e5e9;
        }

        .filters-section {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 160px;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .chart-section-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            padding: 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: #f8f9fa;
            margin-bottom: 1rem;
        }

        .chart-section-controls .control-group {
            margin: 0;
        }

        select, button {
            padding: 0.5rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            font-size: 1rem;
            color: #333;
            transition: all 0.3s ease;
            min-height: 44px;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: #667eea;
            color: white;
            border: 2px solid #667eea;
            cursor: pointer;
            font-weight: 600;
            min-width: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        button:hover {
            background: #5a67d8;
            border-color: #5a67d8;
            transform: translateY(-2px);
            text-decoration: none;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            border: 1px solid #e1e5e9;
            margin-bottom: 2rem;
            position: relative;
        }

        .chart-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin: 2rem 0 1rem 0;
            text-align: center;
            padding: 0 2rem;
        }

        #team-charts-container {
            height: 400px;
            position: relative;
            margin: 0 2rem 2rem 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            width: calc(100% - 4rem);
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .chart-tooltip {
            font-family: Arial, sans-serif;
        }

        .bar {
            transition: opacity 0.3s ease;
            cursor: pointer;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem;
            margin-top: 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0fe 100%);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e1e5e9;
            transition: all 0.3s ease;
            text-align: center;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-size: 1.1rem;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 2rem;
            border: 1px solid #f5c6cb;
            text-align: center;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .page-container {
                padding: 1rem;
            }

            .page-header {
                padding: 2rem 1rem;
            }

            .page-header h1 {
                font-size: 2rem;
            }

            .nav-back {
                position: static;
                display: inline-block;
                margin-bottom: 1rem;
            }

            .filters-section {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .control-group {
                min-width: auto;
            }

            .chart-section-controls {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .action-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }

            select, button {
                width: 100%;
                text-align: center;
            }

            .chart-title {
                font-size: 1.3rem;
                margin: 1.5rem 0 1rem 0;
            }

            #team-charts-container {
                margin: 0 1rem 1rem 1rem;
                width: calc(100% - 2rem);
                height: 300px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
                margin: 1rem;
            }
        }

        @media (max-width: 480px) {
            .page-header h1 {
                font-size: 1.8rem;
            }

            .filters-nav {
                padding: 1rem;
            }

            .chart-title {
                font-size: 1.2rem;
                padding: 0 1rem;
            }

            #team-charts-container {
                height: 250px;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .stat-label {
                font-size: 0.8rem;
            }
        }
		/* Missing navigation styles */
.filters-nav {
  background: white;
  padding: 1.5rem;
  border-radius: 12px;
  margin-bottom: 2rem;
  box-shadow: 0 4px 6px rgba(0,0,0,0.07);
  border: 1px solid #e1e5e9;
}

.nav-container {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
  justify-content: center;
}

.nav-link {
  padding: 0.8rem 1.5rem;
  border: 2px solid #667eea;
  background: white;
  color: #667eea;
  text-decoration: none;
  border-radius: 8px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  white-space: nowrap;
}

.nav-link:hover {
  background: #667eea;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.nav-link.active {
  background: #667eea;
  color: white;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  transform: translateY(-1px);
}

.nav-link.pitching {
  border-color: #11998e;
  color: #11998e;
}

.nav-link.pitching:hover {
  background: #11998e;
  color: white;
  box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
}

.nav-link.batting {
  border-color: #667eea;
  color: #667eea;
}

.nav-link.batting:hover,
.nav-link.batting.active {
  background: #667eea;
  color: white;
}
    </style>
</head>
<body>
<div class="page-container">
    <div class="page-header">
        <h1>‚öæ Performance Charts</h1>
        <p>Interactive Analytics for Mountainside Aces Softball League</p>
    </div>

    <div class="filters-nav">
        <div class="filters-section">
            
	<nav class="nav-container">
      <a href="index.html" class="nav-link">üè† Home</a>
      <a href="current-season.html" class="nav-link">üçÇ Current Season</a>
      <a href="batting.html" class="nav-link batting active">‚öæ Batting Stats</a>
      <a href="pitching.html" class="nav-link pitching">ü•é Pitching Stats</a>
      <a href="teams.html" class="nav-link">üèÜ All Teams</a>
      <a href="players.html" class="nav-link">üë§ All Players</a>
      <a href="seasons.html" class="nav-link">üìÖ All Seasons</a>
      <a href="leaders.html" class="nav-link">üìä Career Leaders</a>
      <a href="compare.html" class="nav-link">‚öñÔ∏è Player Comparison</a>
      <a href="compare.html" class="nav-link">üÜö Team Comparison</a>
    </nav>
	
  <!-- Mobile Navigation -->
  <div class="mobile-nav-container">
    <div class="mobile-nav-header">
      <div class="mobile-nav-title">‚öæ Mountainside Aces</div>
      <button class="hamburger-menu" onclick="toggleMobileMenu()" aria-label="Toggle navigation">‚ò∞</button>
    </div>
    <nav class="mobile-nav-menu" id="mobileNavMenu">
      <a href="index.html" class="mobile-nav-item">üè† Home</a>
      <a href="current-season.html" class="mobile-nav-item">üçÇ Current Season</a>
      <a href="weekend-preview.html" class="mobile-nav-item">üîÆ Weekend Preview</a>
      <a href="projections.html" class="mobile-nav-item">üìà Playoff Projections</a>
      <a href="batting.html" class="mobile-nav-item">‚öæ Batting Stats</a>
      <a href="pitching.html" class="mobile-nav-item">ü•é Pitching Stats</a>
      <a href="teams.html" class="mobile-nav-item">üèÜ All Teams</a>
      <a href="players.html" class="mobile-nav-item">üë§ All Players</a>
      <a href="seasons.html" class="mobile-nav-item">üìÖ All Seasons</a>
      <a href="awards.html" class="mobile-nav-item">üèÖ Awards</a>
      <a href="leaders.html" class="mobile-nav-item">üìä Career Leaders</a>
      <a href="milestones.html" class="mobile-nav-item">üéØ Milestones</a>
      <a href="compare.html" class="mobile-nav-item">üìà Player Comparison</a>
      <a href="team_compare.html" class="mobile-nav-item">üÜö Team Comparison</a>
      <a href="h2h_grid.html" class="mobile-nav-item">‚öîÔ∏è Head-to-Head Grid</a>
	  <a href="pictures.html" class="mobile-nav-item">üì∑ Gallery</a>
    </nav>
  </div>
			<div class="control-group">
                <label for="seasonSelect">Season</label>
                <select id="seasonSelect">
                    <option value="2025-fall">2025 Fall</option>
                    <option value="2025-summer">2025 Summer</option>
                    <option value="2024-fall">2024 Fall</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="chartSection">Chart Type</label>
                <select id="chartSection">
                    <option value="team">Team Charts</option>
                    <option value="player">Player Charts</option>
                </select>
            </div>
        </div>
        
        <!-- Team Chart Controls -->
        <div id="teamControls" class="chart-section-controls">
            <div class="control-group">
                <label for="teamChartType">Team Chart Type</label>
                <select id="teamChartType">
                    <option value="wins">Wins Comparison</option>
                    <option value="batting">Batting Average</option>
                    <option value="runs">Runs Scored</option>
                    <option value="standings">Win Percentage</option>
                </select>
            </div>
        </div>
        
        <!-- Player Chart Controls -->
        <div id="playerControls" class="chart-section-controls" style="display: none;">
            <div class="control-group">
                <label for="teamSelect">Team</label>
                <select id="teamSelect">
                    <option value="">Select a team...</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="playerChartType">Player Chart Type</label>
                <select id="playerChartType">
                    <option value="player-batting">Batting Average</option>
                    <option value="player-obp">On-Base Percentage</option>
                    <option value="player-runs">Runs Scored</option>
                    <option value="player-acesbpi">AcesBPI</option>
                    <option value="player-radial-season">Radial (Season)</option>
                    <option value="player-radial-career">Radial (Career)</option>
                </select>
            </div>
            
            <div class="control-group" id="playerSelectGroup" style="display: none;">
                <label for="playerSelect">Player</label>
                <select id="playerSelect">
                    <option value="">Select a player...</option>
                </select>
            </div>
        </div>
        
        <div class="action-buttons">
            <button onclick="updateChartFromControls()">üìä Update Chart</button>
            <button onclick="exportChartData()">üíæ Export Data</button>
        </div>
    </div>

    <div class="chart-container">
        <div class="chart-title" id="chartTitle">Team Performance Chart</div>
        <div id="team-charts-container">
            <div class="loading">Loading chart data...</div>
        </div>
        
        <div class="stats-grid" id="statsGrid">
            <!-- Stats cards will be populated here -->
        </div>
    </div>
</div>

    <!-- Include team colors for styling -->
    <script src="team-colors.js"></script>
    <!-- Only include team-charts.js - don't load script.js on charts page -->
    <script src="team-charts.js"></script>

    <script>
        // Charts page integration code
        let teamCharts;
        let allTeamData = {};
        let allPlayerData = {};
        let currentSeason = '2025-fall';

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await initializeCharts();
                setupTeamSelectHandler();
            } catch (error) {
                console.error('Failed to initialize charts:', error);
                showError('Failed to load chart data. Please check that your data files are available.');
            }
        });

        function setupTeamSelectHandler() {
            const chartSection = document.getElementById('chartSection');
            const teamControls = document.getElementById('teamControls');
            const playerControls = document.getElementById('playerControls');
            const teamSelect = document.getElementById('teamSelect');
            const playerSelectGroup = document.getElementById('playerSelectGroup');
            
            // Handle section switching
            chartSection.addEventListener('change', () => {
                const section = chartSection.value;
                if (section === 'team') {
                    teamControls.style.display = 'flex';
                    playerControls.style.display = 'none';
                    playerSelectGroup.style.display = 'none';
                } else {
                    teamControls.style.display = 'none';
                    playerControls.style.display = 'flex';
                    updatePlayerChartControls();
                }
            });
            
            // Handle team selection for player charts
            teamSelect.addEventListener('change', () => {
                updatePlayerChartControls();
            });
            
            // Use event delegation for player chart type changes since the element gets recreated
            playerControls.addEventListener('change', (event) => {
                if (event.target.id === 'playerChartType') {
                    updatePlayerChartControls();
                }
            });
        }

        function updatePlayerChartControls() {
            const teamSelect = document.getElementById('teamSelect');
            const playerChartType = document.getElementById('playerChartType');
            const playerSelectGroup = document.getElementById('playerSelectGroup');
            const selectedTeam = teamSelect.value;
            const currentChartType = playerChartType.value; // Store current selection
            
            // Update available chart types based on team selection
            if (selectedTeam === 'all') {
                // For "All Teams", only show career radial option
                playerChartType.innerHTML = `
                    <option value="player-radial-career">Radial (Career)</option>
                `;
            } else if (selectedTeam) {
                // For specific teams, show all player chart options
                playerChartType.innerHTML = `
                    <option value="player-batting">Batting Average</option>
                    <option value="player-obp">On-Base Percentage</option>
                    <option value="player-runs">Runs Scored</option>
                    <option value="player-acesbpi">AcesBPI</option>
                    <option value="player-radial-season">Radial (Season)</option>
                    <option value="player-radial-career">Radial (Career)</option>
                `;
                
                // Try to restore the previous selection if it's still valid
                if (currentChartType && Array.from(playerChartType.options).some(option => option.value === currentChartType)) {
                    playerChartType.value = currentChartType;
                }
            }
            
            const chartType = playerChartType.value;
            
            // Show/hide player selector for radial charts or when a team is selected
            if ((chartType === 'player-radial-season' || chartType === 'player-radial-career') && selectedTeam) {
                playerSelectGroup.style.display = 'flex';
                updatePlayerDropdown(selectedTeam, chartType);
            } else {
                playerSelectGroup.style.display = 'none';
            }
        }

        function updateTeamSelector(availableTeams) {
            const teamSelect = document.getElementById('teamSelect');
            if (!teamSelect) return;
            
            // Clear existing options
            teamSelect.innerHTML = '<option value="">Select a team...</option>';
            
            // Add "All Teams" option for career radial charts
            const allTeamsOption = document.createElement('option');
            allTeamsOption.value = "all";
            allTeamsOption.textContent = "All Teams";
            teamSelect.appendChild(allTeamsOption);
            
            // Define the 11 Aces teams we want to show
            const acesTeamNames = [
                'Black', 'Blue', 'Green', 'Red', 'White', 'Orange', 
                'Silver', 'Purple', 'Gold', 'Carolina', 'Army'
            ];
            
            // Filter to only show the 11 Aces teams that have data
            const acesTeamsWithData = acesTeamNames.filter(teamName => 
                availableTeams.includes(teamName)
            );
            
            acesTeamsWithData.forEach(teamName => {
                const option = document.createElement('option');
                option.value = teamName; // Use exact team name as it appears in data
                option.textContent = 'Aces ' + teamName; // Display with "Aces" prefix
                teamSelect.appendChild(option);
            });
            
            console.log('Updated team selector with Aces teams:', acesTeamsWithData);
        }

        // UPDATED: Add function to filter out substitute players
        function isSubstitutePlayer(player) {
            const subValue = player.Sub || player.sub || "";
            return subValue.toString().trim().toLowerCase() === "yes";
        }

        function updatePlayerDropdown(selectedTeam, chartType) {
            const playerSelect = document.getElementById('playerSelect');
            const currentSeason = document.getElementById('seasonSelect').value;
            
            // Clear existing options
            playerSelect.innerHTML = '<option value="">Select a player...</option>';
            
            let availablePlayers = [];
            
            if (selectedTeam === 'all') {
                // For "All Teams", only career radial is available - get all non-sub players from 2022+
                availablePlayers = getAllNonSubPlayers();
            } else if (chartType === 'player-radial-career') {
                // For career view with specific team, get all non-sub players from that team across all seasons
                availablePlayers = getAllNonSubPlayersForTeam(selectedTeam);
            } else {
                // For season-specific charts, get non-sub players from the selected team and season
                availablePlayers = getPlayersForTeam(currentSeason, selectedTeam);
            }
            
            // Sort players alphabetically
            availablePlayers.sort((a, b) => a.name.localeCompare(b.name));
            
            // Add unique players to dropdown
            const uniquePlayers = [];
            const seenNames = new Set();
            
            availablePlayers.forEach(player => {
                if (!seenNames.has(player.name)) {
                    seenNames.add(player.name);
                    uniquePlayers.push(player);
                }
            });
            
            uniquePlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.name;
                option.textContent = player.name;
                playerSelect.appendChild(option);
            });
            
            console.log(`Updated player dropdown with ${uniquePlayers.length} players for team: ${selectedTeam}, chart: ${chartType}`);
        }

        function getAllNonSubPlayersForTeam(teamName) {
            const teamPlayers = [];
            
            // Collect all non-substitute players from the specified team across all seasons (2022+)
            Object.keys(allPlayerData).forEach(seasonKey => {
                const [year] = seasonKey.split('-');
                if (parseInt(year) >= 2022) {
                    if (allPlayerData[seasonKey][teamName]) {
                        const seasonPlayers = allPlayerData[seasonKey][teamName];
                        seasonPlayers.forEach(player => {
                            if (!isSubstitutePlayer(player)) {
                                teamPlayers.push(player);
                            }
                        });
                    }
                }
            });
            
            return teamPlayers;
        }

        function getAllNonSubPlayers() {
            const allPlayers = [];
            
            // Collect all non-substitute players from all seasons and teams (2022+)
            Object.keys(allPlayerData).forEach(seasonKey => {
                const [year] = seasonKey.split('-');
                if (parseInt(year) >= 2022) {
                    Object.keys(allPlayerData[seasonKey]).forEach(teamName => {
                        const teamPlayers = allPlayerData[seasonKey][teamName];
                        teamPlayers.forEach(player => {
                            if (!isSubstitutePlayer(player)) {
                                allPlayers.push(player);
                            }
                        });
                    });
                }
            });
            
            return allPlayers;
        }

        function calculateStatMaximums(chartType, season = null) {
            let relevantPlayers = [];
            
            if (chartType === 'player-radial-career') {
                // For career charts, use all non-sub players to get maximums
                relevantPlayers = getAllNonSubPlayers();
            } else {
                // For season charts, use players from that specific season
                if (season && allPlayerData[season]) {
                    Object.keys(allPlayerData[season]).forEach(teamName => {
                        const teamPlayers = allPlayerData[season][teamName];
                        teamPlayers.forEach(player => {
                            if (!isSubstitutePlayer(player)) {
                                relevantPlayers.push(player);
                            }
                        });
                    });
                }
            }
            
            if (relevantPlayers.length === 0) {
                return {
                    battingAvg: 1.0,
                    obp: 1.0,
                    runs: 50,
                    acesBPI: 100,
                    games: 25
                };
            }
            
            const maxStats = {
                battingAvg: Math.max(...relevantPlayers.map(p => p.battingAvg || 0), 0.1),
                obp: Math.max(...relevantPlayers.map(p => p.obp || 0), 0.1),
                runs: Math.max(...relevantPlayers.map(p => p.runs || 0), 1),
                acesBPI: Math.max(...relevantPlayers.map(p => p.acesBPI || 0), 1),
                games: Math.max(...relevantPlayers.map(p => p.games || 0), 1)
            };
            
            console.log('Calculated stat maximums:', maxStats);
            return maxStats;
        }

        function getPlayersForTeam(season, teamName) {
            if (!allPlayerData[season] || !allPlayerData[season][teamName]) {
                return [];
            }
            
            // UPDATED: Filter out substitute players
            const allPlayers = allPlayerData[season][teamName];
            const nonSubPlayers = allPlayers.filter(player => !isSubstitutePlayer(player));
            
            console.log(`Team ${teamName} ${season}: ${allPlayers.length} total players, ${nonSubPlayers.length} non-sub players`);
            
            return nonSubPlayers;
        }

        async function initializeCharts() {
            try {
                // Verify the container exists
                const container = document.getElementById('team-charts-container');
                if (!container) {
                    console.error('team-charts-container element not found!');
                    return;
                }
                
                // Show loading state
                container.innerHTML = '<div class="loading">Loading chart data...</div>';
                
                console.log('Loading data files...');
                
                let battingData = [];
                let gamesData = [];
                
                // Load batting data
                try {
                    const battingResponse = await fetch('data.json');
                    if (battingResponse.ok) {
                        battingData = await battingResponse.json();
                        console.log('Successfully loaded data.json with', battingData.length, 'batting records');
                    } else {
                        console.warn('data.json not found');
                    }
                } catch (error) {
                    console.warn('Error loading data.json:', error);
                }
                
                // Load games data
                try {
                    const gamesResponse = await fetch('games.json');
                    if (gamesResponse.ok) {
                        gamesData = await gamesResponse.json();
                        console.log('Successfully loaded games.json with', gamesData.length, 'game records');
                        console.log('Sample game record:', gamesData[0]);
                    } else {
                        console.warn('games.json not found');
                    }
                } catch (error) {
                    console.warn('Error loading games.json:', error);
                }
                
                // Process the data into team summaries
                if (battingData.length > 0 || gamesData.length > 0) {
                    allTeamData = processRealData(battingData, gamesData);
                } else {
                    console.log('No data files found, using sample data');
                    allTeamData = getSampleData();
                }
                
                // Initialize the TeamCharts instance
                console.log('Checking if TeamCharts class is available...');
                if (typeof TeamCharts === 'undefined') {
                    console.error('TeamCharts class is not available - team-charts.js may not have loaded properly');
                    showError('Chart library not loaded. Please check that team-charts.js is available.');
                    return;
                }
                
                console.log('TeamCharts class found, initializing...');
                teamCharts = new TeamCharts('team-charts-container', {
                    width: 800,
                    height: 400,
                    animation: true,
                    responsive: true
                });
                
                // Verify TeamCharts initialized correctly
                if (!teamCharts) {
                    console.error('TeamCharts instance is null/undefined');
                    showError('Failed to create TeamCharts instance');
                    return;
                }
                
                if (!teamCharts.container) {
                    console.error('TeamCharts container is null/undefined');
                    showError('Failed to initialize chart container');
                    return;
                }
                
                console.log('TeamCharts initialized successfully:', teamCharts);
                
                // Create initial chart
                const teams = getTeamsForSeason(currentSeason);
                console.log('Teams for current season:', teams);
                
                if (teams && teams.length > 0) {
                    console.log('Creating wins chart with', teams.length, 'teams');
                    teamCharts.createWinsChart(teams);
                    updateStatsGrid(teams);
                    updateChartTitle('wins', currentSeason);
                } else {
                    showError('No team data available for the selected season.');
                }
                
            } catch (error) {
                console.error('Error during initialization:', error);
                showError('Failed to initialize charts: ' + error.message);
            }
        }

        function processRealData(battingData, gamesData) {
            console.log('Processing real data with batting and games...');
            
            const teamStats = {};
            const playerData = {};
            const seasonsFound = new Set();
            const teamsFound = new Set();
            const today = new Date();
            
            // First, process batting data for runs, hits, batting averages
            if (battingData && battingData.length > 0) {
                console.log('Processing batting data from', battingData.length, 'records');
                
                battingData.forEach(player => {
                    if (!player.team || !player.name) return;
                    
                    // Filter batting data to only include 2022 and beyond
                    const playerYear = parseInt(player.year);
                    if (playerYear < 2022) return;
                    
                    const teamName = player.team.trim();
                    const playerName = player.name.trim();
                    const year = player.year || '2025';
                    const season = player.season || 'fall';
                    const seasonKey = `${year}-${season.toLowerCase()}`;
                    
                    seasonsFound.add(seasonKey);
                    teamsFound.add(teamName);
                    
                    // Store individual player data
                    if (!playerData[seasonKey]) {
                        playerData[seasonKey] = {};
                    }
                    if (!playerData[seasonKey][teamName]) {
                        playerData[seasonKey][teamName] = [];
                    }
                    
                    // Calculate player stats
                    const atBats = parseInt(player.atBats) || 0;
                    const hits = parseInt(player.hits) || 0;
                    const runs = parseInt(player.runs) || 0;
                    const walks = parseInt(player.walks) || 0;
                    const games = parseInt(player.games) || 0;
                    const acesWar = player.AcesWar && player.AcesWar !== "N/A" ? parseFloat(player.AcesWar) : 0;
                    
                    const battingAvg = atBats > 0 ? hits / atBats : 0;
                    const plateAppearances = atBats + walks;
                    const obp = plateAppearances > 0 ? (hits + walks) / plateAppearances : 0;
                    
                    // UPDATED: Store substitute status from player data
                    playerData[seasonKey][teamName].push({
                        name: playerName,
                        team: teamName,
                        games: games,
                        atBats: atBats,
                        hits: hits,
                        runs: runs,
                        walks: walks,
                        battingAvg: battingAvg,
                        obp: obp,
                        acesBPI: acesWar,
                        Sub: player.Sub || player.sub || "" // Store substitute status
                    });
                    
                    // Only aggregate team stats for non-substitute players
                    const isSubPlayer = isSubstitutePlayer(player);
                    if (!isSubPlayer) {
                        if (!teamStats[seasonKey]) {
                            teamStats[seasonKey] = {};
                        }
                        
                        if (!teamStats[seasonKey][teamName]) {
                            teamStats[seasonKey][teamName] = {
                                name: teamName,
                                wins: 0,
                                losses: 0,
                                ties: 0,
                                runs: 0,
                                hits: 0,
                                atBats: 0,
                                players: 0,
                                totalGames: 0
                            };
                        }
                        
                        const team = teamStats[seasonKey][teamName];
                        team.runs += runs;
                        team.hits += hits;
                        team.atBats += atBats;
                        team.players++;
                    }
                });
            }
            
            // Process games data for actual win/loss records (same as before)
            if (gamesData && gamesData.length > 0) {
                console.log('Processing games data from', gamesData.length, 'total games');
                
                let completedGames = 0;
                let futureGames = 0;
                
                gamesData.forEach(game => {
                    // Skip games without required data
                    if (!game["home team"] || !game["away team"]) return;
                    
                    // Filter to only include 2022 and beyond
                    const gameYear = parseInt(game.year);
                    if (gameYear < 2022) return;
                    
                    // Skip future games - games without a winner (empty string or null)
                    const hasWinner = game.winner && game.winner.trim() !== '' && game.winner.trim() !== 'null';
                    
                    // Also check if it's a future date (your data has dates like "9/28/2025")
                    let isFutureGame = false;
                    if (game.date && game.date !== 'n/a') {
                        const gameDate = new Date(game.date);
                        if (!isNaN(gameDate.getTime())) {
                            isFutureGame = gameDate > today;
                        }
                    }
                    
                    // Only process completed games (have winner and not in future)
                    if (!hasWinner || isFutureGame) {
                        futureGames++;
                        return;
                    }
                    
                    completedGames++;
                    
                    const homeTeam = game["home team"].trim();
                    const awayTeam = game["away team"].trim();
                    const winner = game.winner.trim();
                    
                    teamsFound.add(homeTeam);
                    teamsFound.add(awayTeam);
                    
                    // Use actual season from games data
                    const year = game.year || '2025';
                    const season = game.season ? game.season.toLowerCase() : 'fall';
                    const seasonKey = `${year}-${season}`;
                    
                    seasonsFound.add(seasonKey);
                    
                    if (!teamStats[seasonKey]) {
                        teamStats[seasonKey] = {};
                    }
                    
                    // Initialize teams if they don't exist
                    [homeTeam, awayTeam].forEach(teamName => {
                        if (!teamStats[seasonKey][teamName]) {
                            teamStats[seasonKey][teamName] = {
                                name: teamName,
                                wins: 0,
                                losses: 0,
                                ties: 0,
                                runs: 0,
                                hits: 0,
                                atBats: 0,
                                players: 0,
                                totalGames: 0
                            };
                        }
                    });
                    
                    // Record game results
                    const homeTeamStats = teamStats[seasonKey][homeTeam];
                    const awayTeamStats = teamStats[seasonKey][awayTeam];
                    
                    if (winner === "Tie") {
                        homeTeamStats.ties++;
                        awayTeamStats.ties++;
                    } else if (winner === homeTeam) {
                        homeTeamStats.wins++;
                        awayTeamStats.losses++;
                    } else if (winner === awayTeam) {
                        awayTeamStats.wins++;
                        homeTeamStats.losses++;
                    }
                    
                    homeTeamStats.totalGames++;
                    awayTeamStats.totalGames++;
                });
                
                console.log(`Processed ${completedGames} completed games, skipped ${futureGames} future/incomplete games`);
            }
            
            // Sort seasons chronologically (most recent first)
            const sortedSeasons = Array.from(seasonsFound).sort((a, b) => {
                const [yearA, seasonA] = a.split('-');
                const [yearB, seasonB] = b.split('-');
                
                // Compare years first
                if (yearA !== yearB) return yearB - yearA; // Newer year first
                
                // Within same year, fall > summer > spring
                const seasonOrder = { 'fall': 3, 'summer': 2, 'spring': 1 };
                return (seasonOrder[seasonB] || 0) - (seasonOrder[seasonA] || 0);
            });
            
            console.log('Seasons found in data (sorted):', sortedSeasons);
            console.log('Teams found in data:', Array.from(teamsFound).sort());
            
            // Convert to final format
            const result = {};
            
            // Add all seasons that were found in the data
            sortedSeasons.forEach(seasonKey => {
                result[seasonKey] = { teams: [] };
            });
            
            Object.keys(teamStats).forEach(seasonKey => {
                if (result[seasonKey]) {
                    result[seasonKey].teams = Object.values(teamStats[seasonKey])
                        .filter(team => team.totalGames > 0 || team.players > 0) // Include teams with games OR batting data
                        .map(team => ({
                            ...team,
                            batting_avg: team.atBats > 0 ? team.hits / team.atBats : 0,
                            winPct: team.totalGames > 0 ? team.wins / team.totalGames : 0
                        }));
                }
            });
            
            // Store player data globally
            allPlayerData = playerData;
            
            // Log some stats for debugging
            Object.keys(result).forEach(seasonKey => {
                const teams = result[seasonKey].teams;
                if (teams.length > 0) {
                    const teamsWithGames = teams.filter(t => t.totalGames > 0);
                    if (teamsWithGames.length > 0) {
                        const minWins = Math.min(...teamsWithGames.map(t => t.wins));
                        const maxWins = Math.max(...teamsWithGames.map(t => t.wins));
                        console.log(`${seasonKey}: ${teams.length} teams total, ${teamsWithGames.length} with games played, win range: ${minWins}-${maxWins} wins`);
                    } else {
                        console.log(`${seasonKey}: ${teams.length} teams (batting data only)`);
                    }
                }
            });
            
            // Update the season selector and team selector
            updateSeasonSelector(sortedSeasons);
            updateTeamSelector(Array.from(teamsFound).sort());
            
            return result;
        }
        
        function updateSeasonSelector(availableSeasons) {
            const seasonSelect = document.getElementById('seasonSelect');
            if (!seasonSelect) return;
            
            // Clear existing options
            seasonSelect.innerHTML = '';
            
            // Sort seasons (most recent first) - already sorted in processRealData
            
            // Add options for each season found
            availableSeasons.forEach(seasonKey => {
                const option = document.createElement('option');
                option.value = seasonKey;
                
                // Format display text
                const [year, season] = seasonKey.split('-');
                const seasonDisplay = season.charAt(0).toUpperCase() + season.slice(1);
                option.textContent = `${year} ${seasonDisplay}`;
                
                seasonSelect.appendChild(option);
            });
            
            // Set the current season to the first (most recent) option
            if (availableSeasons.length > 0) {
                currentSeason = availableSeasons[0];
                seasonSelect.value = currentSeason;
            }
            
            console.log('Updated season selector with:', availableSeasons);
        }

        function getSampleData() {
            return {
                '2025-fall': {
                    teams: [
                        { name: 'Aces Black', wins: 8, losses: 2, ties: 0, batting_avg: 0.425, runs: 89, totalGames: 10 },
                        { name: 'Aces Green', wins: 7, losses: 3, ties: 0, batting_avg: 0.398, runs: 95, totalGames: 10 },
                        { name: 'Aces Blue', wins: 6, losses: 4, ties: 0, batting_avg: 0.387, runs: 78, totalGames: 10 },
                        { name: 'Aces Red', wins: 5, losses: 5, ties: 0, batting_avg: 0.356, runs: 67, totalGames: 10 },
                        { name: 'Aces White', wins: 4, losses: 6, ties: 0, batting_avg: 0.342, runs: 58, totalGames: 10 },
                        { name: 'Aces Orange', wins: 3, losses: 7, ties: 0, batting_avg: 0.329, runs: 52, totalGames: 10 }
                    ]
                },
                '2025-summer': { teams: [] },
                '2024-fall': { teams: [] }
            };
        }

        function getTeamsForSeason(season) {
            return allTeamData[season] ? allTeamData[season].teams : [];
        }

        function updateChartFromControls() {
            const season = document.getElementById('seasonSelect').value;
            const chartSection = document.getElementById('chartSection').value;
            
            currentSeason = season;
            
            if (chartSection === 'team') {
                // Team comparison charts
                const teamChartType = document.getElementById('teamChartType').value;
                const teams = getTeamsForSeason(season);
                
                if (!teams || teams.length === 0) {
                    showError(`No team data available for ${season}`);
                    return;
                }

                try {
                    console.log('Attempting to create team chart with type:', teamChartType);
                    
                    switch(teamChartType) {
                        case 'wins':
                            teamCharts.createWinsChart(teams);
                            break;
                        case 'batting':
                            teamCharts.createBattingChart(teams);
                            break;
                        case 'runs':
                            teamCharts.createRunsChart(teams);
                            break;
                        case 'standings':
                            teamCharts.createStandingsChart(teams);
                            break;
                        default:
                            console.warn('Unknown team chart type:', teamChartType);
                            return;
                    }
                    
                    updateStatsGrid(teams);
                    updateChartTitle(teamChartType, season, 'all');
                    
                } catch (error) {
                    console.error('Error updating team chart:', error);
                    showError('Failed to update chart: ' + error.message);
                }
            } else {
                // Player charts for specific team
                const team = document.getElementById('teamSelect').value;
                const playerChartType = document.getElementById('playerChartType').value;
                
                if (!team) {
                    showError('Please select a team for player charts.');
                    return;
                }
                
                // Handle "All Teams" case - only career radial is available
                if (team === 'all') {
                    if (playerChartType !== 'player-radial-career') {
                        showError('Only Career Radial charts are available when "All Teams" is selected.');
                        return;
                    }
                    
                    const selectedPlayer = document.getElementById('playerSelect').value;
                    if (!selectedPlayer) {
                        showError('Please select a player from the dropdown for career radial charts.');
                        return;
                    }
                    
                    try {
                        createPlayerRadialCharts(selectedPlayer, season, 'All Teams', 'career');
                        const careerPlayer = { name: selectedPlayer };
                        updatePlayerStatsGrid([careerPlayer], selectedPlayer + ' Career');
                    } catch (error) {
                        console.error('Error updating career radial chart:', error);
                        showError('Failed to update career radial chart: ' + error.message);
                    }
                    return;
                }
                
                // Handle specific team selection
                const players = getPlayersForTeam(season, team);
                
                if (!players || players.length === 0) {
                    showError(`No non-substitute player data available for Aces ${team} in ${season}`);
                    return;
                }

                try {
                    switch(playerChartType) {
                        case 'player-batting':
                            teamCharts.createPlayerChart(players, 'battingAvg', 'Player Batting Average');
                            updatePlayerStatsGrid(players, 'Aces ' + team);
                            updateChartTitle(playerChartType, season, 'Aces ' + team);
                            break;
                        case 'player-obp':
                            teamCharts.createPlayerChart(players, 'obp', 'Player On-Base Percentage');
                            updatePlayerStatsGrid(players, 'Aces ' + team);
                            updateChartTitle(playerChartType, season, 'Aces ' + team);
                            break;
                        case 'player-runs':
                            teamCharts.createPlayerChart(players, 'runs', 'Player Runs Scored');
                            updatePlayerStatsGrid(players, 'Aces ' + team);
                            updateChartTitle(playerChartType, season, 'Aces ' + team);
                            break;
                        case 'player-acesbpi':
                            teamCharts.createPlayerChart(players, 'acesBPI', 'Player AcesBPI');
                            updatePlayerStatsGrid(players, 'Aces ' + team);
                            updateChartTitle(playerChartType, season, 'Aces ' + team);
                            break;
                        case 'player-radial-season':
                            const selectedPlayerSeason = document.getElementById('playerSelect').value;
                            if (!selectedPlayerSeason) {
                                showError('Please select a player from the dropdown for radial charts.');
                                return;
                            }
                            createPlayerRadialCharts(selectedPlayerSeason, season, team, 'season');
                            updatePlayerStatsGrid([players.find(p => p.name === selectedPlayerSeason)].filter(Boolean), 'Aces ' + team);
                            break;
                        case 'player-radial-career':
                            const selectedPlayerCareer = document.getElementById('playerSelect').value;
                            if (!selectedPlayerCareer) {
                                showError('Please select a player from the dropdown for radial charts.');
                                return;
                            }
                            createPlayerRadialCharts(selectedPlayerCareer, season, team, 'career');
                            const careerPlayer = { name: selectedPlayerCareer };
                            updatePlayerStatsGrid([careerPlayer], selectedPlayerCareer + ' Career');
                            break;
                        default:
                            console.warn('Unknown player chart type:', playerChartType);
                            return;
                    }
                    
                } catch (error) {
                    console.error('Error updating player chart:', error);
                    showError('Failed to update player chart: ' + error.message);
                }
            }
        }

        function updateChartTitle(chartType, season, team) {
            const titles = {
                wins: 'Team Wins Comparison',
                batting: 'Team Batting Averages',
                runs: 'Runs Scored by Team',
                standings: 'Team Win Percentage',
                'player-batting': 'Player Batting Averages',
                'player-obp': 'Player On-Base Percentage',
                'player-runs': 'Player Runs Scored',
                'player-acesbpi': 'Player AcesBPI'
            };
            
            const title = titles[chartType] || 'Performance Chart';
            const seasonFormatted = season.replace('-', ' ').toUpperCase();
            
            if (team === 'all') {
                document.getElementById('chartTitle').textContent = `${title} - ${seasonFormatted}`;
            } else {
                document.getElementById('chartTitle').textContent = `${title} - ${team} (${seasonFormatted})`;
            }
        }

        function updatePlayerStatsGrid(players, teamName) {
            if (!players || players.length === 0) {
                document.getElementById('statsGrid').innerHTML = '<div class="error">No non-substitute player data available</div>';
                return;
            }

            const totalAtBats = players.reduce((sum, player) => sum + (player.atBats || 0), 0);
            const totalHits = players.reduce((sum, player) => sum + (player.hits || 0), 0);
            const totalRuns = players.reduce((sum, player) => sum + (player.runs || 0), 0);
            const avgBattingAvg = players.reduce((sum, player) => sum + (player.battingAvg || 0), 0) / players.length;
            const avgOBP = players.reduce((sum, player) => sum + (player.obp || 0), 0) / players.length;
            const topPlayer = players.reduce((prev, curr) => (curr.battingAvg || 0) > (prev.battingAvg || 0) ? curr : prev, players[0]);
            
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${players.length}</div>
                    <div class="stat-label">Non-Sub Players</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalAtBats}</div>
                    <div class="stat-label">Total At-Bats</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalRuns}</div>
                    <div class="stat-label">Total Runs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">.${Math.round(avgBattingAvg * 1000).toString().padStart(3, '0')}</div>
                    <div class="stat-label">Team Avg. BA</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">.${Math.round(avgOBP * 1000).toString().padStart(3, '0')}</div>
                    <div class="stat-label">Team Avg. OBP</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${topPlayer.name.split(' ').pop()}</div>
                    <div class="stat-label">Top BA (.${Math.round(topPlayer.battingAvg * 1000).toString().padStart(3, '0')})</div>
                </div>
            `;
            
            document.getElementById('statsGrid').innerHTML = statsHtml;
        }

        function updateStatsGrid(teams) {
            if (!teams || teams.length === 0) {
                document.getElementById('statsGrid').innerHTML = '<div class="error">No team data available</div>';
                return;
            }

            const totalGames = teams.reduce((sum, team) => sum + (team.totalGames || team.wins + team.losses + team.ties), 0);
            const totalRuns = teams.reduce((sum, team) => sum + (team.runs || 0), 0);
            const avgBattingAvg = teams.reduce((sum, team) => sum + (team.batting_avg || 0), 0) / teams.length;
            const topTeam = teams.reduce((prev, curr) => (curr.wins || 0) > (prev.wins || 0) ? curr : prev, teams[0]);
            
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${teams.length}</div>
                    <div class="stat-label">Active Teams</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalGames}</div>
                    <div class="stat-label">Total Games Played</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalRuns}</div>
                    <div class="stat-label">Total Runs Scored</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">.${Math.round(avgBattingAvg * 1000).toString().padStart(3, '0')}</div>
                    <div class="stat-label">League Avg. BA (Non-Sub)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${topTeam.name.replace('Aces ', '')}</div>
                    <div class="stat-label">Most Wins (${topTeam.wins || 0})</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalGames > 0 ? (totalRuns / totalGames * 2).toFixed(1) : '0.0'}</div>
                    <div class="stat-label">Runs Per Game</div>
                </div>
            `;
            
            document.getElementById('statsGrid').innerHTML = statsHtml;
        }

        function exportChartData() {
            try {
                const season = document.getElementById('seasonSelect').value;
                const teams = getTeamsForSeason(season);
                
                if (!teams || teams.length === 0) {
                    alert('No data available to export for the selected season.');
                    return;
                }

                const headers = ['Team', 'Wins', 'Losses', 'Ties', 'Batting Avg', 'Runs Scored', 'Games Played'];
                const csvContent = [
                    headers.join(','),
                    ...teams.map(team => [
                        `"${team.name || ''}"`,
                        team.wins || 0,
                        team.losses || 0,
                        team.ties || 0,
                        (team.batting_avg || 0).toFixed(3),
                        team.runs || 0,
                        team.totalGames || (team.wins + team.losses + team.ties)
                    ].join(','))
                ].join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `team-stats-${season}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
            } catch (error) {
                console.error('Error exporting data:', error);
                alert('Failed to export data: ' + error.message);
            }
        }

        function showError(message) {
            const container = document.getElementById('team-charts-container');
            if (container) {
                container.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${message}
                    </div>
                `;
            } else {
                console.error('Cannot show error - container not found:', message);
            }
        }

        function createPlayerRadialCharts(selectedPlayerName, season, team, viewType) {
            if (!selectedPlayerName) {
                showError('Please select a player for the radial chart.');
                return;
            }
            
            let playerData;
            let maxStats;
            
            if (viewType === 'career') {
                // Calculate career stats for the selected player
                playerData = calculateCareerStats(selectedPlayerName);
                maxStats = calculateStatMaximums('player-radial-career');
                
                teamCharts.createPlayerRadialChart(playerData, selectedPlayerName, 'career', { maxStats });
                updateChartTitle('player-radial-career', 'Career', `${selectedPlayerName} Career Stats`);
            } else {
                // Find the player's season data
                const players = getPlayersForTeam(season, team);
                playerData = players.find(p => p.name === selectedPlayerName);
                
                if (!playerData) {
                    showError(`Player ${selectedPlayerName} not found in ${team} for ${season}.`);
                    return;
                }
                
                maxStats = calculateStatMaximums('player-radial-season', season);
                
                teamCharts.createPlayerRadialChart(playerData, selectedPlayerName, 'season', { maxStats });
                updateChartTitle('player-radial-season', season, `Aces ${team} - ${selectedPlayerName}`);
            }
        }

        function calculateCareerStats(playerName) {
            let totalGames = 0;
            let totalAtBats = 0;
            let totalHits = 0;
            let totalRuns = 0;
            let totalWalks = 0;
            let totalAcesBPI = 0;
            let seasonsPlayed = 0;

            // UPDATED: Aggregate across all seasons and teams, excluding substitute seasons
            Object.keys(allPlayerData).forEach(seasonKey => {
                Object.keys(allPlayerData[seasonKey]).forEach(teamName => {
                    const teamPlayers = allPlayerData[seasonKey][teamName];
                    const player = teamPlayers.find(p => p.name === playerName);
                    
                    if (player && !isSubstitutePlayer(player)) {
                        totalGames += player.games || 0;
                        totalAtBats += player.atBats || 0;
                        totalHits += player.hits || 0;
                        totalRuns += player.runs || 0;
                        totalWalks += player.walks || 0;
                        totalAcesBPI += player.acesBPI || 0;
                        seasonsPlayed++;
                    }
                });
            });

            const battingAvg = totalAtBats > 0 ? totalHits / totalAtBats : 0;
            const plateAppearances = totalAtBats + totalWalks;
            const obp = plateAppearances > 0 ? (totalHits + totalWalks) / plateAppearances : 0;
            const avgAcesBPI = seasonsPlayed > 0 ? totalAcesBPI / seasonsPlayed : 0;

            return {
                name: playerName,
                games: totalGames,
                atBats: totalAtBats,
                hits: totalHits,
                runs: totalRuns,
                walks: totalWalks,
                battingAvg: battingAvg,
                obp: obp,
                acesBPI: avgAcesBPI
            };
        }
    </script>
 <script src="mobile-enhancements.js"></script>
</body>
</html>
