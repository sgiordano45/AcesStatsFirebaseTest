<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Preview - Mountainside Aces</title>
<link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="mobile-enhancements.css">
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
  }

  .header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-align: center;
    padding: 2rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .header h1 {
    margin: 0;
    font-size: 2.5rem;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  .header p {
    margin: 0.5rem 0 0 0;
    font-size: 1.1rem;
    opacity: 0.9;
  }

  .back-nav {
    background: rgba(255, 255, 255, 0.95);
    padding: 1rem 2rem;
    border-bottom: 1px solid #eee;
  }

  .back-nav a {
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
    margin-right: 2rem;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    transition: background-color 0.3s;
  }

  .back-nav a:hover {
    background: #f8f9fa;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  .matchup-header {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.07);
    text-align: center;
  }

  .teams-display {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 3rem;
    margin: 1rem 0;
  }

  .team-info {
    text-align: center;
    flex: 1;
    max-width: 300px;
  }

  .team-logo {
    width: 80px !important;
    height: 80px !important;
    margin: 0 auto 1rem auto !important;
    border-radius: 50% !important;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1) !important;
    display: block !important;
  }

  .team-name {
    font-size: 2rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 0.5rem;
  }

  .team-record {
    font-size: 1.2rem;
    color: #666;
    margin-bottom: 1rem;
  }

  .vs-divider {
    font-size: 3rem;
    font-weight: bold;
    color: #667eea;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  }

  .game-details {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
  }

  .section {
    background: white;
    border-radius: 12px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.07);
    overflow: hidden;
  }

  .section-header {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    padding: 1.5rem 2rem;
    font-size: 1.4rem;
    font-weight: bold;
  }

  .peters-preview-header {
    background: linear-gradient(135deg, #fd7e14 0%, #e83e8c 100%);
    color: white;
    padding: 1.5rem 2rem;
    font-size: 1.4rem;
    font-weight: bold;
  }

  .section-content {
    padding: 2rem;
  }

  .peters-preview-content {
    display: flex;
    align-items: flex-start;
    gap: 2rem;
  }

  .peters-preview-image {
    flex-shrink: 0;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    border: 3px solid #fd7e14;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    padding: 8px;
    background-color: #fd7e14;
    overflow: hidden;
  }

  .peters-preview-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    border-radius: 50%;
  }

  .peters-preview-main {
    flex: 1;
    min-width: 0;
  }

  .odds-display {
    display: flex;
    justify-content: space-around;
    align-items: center;
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .odds-item {
    text-align: center;
    flex: 1;
    min-width: 120px;
  }

  .odds-team {
    font-weight: bold;
    color: #333;
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
  }

  .odds-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #667eea;
    background: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    border: 2px solid #667eea;
    display: inline-block;
  }

  .favorite {
    color: #28a745;
    border-color: #28a745;
  }

  .preview-text {
    background: #ffffff;
    border-left: 4px solid #fd7e14;
    padding: 1.5rem;
    border-radius: 0 8px 8px 0;
    line-height: 1.6;
    font-size: 1.05rem;
    color: #333;
    margin-top: 1rem;
  }

  .comparison-grid {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 1rem;
    align-items: center;
  }

  .team-stats {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
  }

  .team-stats h4 {
    margin: 0 0 1rem 0;
    color: #333;
    font-size: 1.2rem;
  }

  .stat-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid #e9ecef;
  }

  .stat-row:last-child {
    border-bottom: none;
  }

  .stat-label {
    font-weight: 500;
    color: #495057;
  }

  .stat-value {
    font-weight: bold;
    color: #333;
  }

  .vs-label {
    font-size: 1.5rem;
    font-weight: bold;
    color: #667eea;
    text-align: center;
    padding: 0 1rem;
  }

  .h2h-summary {
    text-align: center;
    background: #e9ecef;
    padding: 1rem;
    border-radius: 8px;
    margin: 1rem 0;
  }

  .h2h-record {
    font-size: 1.5rem;
    font-weight: bold;
    color: #495057;
  }

  .history-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }

  .history-table th,
  .history-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #eee;
  }

  .history-table th {
    background-color: #f8f9fa;
    font-weight: bold;
    color: #333;
  }

  .history-table tr:nth-child(even) {
    background-color: #fafafa;
  }

  .history-table tr:hover {
    background-color: #f0f0f0;
  }

  .winner-highlight {
    font-weight: bold;
    color: #28a745;
  }

  .no-data {
    text-align: center;
    padding: 2rem;
    color: #666;
    font-style: italic;
  }

  .advantage {
    color: #28a745;
    font-weight: bold;
  }

  .disadvantage {
    color: #dc3545;
    font-weight: bold;
  }

  .key-players-grid {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 1rem;
    align-items: flex-start;
  }

  .player-card {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    border-left: 4px solid #667eea;
  }

  .player-name {
    font-weight: bold;
    font-size: 1.1rem;
    color: #333;
    margin-bottom: 0.5rem;
  }

  .player-stats {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    color: #666;
  }

  .player-stat {
    text-align: center;
  }

  .player-stat-label {
    display: block;
    font-size: 0.8rem;
    color: #888;
    margin-bottom: 2px;
  }

  .player-stat-value {
    font-weight: bold;
    color: #333;
  }

  @media (max-width: 768px) {
    .teams-display {
      flex-direction: column;
      gap: 1rem;
    }

    .vs-divider {
      font-size: 2rem;
      transform: rotate(90deg);
    }

    .comparison-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .vs-label {
      display: none;
    }

    .container {
      padding: 1rem;
    }

    .section-content {
      padding: 1rem;
    }

    .team-name {
      font-size: 1.5rem;
    }

    .odds-display {
      flex-direction: column;
      gap: 1rem;
    }

    .odds-item {
      min-width: 200px;
    }
  }
  /* Missing navigation styles */
.filters-nav {
  background: white;
  padding: 1.5rem;
  border-radius: 12px;
  margin-bottom: 2rem;
  box-shadow: 0 4px 6px rgba(0,0,0,0.07);
  border: 1px solid #e1e5e9;
}

.nav-container {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
  justify-content: center;
}

.nav-link {
  padding: 0.8rem 1.5rem;
  border: 2px solid #667eea;
  background: white;
  color: #667eea;
  text-decoration: none;
  border-radius: 8px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  white-space: nowrap;
}

.nav-link:hover {
  background: #667eea;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.nav-link.active {
  background: #667eea;
  color: white;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  transform: translateY(-1px);
}

.nav-link.pitching {
  border-color: #11998e;
  color: #11998e;
}

.nav-link.pitching:hover {
  background: #11998e;
  color: white;
  box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
}

.nav-link.batting {
  border-color: #667eea;
  color: #667eea;
}

.nav-link.batting:hover,
.nav-link.batting.active {
  background: #667eea;
  color: white;
}
</style>
</head>
<body>
  <div class="filters-nav">
    <nav class="nav-container">
      <a href="index.html" class="nav-link">üè† Home</a>
      <a href="current-season.html" class="nav-link">üçÇ Current Season</a> 
      <a href="weekend-preview.html" class="nav-link">üîÆ Weekend Preview</a>
    </nav>
  </div>

  <!-- Mobile Navigation -->
  <div class="mobile-nav-container">
    <div class="mobile-nav-header">
      <div class="mobile-nav-title">‚öæ Mountainside Aces</div>
      <button class="hamburger-menu" onclick="toggleMobileMenu()" aria-label="Toggle navigation">‚ò∞</button>
    </div>
    <nav class="mobile-nav-menu" id="mobileNavMenu">
      <a href="index.html" class="mobile-nav-item">üè† Home</a>
      <a href="current-season.html" class="mobile-nav-item">üçÇ Current Season</a>
      <a href="weekend-preview.html" class="mobile-nav-item">üîÆ Weekend Preview</a>
      <a href="projections.html" class="mobile-nav-item">üìà Playoff Projections</a>
      <a href="batting.html" class="mobile-nav-item">‚öæ Batting Stats</a>
      <a href="pitching.html" class="mobile-nav-item">ü•é Pitching Stats</a>
      <a href="teams.html" class="mobile-nav-item">üèÜ All Teams</a>
      <a href="players.html" class="mobile-nav-item">üë§ All Players</a>
      <a href="seasons.html" class="mobile-nav-item">üìÖ All Seasons</a>
      <a href="awards.html" class="mobile-nav-item">üèÖ Awards</a>
      <a href="leaders.html" class="mobile-nav-item">üìä Career Leaders</a>
      <a href="milestones.html" class="mobile-nav-item">üéØ Milestones</a>
      <a href="compare.html" class="mobile-nav-item">üìà Player Comparison</a>
      <a href="team_compare.html" class="mobile-nav-item">üÜö Team Comparison</a>
      <a href="h2h_grid.html" class="mobile-nav-item">‚öîÔ∏è Head-to-Head Grid</a>
	  <a href="pictures.html" class="mobile-nav-item">üì∑ Gallery</a>
    </nav>
  </div>


  <header class="header">
    <h1>Game Preview</h1>
    <p id="gameInfo">Loading game details...</p>
  </header>

  <div class="container">
    <!-- Matchup Header -->
    <div class="matchup-header">
      <div class="teams-display">
        <div class="team-info" id="awayTeamInfo">
          <img class="team-logo" id="awayTeamLogo" src="" alt="" onerror="this.style.display='none'">
          <div class="team-name" id="awayTeamName">--</div>
          <div class="team-record" id="awayTeamRecord">--</div>
        </div>
        
        <div class="vs-divider">@</div>
        
        <div class="team-info" id="homeTeamInfo">
          <img class="team-logo" id="homeTeamLogo" src="" alt="" onerror="this.style.display='none'">
          <div class="team-name" id="homeTeamName">--</div>
          <div class="team-record" id="homeTeamRecord">--</div>
        </div>
      </div>
      
      <div class="game-details" id="gameDetails">
        Loading game details...
      </div>
    </div>

    <!-- Peters Preview -->
    <div class="section">
      <div class="peters-preview-header">
        Peters Preview
      </div>
      <div class="section-content">
        <div id="petersPreviewContent">
          Loading Peters Preview...
        </div>
      </div>
    </div>

    <!-- Head to Head Record -->
    <div class="section">
      <div class="section-header">
        Head-to-Head Record
      </div>
      <div class="section-content">
        <div class="h2h-summary" id="h2hSummary">
          Loading head-to-head record...
        </div>
      </div>
    </div>

    <!-- Key Players -->
    <div class="section">
      <div class="section-header">
        Key Players
      </div>
      <div class="section-content">
        <div class="comparison-grid" id="keyPlayersComparison">
          Loading key players...
        </div>
      </div>
    </div>

    <!-- Team Comparison -->
    <div class="section">
      <div class="section-header">
        Season Statistics Comparison
      </div>
      <div class="section-content">
        <h4>Batting Statistics</h4>
        <div class="comparison-grid" id="battingComparison">
          Loading batting comparison...
        </div>
        
        <h4 style="margin-top: 2rem;">Pitching Statistics</h4>
        <div class="comparison-grid" id="pitchingComparison">
          Loading pitching comparison...
        </div>
      </div>
    </div>

    <!-- Historical Matchups -->
    <div class="section">
      <div class="section-header">
        Previous Matchups
      </div>
      <div class="section-content">
        <div id="historyContent">
          Loading matchup history...
        </div>
      </div>
    </div>
  </div>

  <script>
    let allGames = [];
    let playerData = [];
    let pitchingData = [];
    let previewData = [];
    
    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const homeTeam = urlParams.get('home');
    const awayTeam = urlParams.get('away');
    const gameDate = urlParams.get('date');

    if (!homeTeam || !awayTeam || !gameDate) {
      document.body.innerHTML = `
        <div class="container">
          <h1>Error: Missing game information</h1>
          <p><a href="current-season.html">Return to current season</a></p>
        </div>
      `;
    } else {
      loadGamePreviewData();
    }

    async function loadGamePreviewData() {
      try {
        const [gamesResponse, playerResponse, pitchingResponse, previewResponse] = await Promise.all([
          fetch('games.json', { headers: { 'Accept': 'application/json; charset=utf-8' } }),
          fetch('data.json', { headers: { 'Accept': 'application/json; charset=utf-8' } }),
          fetch('pitching.json', { headers: { 'Accept': 'application/json; charset=utf-8' } }),
          fetch('previews.json', { headers: { 'Accept': 'application/json; charset=utf-8' } }).catch(() => ({ ok: false })) // Gracefully handle if previews.json doesn't exist yet
        ]);
        
        if (!gamesResponse.ok) throw new Error('Failed to load games data');
        if (!playerResponse.ok) throw new Error('Failed to load player data');
        if (!pitchingResponse.ok) throw new Error('Failed to load pitching data');
        
        allGames = await gamesResponse.json();
        playerData = await playerResponse.json();
        pitchingData = await pitchingResponse.json();

        // Load preview data if available
        if (previewResponse.ok) {
          previewData = await previewResponse.json();
        }

        generateGamePreview();

      } catch (error) {
        console.error('Error loading data:', error);
        document.body.innerHTML = `
          <div class="container">
            <h1>Error loading game preview data</h1>
            <p>Please try again later.</p>
            <p><a href="current-season.html">Return to current season</a></p>
          </div>
        `;
      }
    }

    function generateGamePreview() {
      // Update header
      document.getElementById('gameInfo').textContent = `${awayTeam} @ ${homeTeam} - ${gameDate}`;
      
      // Update team names and logos
      document.getElementById('awayTeamName').textContent = awayTeam;
      document.getElementById('homeTeamName').textContent = homeTeam;
      
      // Set team logos
      const awayLogo = document.getElementById('awayTeamLogo');
      const homeLogo = document.getElementById('homeTeamLogo');
      
      // Convert team names to lowercase for logo files
      const awayLogoPath = `logos/${awayTeam.toLowerCase()}.png`;
      const homeLogoPath = `logos/${homeTeam.toLowerCase()}.png`;
      
      awayLogo.src = awayLogoPath;
      awayLogo.alt = `${awayTeam} logo`;
      
      homeLogo.src = homeLogoPath;
      homeLogo.alt = `${homeTeam} logo`;

      // Calculate current season records
      const currentSeasonGames = allGames.filter(g => 
        g.year === "2025" && g.season === "Fall" && g.winner && g.winner.trim() !== ""
      );

      const homeRecord = calculateTeamRecord(homeTeam, currentSeasonGames);
      const awayRecord = calculateTeamRecord(awayTeam, currentSeasonGames);

      document.getElementById('homeTeamRecord').textContent = 
        `${homeRecord.wins}-${homeRecord.losses}${homeRecord.ties > 0 ? `-${homeRecord.ties}` : ''} (${(homeRecord.winPct * 100).toFixed(1)}%)`;
      
      document.getElementById('awayTeamRecord').textContent = 
        `${awayRecord.wins}-${awayRecord.losses}${awayRecord.ties > 0 ? `-${awayRecord.ties}` : ''} (${(awayRecord.winPct * 100).toFixed(1)}%)`;

      // Update game details
      document.getElementById('gameDetails').innerHTML = `
        <strong>Date:</strong> ${gameDate} | <strong>Type:</strong> Regular Season
      `;

      // Generate Peters Preview
      generatePetersPreview(homeTeam, awayTeam, gameDate);
      
      // Generate head-to-head record
      generateHeadToHeadRecord(homeTeam, awayTeam);
      
      // Generate key players
      generateKeyPlayers(homeTeam, awayTeam);
      
      // Generate team comparisons
      generateBattingComparison(homeTeam, awayTeam);
      generatePitchingComparison(homeTeam, awayTeam);
      
      // Generate historical matchups
      generateHistoricalMatchups(homeTeam, awayTeam);
    }

    // Helper function to fix character encoding issues
    function cleanText(text) {
      if (!text) return text;
      
      return text
        // Fix smart/curly apostrophes and quotes
        .replace(/['']/g, "'")  // Replace smart apostrophes with regular ones
        .replace(/[""]/g, '"')  // Replace smart quotes with regular ones
        // Fix any other common encoding issues
        .replace(/√¢‚Ç¨‚Ñ¢/g, "'")   // Another common apostrophe encoding issue
        .replace(/√¢‚Ç¨≈ì/g, '"')   // Opening smart quote
        .replace(/√¢‚Ç¨/g, '"')    // Closing smart quote
        .replace(/√¢‚Ç¨"/g, "‚Äî")   // Em dash
        .replace(/√¢‚Ç¨"/g, "‚Äì");  // En dash
    }

    function generatePetersPreview(homeTeam, awayTeam, gameDate) {
      // Find matching preview - handle both field name formats and flexible date matching
      const preview = previewData.find(p => {
        const matchesTeams = (p["home team"] === homeTeam && p["away team"] === awayTeam) ||
                           (p.home === homeTeam && p.away === awayTeam);
        const matchesDate = p.date === gameDate || 
                           formatDateForComparison(p.date) === formatDateForComparison(gameDate);
        return matchesTeams && matchesDate;
      });

      // Hide the entire Peters Preview section if no preview or blank preview text
      const petersSection = document.querySelector('.section:has(.peters-preview-header)');
      
      if (!preview || !preview.preview || preview.preview.trim() === '') {
        if (petersSection) {
          petersSection.style.display = 'none';
        }
        return;
      }

      // Show the section if it was previously hidden
      if (petersSection) {
        petersSection.style.display = 'block';
      }

      // Parse odds to determine favorite/underdog - handle both string and number formats
      const homeOdds = parseInt(preview["home odds"] || preview.odds?.home || 0);
      const awayOdds = parseInt(preview["away odds"] || preview.odds?.away || 0);
      
      // Only show odds if they exist
      let oddsHtml = '';
      if (homeOdds !== 0 || awayOdds !== 0) {
        const homeIsFavorite = homeOdds < 0 && (awayOdds > 0 || homeOdds > awayOdds);
        const awayIsFavorite = awayOdds < 0 && (homeOdds > 0 || awayOdds > homeOdds);

        oddsHtml = `
          <div class="odds-display">
            <div class="odds-item">
              <div class="odds-team">${awayTeam} (Away)</div>
              <div class="odds-value ${awayIsFavorite ? 'favorite' : ''}">${awayOdds > 0 ? '+' : ''}${awayOdds}</div>
            </div>
            <div class="odds-item">
              <div style="font-size: 1.2rem; color: #666;">Money Line</div>
            </div>
            <div class="odds-item">
              <div class="odds-team">${homeTeam} (Home)</div>
              <div class="odds-value ${homeIsFavorite ? 'favorite' : ''}">${homeOdds > 0 ? '+' : ''}${homeOdds}</div>
            </div>
          </div>
        `;
      }

      const previewHtml = `
        <div class="peters-preview-content">
          <div class="peters-preview-image" id="petersImageContainer">
            <img src="logos/peterpreview.png" alt="Peter's Preview" onerror="this.parentElement.style.display='none'">
          </div>
          <div class="peters-preview-main">
            ${oddsHtml}
            <div class="preview-text">
              ${cleanText(preview.preview)}
            </div>
          </div>
        </div>
      `;

      document.getElementById('petersPreviewContent').innerHTML = previewHtml;
    }

    // Helper function to normalize dates for comparison
    function formatDateForComparison(dateStr) {
      if (!dateStr) return '';
      
      // Handle different date formats (M/D/YYYY, MM/DD/YYYY, YYYY-MM-DD, etc.)
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return dateStr;
      
      // Return in M/D/YYYY format for comparison
      return `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;
    }

    function calculateTeamRecord(teamName, games) {
      const teamGames = games.filter(g => 
        g["home team"] === teamName || g["away team"] === teamName
      );

      let wins = 0, losses = 0, ties = 0;

      teamGames.forEach(game => {
        if (game.winner === "Tie") {
          ties++;
        } else if (game.winner === teamName) {
          wins++;
        } else {
          losses++;
        }
      });

      const totalDecided = wins + losses;
      const winPct = totalDecided > 0 ? wins / totalDecided : 0;

      return { wins, losses, ties, winPct };
    }

    function generateKeyPlayers(homeTeam, awayTeam) {
      const currentSeasonPlayers = playerData.filter(p => 
        p.year === "2025" && p.season === "Fall" && p.sub === "No"
      );

      // Get top 3 players for each team by AcesWar
      const homeTopPlayers = currentSeasonPlayers
        .filter(p => p.team === homeTeam && p.AcesWar !== "N/A")
        .sort((a, b) => parseFloat(b.AcesWar) - parseFloat(a.AcesWar))
        .slice(0, 3);

      const awayTopPlayers = currentSeasonPlayers
        .filter(p => p.team === awayTeam && p.AcesWar !== "N/A")
        .sort((a, b) => parseFloat(b.AcesWar) - parseFloat(a.AcesWar))
        .slice(0, 3);

      function createPlayerCard(player) {
        const atBats = parseInt(player.atBats) || 0;
        const hits = parseInt(player.hits) || 0;
        const walks = parseInt(player.walks) || 0;
        const runs = parseInt(player.runs) || 0;
        
        const avg = atBats > 0 ? (hits / atBats).toFixed(3) : ".000";
        const obp = (atBats + walks) > 0 ? ((hits + walks) / (atBats + walks)).toFixed(3) : ".000";
        const acesWar = parseFloat(player.AcesWar).toFixed(1);

        return `
          <div class="player-card">
            <div class="player-name">${player.name}</div>
            <div class="player-stats">
              <div class="player-stat">
                <span class="player-stat-label">AVG</span>
                <span class="player-stat-value">${avg}</span>
              </div>
              <div class="player-stat">
                <span class="player-stat-label">OBP</span>
                <span class="player-stat-value">${obp}</span>
              </div>
              <div class="player-stat">
                <span class="player-stat-label">Runs</span>
                <span class="player-stat-value">${runs}</span>
              </div>
              <div class="player-stat">
                <span class="player-stat-label">AcesBPI</span>
                <span class="player-stat-value">${acesWar}</span>
              </div>
            </div>
          </div>
        `;
      }

      const awayPlayersHtml = awayTopPlayers.map(createPlayerCard).join('');
      const homePlayersHtml = homeTopPlayers.map(createPlayerCard).join('');

      const keyPlayersHtml = `
        <div class="team-stats">
          <h4>${awayTeam} Top Players</h4>
          ${awayPlayersHtml}
        </div>

        <div class="vs-label">VS</div>

        <div class="team-stats">
          <h4>${homeTeam} Top Players</h4>
          ${homePlayersHtml}
        </div>
      `;

      document.getElementById('keyPlayersComparison').innerHTML = keyPlayersHtml;
    }

    function generateHeadToHeadRecord(homeTeam, awayTeam) {
      const h2hGames = allGames.filter(g => 
        (g["home team"] === homeTeam && g["away team"] === awayTeam) ||
        (g["home team"] === awayTeam && g["away team"] === homeTeam)
      ).filter(g => g.winner && g.winner.trim() !== "");

      let homeWins = 0, awayWins = 0, ties = 0;

      h2hGames.forEach(game => {
        if (game.winner === "Tie") {
          ties++;
        } else if (game.winner === homeTeam) {
          homeWins++;
        } else if (game.winner === awayTeam) {
          awayWins++;
        }
      });

      const totalGames = homeWins + awayWins + ties;
      let recordText = "No previous matchups";
      
      if (totalGames > 0) {
        recordText = `All-time series: ${homeTeam} ${homeWins}-${awayWins}${ties > 0 ? `-${ties}` : ''} ${awayTeam} (${totalGames} games)`;
      }

      document.getElementById('h2hSummary').innerHTML = `
        <div class="h2h-record">${recordText}</div>
      `;
    }

    function generateBattingComparison(homeTeam, awayTeam) {
      const currentSeasonBatting = playerData.filter(p => 
        p.year === "2025" && p.season === "Fall" && p.sub === "No"
      );

      const homeStats = calculateTeamBattingStats(homeTeam, currentSeasonBatting);
      const awayStats = calculateTeamBattingStats(awayTeam, currentSeasonBatting);

      const comparisonHtml = `
        <div class="team-stats">
          <h4>${awayTeam}</h4>
          <div class="stat-row">
            <span class="stat-label">Team Avg</span>
            <span class="stat-value">${homeStats.avg > awayStats.avg ? '' : ''}.${awayStats.avg}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Runs/Game</span>
            <span class="stat-value">${awayStats.runsPerGame}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Hits/Game</span>
            <span class="stat-value">${awayStats.hitsPerGame}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Total Runs</span>
            <span class="stat-value">${awayStats.totalRuns}</span>
          </div>
        </div>

        <div class="vs-label">VS</div>

        <div class="team-stats">
          <h4>${homeTeam}</h4>
          <div class="stat-row">
            <span class="stat-label">Team Avg</span>
            <span class="stat-value">.${homeStats.avg}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Runs/Game</span>
            <span class="stat-value">${homeStats.runsPerGame}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Hits/Game</span>
            <span class="stat-value">${homeStats.hitsPerGame}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Total Runs</span>
            <span class="stat-value">${homeStats.totalRuns}</span>
          </div>
        </div>
      `;

      document.getElementById('battingComparison').innerHTML = comparisonHtml;
    }

    function generatePitchingComparison(homeTeam, awayTeam) {
      const currentSeasonPitching = pitchingData.filter(p => 
        p.year === "2025" && p.season === "Fall"
      );

      const homeStats = calculateTeamPitchingStats(homeTeam, currentSeasonPitching);
      const awayStats = calculateTeamPitchingStats(awayTeam, currentSeasonPitching);

      const comparisonHtml = `
        <div class="team-stats">
          <h4>${awayTeam}</h4>
          <div class="stat-row">
            <span class="stat-label">Team ERA</span>
            <span class="stat-value">${awayStats.era}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Innings</span>
            <span class="stat-value">${awayStats.totalIP}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Runs Allowed</span>
            <span class="stat-value">${awayStats.totalRunsAllowed}</span>
          </div>
        </div>

        <div class="vs-label">VS</div>

        <div class="team-stats">
          <h4>${homeTeam}</h4>
          <div class="stat-row">
            <span class="stat-label">Team ERA</span>
            <span class="stat-value">${homeStats.era}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Innings</span>
            <span class="stat-value">${homeStats.totalIP}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Runs Allowed</span>
            <span class="stat-value">${homeStats.totalRunsAllowed}</span>
          </div>
        </div>
      `;

      document.getElementById('pitchingComparison').innerHTML = comparisonHtml;
    }

    function calculateTeamBattingStats(teamName, battingData) {
      const teamPlayers = battingData.filter(p => p.team === teamName);
      
      if (teamPlayers.length === 0) {
        return { avg: "000", runsPerGame: "0.0", hitsPerGame: "0.0", totalRuns: 0 };
      }

      const totalAtBats = teamPlayers.reduce((sum, p) => sum + (Number(p.atBats) || 0), 0);
      const totalHits = teamPlayers.reduce((sum, p) => sum + (Number(p.hits) || 0), 0);
      const totalRuns = teamPlayers.reduce((sum, p) => sum + (Number(p.runs) || 0), 0);
      const totalGames = Math.max(...teamPlayers.map(p => Number(p.games) || 0));

      const avg = totalAtBats > 0 ? Math.round((totalHits / totalAtBats) * 1000) : 0;
      const runsPerGame = totalGames > 0 ? (totalRuns / totalGames).toFixed(1) : "0.0";
      const hitsPerGame = totalGames > 0 ? (totalHits / totalGames).toFixed(1) : "0.0";

      return {
        avg: avg.toString().padStart(3, '0'),
        runsPerGame,
        hitsPerGame,
        totalRuns
      };
    }

    function calculateTeamPitchingStats(teamName, pitchingData) {
      const teamPitchers = pitchingData.filter(p => p.team === teamName);
      
      if (teamPitchers.length === 0) {
        return { era: "N/A", totalIP: "0.0", totalRunsAllowed: 0 };
      }

      const totalIP = teamPitchers.reduce((sum, p) => sum + (parseFloat(p.IP) || 0), 0);
      const totalRunsAllowed = teamPitchers.reduce((sum, p) => sum + (Number(p["runs allowed"]) || 0), 0);

      const era = totalIP > 0 ? ((totalRunsAllowed * 7) / totalIP).toFixed(2) : "N/A";

      return {
        era,
        totalIP: totalIP.toFixed(1),
        totalRunsAllowed
      };
    }

    function generateHistoricalMatchups(homeTeam, awayTeam) {
      const matchups = allGames.filter(g => 
        (g["home team"] === homeTeam && g["away team"] === awayTeam) ||
        (g["home team"] === awayTeam && g["away team"] === homeTeam)
      ).filter(g => g.winner && g.winner.trim() !== "")
      .sort((a, b) => new Date(b.date) - new Date(a.date));

      if (matchups.length === 0) {
        document.getElementById('historyContent').innerHTML = 
          '<div class="no-data">No previous matchups found between these teams.</div>';
        return;
      }

      const tableHtml = `
        <table class="history-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Home Team</th>
              <th>Score</th>
              <th>Away Team</th>
              <th>Winner</th>
              <th>Season</th>
            </tr>
          </thead>
          <tbody>
            ${matchups.map(game => {
              const isWinner = (team) => game.winner === team ? 'winner-highlight' : '';
              const forfeit = game.forfeit === "Yes" ? " (Forfeit)" : "";
              
              return `
                <tr>
                  <td>${game.date}</td>
                  <td class="${isWinner(game["home team"])}">${game["home team"]}</td>
                  <td>${game["home score"]} - ${game["away score"]}${forfeit}</td>
                  <td class="${isWinner(game["away team"])}">${game["away team"]}</td>
                  <td class="winner-highlight">${game.winner}</td>
                  <td>${game.season} ${game.year}</td>
                </tr>
              `;
            }).join('')}
          </tbody>
        </table>
        <div style="margin-top: 1rem; text-align: center; color: #666; font-size: 0.9rem;">
          Showing ${matchups.length} previous matchup${matchups.length !== 1 ? 's' : ''}
        </div>
      `;

      document.getElementById('historyContent').innerHTML = tableHtml;
    }
  </script>

  <script src="team-colors.js"></script>
 <script src="mobile-enhancements.js"></script>
</body>
</html>
