<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2d5016">
    <title>Schedule Builder - Mountainside Aces</title>
    <style>
        :root {
            --primary-color: #2d5016;
            --secondary-color: #1a6b4a;
            --accent-color: #ffd700;
            --card-bg: #ffffff;
            --text-dark: #2d3748;
            --text-light: #718096;
            --border-color: #e2e8f0;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.16);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            color: var(--text-dark);
            min-height: 100vh;
            padding: 1.5rem;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            margin-bottom: 2rem;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .back-btn {
            color: var(--secondary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: transform 0.3s ease;
        }

        .back-btn:hover {
            transform: translateX(-4px);
        }

        .header-title h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .header-title p {
            color: var(--text-light);
            font-size: 1rem;
        }

        .upload-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 4rem 3rem;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
        }

        .upload-section h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .upload-section p {
            color: var(--text-light);
            max-width: 500px;
            margin: 0 auto 2rem;
            line-height: 1.6;
        }

        .file-input-label {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 1rem;
        }

        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        input[type="file"] {
            display: none;
        }

        .format-example {
            margin-top: 2rem;
            text-align: left;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .format-example h3 {
            font-weight: 700;
            color: #0050b3;
            margin-bottom: 0.75rem;
        }

        .format-example pre {
            font-size: 0.85rem;
            color: #003a8c;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        .sidebar {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            height: fit-content;
            position: sticky;
            top: 1.5rem;
        }

        .sidebar h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .team-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .team-btn {
            width: 100%;
            text-align: left;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .team-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }

        .team-btn:not(.active) {
            background: #f7fafc;
            color: var(--text-dark);
        }

        .team-btn:not(.active):hover {
            background: #edf2f7;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .stat-icon {
            font-size: 1.5rem;
        }

        .stat-header h3 {
            font-weight: 700;
            color: var(--text-dark);
            font-size: 1rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .molski-excellent { color: #28a745 !important; }
        .molski-good { color: #20c997 !important; }
        .molski-fair { color: #ffc107 !important; }
        .molski-poor { color: #fd7e14 !important; }
        .molski-unfair { color: #dc3545 !important; }

        .molski-rankings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .molski-rankings-table th {
            text-align: left;
            padding: 0.75rem;
            background: #f7fafc;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 2px solid var(--border-color);
        }

        .molski-rankings-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .molski-rankings-table tr:hover {
            background: #f7fafc;
        }

        .molski-rankings-table .rank-cell {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-light);
            width: 60px;
        }

        .molski-rankings-table .team-cell {
            font-weight: 600;
            color: var(--text-dark);
        }

        .molski-rankings-table .score-cell {
            font-weight: 700;
            font-size: 1.1rem;
            text-align: center;
            width: 100px;
        }

        .molski-rankings-table .rating-cell {
            text-align: center;
            font-weight: 600;
            width: 120px;
        }

        .molski-rankings-table tr.current-team {
            background: #e6f7ff;
            border-left: 4px solid var(--secondary-color);
        }

        .content-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            margin-bottom: 2rem;
        }

        .content-card h3 {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
        }

        .day-breakdown {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .day-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .day-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .day-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .day-count {
            color: var(--text-light);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            transition: width 0.6s ease;
        }

        .opponents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .opponent-item {
            background: #f7fafc;
            border-radius: 12px;
            padding: 1rem;
        }

        .opponent-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .opponent-count {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .schedule-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .game-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem;
            background: #f7fafc;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .game-item:hover {
            background: #edf2f7;
        }

        .game-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .game-date {
            text-align: center;
            min-width: 80px;
        }

        .date-month {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--secondary-color);
        }

        .date-day {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.125rem;
        }

        .game-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .location-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .location-badge.home {
            background: #d4edda;
            color: #155724;
        }

        .location-badge.away {
            background: #e2d9f3;
            color: #563d7c;
        }

        .game-details .opponent {
            font-weight: 600;
            color: var(--text-dark);
        }

        .game-details .time {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .upload-new-btn {
            padding: 0.75rem 1.5rem;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .upload-new-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .header-title h1 {
                font-size: 2rem;
            }

            .upload-section {
                padding: 3rem 1.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .game-left {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Upload View -->
        <div id="uploadView">
            <div class="header-card">
                <div class="header-content">
                    <div class="header-left">
                        <a href="offseason.html" class="back-btn">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                        </a>
                        <div class="header-title">
                            <h1>Schedule Builder ‚öæ</h1>
                            <p>Upload and analyze your league schedule</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="upload-section">
                <div class="upload-icon">üì§</div>
                <h2>Upload Schedule File</h2>
                <p>Upload a CSV file with your schedule. Required columns: date, home (or home team), away (or away team), time (or game time)</p>
                
                <label class="file-input-label">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                    </svg>
                    Choose File
                    <input type="file" id="fileInput" accept=".csv">
                </label>

                <div class="format-example">
                    <h3>CSV Format Example:</h3>
                    <pre>date,home,away,time
2025-06-15,Team 1,Team 2,7:00 PM
2025-06-17,Team 3,Team 1,6:30 PM
2025-06-19,Team 2,Team 4,8:00 PM</pre>
                </div>
            </div>
        </div>

        <!-- Analysis View -->
        <div id="analysisView" class="hidden">
            <div class="header-card">
                <div class="header-content">
                    <div class="header-left">
                        <a href="offseason.html" class="back-btn">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                        </a>
                        <div class="header-title">
                            <h1>Schedule Analysis ‚öæ</h1>
                            <p id="scheduleInfo"></p>
                        </div>
                    </div>
                    
                    <button class="upload-new-btn" onclick="resetUpload()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                        </svg>
                        Upload New Schedule
                    </button>
                </div>
            </div>

            <div class="main-grid">
                <div class="sidebar">
                    <h2>Teams</h2>
                    <div class="team-list" id="teamList"></div>
                </div>

                <div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üìÖ</span>
                                <h3>Total Games</h3>
                            </div>
                            <div class="stat-value" style="color: var(--secondary-color);" id="totalGames">0</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üè†</span>
                                <h3>Home Games</h3>
                            </div>
                            <div class="stat-value" style="color: #28a745;" id="homeGames">0</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üìç</span>
                                <h3>Away Games</h3>
                            </div>
                            <div class="stat-value" style="color: #8b5cf6;" id="awayGames">0</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">‚öñÔ∏è</span>
                                <h3>MOLSKI Score</h3>
                            </div>
                            <div class="stat-value" id="molskiScore" style="color: var(--primary-color);">-</div>
                            <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 0.5rem;" id="molskiLabel">
                                Calculating...
                            </div>
                        </div>
                    </div>

                    <div class="format-example" style="margin-bottom: 2rem;">
                        <h3>üìä About MOLSKI Score</h3>
                        <p style="margin-top: 0.5rem; line-height: 1.6;">
                            <strong>MOLSKI (Measure Of League Schedule Kinship Imbalance)</strong> measures schedule fairness from 0-100:
                        </p>
                        <ul style="margin: 0.75rem 0 0 1.5rem; line-height: 1.8;">
                            <li><strong style="color: #28a745;">0-15: Excellent</strong> - Very fair schedule balance</li>
                            <li><strong style="color: #20c997;">16-30: Good</strong> - Minor imbalances</li>
                            <li><strong style="color: #ffc107;">31-45: Fair</strong> - Moderate distribution issues</li>
                            <li><strong style="color: #fd7e14;">46-60: Poor</strong> - Significant imbalances</li>
                            <li><strong style="color: #dc3545;">61+: Unfair</strong> - Major scheduling inequity</li>
                        </ul>
                        <p style="margin-top: 0.75rem; font-size: 0.85rem; color: #666;">
                            <em>Factors: Day distribution (40%), Time distribution (40%), Home/Away balance (20%)</em>
                        </p>
                    </div>

                    <div class="content-card">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 20V10M12 20V4M6 20v-6"/>
                            </svg>
                            Games by Day of Week
                        </h3>
                        <div class="day-breakdown" id="dayBreakdown"></div>
                    </div>

                    <div class="content-card">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            Games by Time
                        </h3>
                        <div class="day-breakdown" id="timeBreakdown"></div>
                    </div>

                    <div class="content-card">
                        <h3>Opponents</h3>
                        <div class="opponents-grid" id="opponentsList"></div>
                    </div>

                    <div class="content-card">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3h18v18H3zM9 3v18M15 3v18M3 9h18M3 15h18"/>
                            </svg>
                            League-wide MOLSKI Rankings
                        </h3>
                        <div id="leagueMolskiRankings"></div>
                    </div>

                    <div class="content-card">
                        <h3>Full Schedule</h3>
                        <div class="schedule-list" id="scheduleList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let scheduleData = null;
        let selectedTeam = null;

        document.getElementById('fileInput').addEventListener('change', handleFileUpload);

        async function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const lines = text.split('\n').map(line => line.trim()).filter(line => line);
                const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                
                const games = lines.slice(1).map(line => {
                    const values = line.split(',').map(v => v.trim());
                    const game = {};
                    headers.forEach((header, i) => {
                        game[header] = values[i];
                    });
                    return game;
                });

                const teamStats = {};
                
                games.forEach(game => {
                    const date = new Date(game.date);
                    const dayOfWeek = date.toLocaleDateString('en-US', { weekday: 'long' });
                    const homeTeam = game.home || game['home team'];
                    const awayTeam = game.away || game['away team'];
                    const time = game.time || game['game time'];

                    if (!teamStats[homeTeam]) {
                        teamStats[homeTeam] = {
                            games: [],
                            homeGames: 0,
                            awayGames: 0,
                            dayBreakdown: {},
                            timeBreakdown: {},
                            opponents: {}
                        };
                    }
                    if (!teamStats[awayTeam]) {
                        teamStats[awayTeam] = {
                            games: [],
                            homeGames: 0,
                            awayGames: 0,
                            dayBreakdown: {},
                            timeBreakdown: {},
                            opponents: {}
                        };
                    }

                    teamStats[homeTeam].games.push({
                        date: game.date,
                        time: time,
                        opponent: awayTeam,
                        location: 'Home',
                        dayOfWeek: dayOfWeek
                    });
                    teamStats[homeTeam].homeGames++;
                    teamStats[homeTeam].dayBreakdown[dayOfWeek] = (teamStats[homeTeam].dayBreakdown[dayOfWeek] || 0) + 1;
                    teamStats[homeTeam].timeBreakdown[time] = (teamStats[homeTeam].timeBreakdown[time] || 0) + 1;
                    teamStats[homeTeam].opponents[awayTeam] = (teamStats[homeTeam].opponents[awayTeam] || 0) + 1;

                    teamStats[awayTeam].games.push({
                        date: game.date,
                        time: time,
                        opponent: homeTeam,
                        location: 'Away',
                        dayOfWeek: dayOfWeek
                    });
                    teamStats[awayTeam].awayGames++;
                    teamStats[awayTeam].dayBreakdown[dayOfWeek] = (teamStats[awayTeam].dayBreakdown[dayOfWeek] || 0) + 1;
                    teamStats[awayTeam].timeBreakdown[time] = (teamStats[awayTeam].timeBreakdown[time] || 0) + 1;
                    teamStats[awayTeam].opponents[homeTeam] = (teamStats[awayTeam].opponents[homeTeam] || 0) + 1;
                });

                Object.keys(teamStats).forEach(team => {
                    teamStats[team].games.sort((a, b) => new Date(a.date) - new Date(b.date));
                });

                scheduleData = teamStats;
                selectedTeam = Object.keys(teamStats)[0];
                showAnalysis();
            } catch (error) {
                alert('Error parsing file. Please ensure it\'s a valid CSV with columns: date, home, away, time');
                console.error(error);
            }
        }

        /**
         * Calculate MOLSKI - Measure Of League Schedule Kinship Imbalance
         * Lower score = more fair schedule
         * Components:
         * 1. Day distribution variance (0-40 points)
         * 2. Time distribution variance (0-40 points)
         * 3. Home/Away imbalance (0-20 points)
         */
        function calculateMOLSKI(teamData, allTeamsData) {
            let score = 0;
            
            // Component 1: Day Distribution Variance (0-40 points)
            const dayDistribution = Object.values(teamData.dayBreakdown);
            const avgGamesPerDay = dayDistribution.reduce((a, b) => a + b, 0) / dayDistribution.length;
            const dayVariance = dayDistribution.reduce((sum, count) => {
                return sum + Math.pow(count - avgGamesPerDay, 2);
            }, 0) / dayDistribution.length;
            const dayImbalance = Math.sqrt(dayVariance);
            score += Math.min(40, dayImbalance * 8); // Scale to max 40
            
            // Component 2: Time Distribution Variance (0-40 points)
            const timeDistribution = Object.values(teamData.timeBreakdown);
            const avgGamesPerTime = timeDistribution.reduce((a, b) => a + b, 0) / timeDistribution.length;
            const timeVariance = timeDistribution.reduce((sum, count) => {
                return sum + Math.pow(count - avgGamesPerTime, 2);
            }, 0) / timeDistribution.length;
            const timeImbalance = Math.sqrt(timeVariance);
            score += Math.min(40, timeImbalance * 8); // Scale to max 40
            
            // Component 3: Home/Away Balance (0-20 points)
            const totalGames = teamData.games.length;
            const idealSplit = totalGames / 2;
            const homeAwayImbalance = Math.abs(teamData.homeGames - idealSplit);
            const homeAwayPenalty = (homeAwayImbalance / totalGames) * 100;
            score += Math.min(20, homeAwayPenalty); // Scale to max 20
            
            return Math.round(score);
        }

        function getMOLSKIRating(score) {
            if (score <= 15) return { label: 'Excellent', class: 'molski-excellent' };
            if (score <= 30) return { label: 'Good', class: 'molski-good' };
            if (score <= 45) return { label: 'Fair', class: 'molski-fair' };
            if (score <= 60) return { label: 'Poor', class: 'molski-poor' };
            return { label: 'Unfair', class: 'molski-unfair' };
        }

        function showAnalysis() {
            document.getElementById('uploadView').classList.add('hidden');
            document.getElementById('analysisView').classList.remove('hidden');
            
            const teams = Object.keys(scheduleData);
            document.getElementById('scheduleInfo').textContent = 
                `${teams.length} teams ‚Ä¢ ${scheduleData[selectedTeam].games.length} games per team`;
            
            renderTeamList();
            renderTeamData();
            renderLeagueMolskiRankings();
        }

        function renderTeamList() {
            const teams = Object.keys(scheduleData);
            const teamListHTML = teams.map(team => `
                <button class="team-btn ${team === selectedTeam ? 'active' : ''}" 
                        onclick="selectTeam('${team}')">
                    ${team}
                </button>
            `).join('');
            
            document.getElementById('teamList').innerHTML = teamListHTML;
        }

        function selectTeam(team) {
            selectedTeam = team;
            renderTeamList();
            renderTeamData();
            renderLeagueMolskiRankings();
        }

        function renderLeagueMolskiRankings() {
            const teams = Object.keys(scheduleData);
            
            // Calculate MOLSKI for all teams
            const teamScores = teams.map(team => {
                const molskiScore = calculateMOLSKI(scheduleData[team], scheduleData);
                const molskiRating = getMOLSKIRating(molskiScore);
                return {
                    team,
                    score: molskiScore,
                    rating: molskiRating
                };
            });
            
            // Sort by score (lower is better)
            teamScores.sort((a, b) => a.score - b.score);
            
            const rankingsHTML = `
                <table class="molski-rankings-table">
                    <thead>
                        <tr>
                            <th class="rank-cell">Rank</th>
                            <th class="team-cell">Team</th>
                            <th class="score-cell">MOLSKI</th>
                            <th class="rating-cell">Rating</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${teamScores.map((item, index) => `
                            <tr class="${item.team === selectedTeam ? 'current-team' : ''}">
                                <td class="rank-cell">#${index + 1}</td>
                                <td class="team-cell">${item.team}</td>
                                <td class="score-cell ${item.rating.class}">${item.score}</td>
                                <td class="rating-cell ${item.rating.class}">${item.rating.label}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div style="margin-top: 1rem; font-size: 0.85rem; color: var(--text-light); text-align: center;">
                    League Average: ${Math.round(teamScores.reduce((sum, t) => sum + t.score, 0) / teamScores.length)} ‚Ä¢ 
                    Best: ${teamScores[0].score} (${teamScores[0].team}) ‚Ä¢ 
                    Worst: ${teamScores[teamScores.length - 1].score} (${teamScores[teamScores.length - 1].team})
                </div>
            `;
            
            document.getElementById('leagueMolskiRankings').innerHTML = rankingsHTML;
        }

        function renderTeamData() {
            const data = scheduleData[selectedTeam];
            
            document.getElementById('totalGames').textContent = data.games.length;
            document.getElementById('homeGames').textContent = data.homeGames;
            document.getElementById('awayGames').textContent = data.awayGames;
            
            // Calculate and display MOLSKI score
            const molskiScore = calculateMOLSKI(data, scheduleData);
            const molskiRating = getMOLSKIRating(molskiScore);
            const molskiElement = document.getElementById('molskiScore');
            molskiElement.textContent = molskiScore;
            molskiElement.className = `stat-value ${molskiRating.class}`;
            document.getElementById('molskiLabel').textContent = molskiRating.label + ' Fairness';
            
            const dayBreakdownHTML = Object.entries(data.dayBreakdown)
                .sort((a, b) => b[1] - a[1])
                .map(([day, count]) => {
                    const percentage = (count / data.games.length) * 100;
                    return `
                        <div class="day-item">
                            <div class="day-label">
                                <span class="day-name">${day}</span>
                                <span class="day-count">${count} games</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            
            document.getElementById('dayBreakdown').innerHTML = dayBreakdownHTML;
            
            const timeBreakdownHTML = Object.entries(data.timeBreakdown)
                .sort((a, b) => {
                    // Sort times chronologically
                    const timeA = a[0].toLowerCase();
                    const timeB = b[0].toLowerCase();
                    // Extract hour for sorting
                    const getHour = (time) => {
                        const match = time.match(/(\d+)(?::(\d+))?\s*(am|pm)/i);
                        if (!match) return 24; // Unknown times go to end
                        let hour = parseInt(match[1]);
                        const period = match[3].toLowerCase();
                        if (period === 'pm' && hour !== 12) hour += 12;
                        if (period === 'am' && hour === 12) hour = 0;
                        return hour;
                    };
                    return getHour(timeA) - getHour(timeB);
                })
                .map(([time, count]) => {
                    const percentage = (count / data.games.length) * 100;
                    return `
                        <div class="day-item">
                            <div class="day-label">
                                <span class="day-name">${time}</span>
                                <span class="day-count">${count} ${count === 1 ? 'game' : 'games'}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            
            document.getElementById('timeBreakdown').innerHTML = timeBreakdownHTML;
            
            const opponentsHTML = Object.entries(data.opponents)
                .sort((a, b) => b[1] - a[1])
                .map(([opponent, count]) => `
                    <div class="opponent-item">
                        <div class="opponent-name">${opponent}</div>
                        <div class="opponent-count">${count} ${count === 1 ? 'game' : 'games'}</div>
                    </div>
                `).join('');
            
            document.getElementById('opponentsList').innerHTML = opponentsHTML;
            
            const scheduleHTML = data.games.map(game => {
                const date = new Date(game.date);
                const monthDay = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                return `
                    <div class="game-item">
                        <div class="game-left">
                            <div class="game-date">
                                <div class="date-month">${monthDay}</div>
                                <div class="date-day">${game.dayOfWeek}</div>
                            </div>
                            
                            <div class="game-info">
                                <span class="location-badge ${game.location.toLowerCase()}">
                                    ${game.location}
                                </span>
                                
                                <div class="game-details">
                                    <div class="opponent">vs ${game.opponent}</div>
                                    <div class="time">${game.time}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('scheduleList').innerHTML = scheduleHTML;
        }

        function resetUpload() {
            scheduleData = null;
            selectedTeam = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('analysisView').classList.add('hidden');
            document.getElementById('uploadView').classList.remove('hidden');
        }
    </script>
</body>
</html>